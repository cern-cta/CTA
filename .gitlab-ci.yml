stages:
  - analysis
  - build
  - build:dockerimage
  - build:tagged_rpm
  - test
  - regressions
  - shouldfail
  - publish_rpm
  - release_rpm

variables:
  XROOTD_VERSION: 5
  SCHED_TYPE: "objectstore"
  ORACLE_SUPPORT: "ON"
  CTA_VERSION: "${XROOTD_VERSION}"
  CMAKE_OPTIONS: ""
  UNIT_TEST: "ON"
  ALMA9: "ON"
  SYSTEMTESTS_ONLY: "FALSE"
  BUILD_GENERATOR: "Unix Makefiles"


default:
  interruptible: true
  before_script:
    - export CTA_BUILD_ID=${CI_PIPELINE_ID}git${CI_COMMIT_SHA:0:8}
    - echo "Exporting CTA_BUILD_ID=${CTA_BUILD_ID}"
    - test -n "${CI_COMMIT_TAG}" && export TAG_VERSION=$(echo ${CI_COMMIT_TAG} | awk -F'[v-]' '{print $2}')
    - test -n "${CI_COMMIT_TAG}" && export TAG_RELEASE=$(echo ${CI_COMMIT_TAG} | awk -F '-' '{if(NF>1) print $2; else print 0}')

include:
  - local: .gitlab/ci/*.gitlab-ci.yml
