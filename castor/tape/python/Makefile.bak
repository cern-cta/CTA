# Makefile generated by imake - do not edit!
# $XConsortium: imake.c,v 1.51 89/12/12 12:37:30 jim Exp $

#       @(#)linux.cf,v 1.10 2002/11/19 10:24:12 CERN IT-PDP/DM Jean-Philippe Baud
#
#  Copyright (C) 1997-2002 by CERN/IT/PDP/DM
#  All rights reserved
#

#  Default rules for Make          Linux

LDFLAGS += -Wl,--defsym,CastorVersion_v$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION)=0

CASTOR_ROOT?=$(shell pwd | sed -e 's=CASTOR2/.*$$=CASTOR2=' -e 's=trunk/.*$$=trunk=' -e 's=\(v2_1_[^/]*\)/.*$$=\1=' -e 's=\(castor-[0-9\-\.]*\)/.*$$=\1=')
CC += -fPIC -D_LARGEFILE64_SOURCE -Wall -Werror
CXX += -fPIC -D_LARGEFILE64_SOURCE -Wall -Werror
MTCCFLAGS = -pthread -DCTHREAD_POSIX -D_THREAD_SAFE -D_REENTRANT
MTLDLIBS =
MTLDFLAGS = -pthread
SHLIBLDFLAGS = -shared
SHLIBREQLIBS = -lc -lpthread `g++ -print-file-name=libstdc++.so` -ldl

PERLLIBDIR = /usr/lib/perl/CASTOR

PYTHONLIBS = `python ${CASTOR_ROOT}/config/pycompile.py --libs`
PYTHONINC = `python ${CASTOR_ROOT}/config/pycompile.py --inc`
PYTHONCFLAGS = `python ${CASTOR_ROOT}/config/pycompile.py --cflags`
PYTHONLIBDIR = $(shell python -c "from distutils import sysconfig; print sysconfig.get_python_lib()")

ACCTFLAG=-DSACCT
BIN = /usr/bin
LIBDIR = /usr/lib64
CONFIGDIR = /etc/sysconfig
CP = cp
LD = cc
LN = ln
SHELL = /bin/sh

DLFWEB=/var/www/html/dlf
DLFCONF=/var/www/conf/dlf

.PHONY : install clean clobber Makefiles depend checkDESTDIR checkORACLE checkLSF checkGLOBUS checkSTK checkXROOT checkVERSION

all: checkORACLE checkLSF checkGLOBUS checkXROOT tape client
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

tape: checkSTK

client:

EXPORTMAN?=$(DESTDIR)/usr/share
checkDESTDIR:
	@if [ -z "${DESTDIR}" ]; then 	  echo "Please set DESTDIR environment variable before invoking make install."; 	  exit 1; 	fi;

checkORACLE:
	@if [ -z ${ORACLE_HOME} ]; then 	  echo "Please define ORACLE_HOME environment variable before invoking make."; 	  exit 1; 	fi; 	if [ ! -r ${ORACLE_HOME}/lib/libclntsh.so ]; then 	  echo "Could not find libclntsh.so in ${ORACLE_HOME}/lib. Giving up."; 	  exit 1; 	fi

checkLSF:
	@if [ ! -e /usr/lib64/liblsf.so -o ! -d /usr/include/lsf ]; then 	  echo "Could not find LSF installation. Giving up."; 	  exit 1; 	fi

GLOBUS_LOCATION ?= /opt/globus
checkGLOBUS:
	@if [ ! -r ${GLOBUS_LOCATION}/lib/libglobus_ftp_control_gcc64dbg.so -o ! -d ${GLOBUS_LOCATION}/include ]; then 	  echo "Could not find Globus installation at ${GLOBUS_LOCATION}. Giving up."; 	  exit 1; 	fi

checkSTK:
	@if [ ! -z "${CASTOR_NOSTK}" ]; then 	  echo "Compiling without STK support."; 	else 	  if [ ! -e /usr/lib64/CDK/libapi.so -o ! -e /usr/lib64/CDK/libutl.so -o ! -e /usr/lib64/CDK/libipc.so -o ! -e /usr/lib64/CDK/libcl.so ]; then 	    echo "Could not find STK libraries. Giving up."; 	    exit 1;           fi; 	  if [ ! -d /usr/include/CDK ]; then 	    echo "Could not find STK development files. Giving up."; 	    exit 1;           fi; 	fi

XROOT_LOCATION ?= /opt/xrootd
checkXROOT:
	@if [ ! -r ${XROOT_LOCATION}/lib/libXrdPosix.so -o ! -d ${XROOT_LOCATION}/include ]; then 	  echo "Could not find XROOT installation at ${XROOT_LOCATION}. Giving up."; 	  exit 1; 	fi

checkVERSION:
	@if [ -z "${MAJOR_CASTOR_VERSION}" -o -z "${MINOR_CASTOR_VERSION}" ]; then 	  echo "Please define MAJOR/MINOR_CASTOR_VERSION before installing."; 	  exit 1; 	fi

install: checkDESTDIR checkVERSION all exportman
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

clean:
	rm -f $(FilesToClean)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

clobber: clean
	rm -f $(FilesToClobber)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

Makefiles:
	@for i in $(SUBDIRS);	do (if [ -d $$i ] ;	    then 	      (echo " $$i:" ; cd $$i ;	      $(CASTOR_ROOT)/imake/imake -I$(CASTOR_ROOT)/config;	      $(MAKE) $(MFLAGS) $@) ;	    else 	      (echo "ERROR : No directory $$i" ;	      exit 1) ;	    fi )	done ;

exportman:
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

depend:
	makedepend -I $(CASTOR_ROOT) -I $(CASTOR_ROOT)/h *.c *.cpp *.hpp *.h 2> /dev/null
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

#
#                      castor/tape/pythonUtils/Imakefile
#
# This file is part of the Castor project.
# See http://castor.web.cern.ch/castor
#
# Copyright (C) 2003  CERN
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#
# @author Nicola.Bessone@cern.ch Steven.Murray@cern.ch
#

INCLUDES = -I../../../h -I../../..
CPPFLAGS = -g -O0 $(INCLUDES) $(PYTHONINC) $(MTCCFLAGS)
LDFLAGS += $(MTLDFLAGS)
LD = g++
LIBS = $(PYTHONLIBS)

TAPEUTILSLIB_SRCS =   Utils.cpp   ScopedPythonLock.cpp   SmartPyObjectPtr.cpp

TAPEUTILSLIB_OBJS = $(TAPEUTILSLIB_SRCS:.cpp=.o)

DEPLIB += ../../libcastorclient.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../libcastorclient.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/upv -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/ns
../../libcastorclient.so.$(MAJOR_CASTOR_VERSION):
	cd ../.. ; $(MAKE) libcastorclient.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorclient.so:
	cd ../.. ; $(MAKE) $@
libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION): $(PYTHONUTILSLIB_OBJS) $(DEPLIB)
	$(LD) -shared --no-undefined -o $@ $(LDFLAGS) -Wl,-soname,libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION) $(PYTHONUTILSLIB_OBJS) $(LIBS)
$(DESTDIR)/$(LIBDIR)/libcastorpythonutils.so: libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION) $(if $(DEPLIB),$(addprefix $(DESTDIR)/$(LIBDIR)/,$(subst .$(MAJOR_CASTOR_VERSION),,$(notdir $(DEPLIB)))))
	@install -d $(DESTDIR)/$(LIBDIR)
	install $< $(DESTDIR)/$(LIBDIR)/libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION)
	rm -f $(DESTDIR)/$(LIBDIR)/libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION) $@
	ln -s libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION) $(DESTDIR)/$(LIBDIR)/libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION)
	ln -s libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION) $@
install: $(DESTDIR)/$(LIBDIR)/libcastorpythonutils.so
all: libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION)
FilesToClean += $(PYTHONUTILSLIB_OBJS)
FilesToClobber += libcastorpythonutils.so.$(MAJOR_CASTOR_VERSION)

