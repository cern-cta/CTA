# Makefile generated by imake - do not edit!
# $XConsortium: imake.c,v 1.51 89/12/12 12:37:30 jim Exp $

#       @(#)linux.cf,v 1.10 2002/11/19 10:24:12 CERN IT-PDP/DM Jean-Philippe Baud
#
#  Copyright (C) 1997-2002 by CERN/IT/PDP/DM
#  All rights reserved
#

#  Default rules for Make          Linux

CC += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wno-long-long
CXX += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wno-long-long
MTCCFLAGS = -pthread -DCTHREAD_POSIX -D_THREAD_SAFE -D_REENTRANT
MTLDLIBS =
MTLDFLAGS = -pthread
SHLIBLDFLAGS = -shared
SHLIBREQLIBS = -lc -lpthread `g++ -print-file-name=libstdc++.so` -ldl

PYTHONLIBS = `python ${CASTOR_HOME}/config/pycompile.py --libs`
PYTHONINC = `python ${CASTOR_HOME}/config/pycompile.py --inc`
PYTHONCFLAGS = `python ${CASTOR_HOME}/config/pycompile.py --cflags`

FC = g77

ACCTFLAG=-DSACCT

BIN = /usr/bin

CONFIGDIR = /etc/sysconfig
FILMANDIR = /usr/share/man/man4
FILMANSUFFIX = 4
LIBMANDIR = /usr/share/man/man3
LIBMANSUFFIX = 3
MANDIR = /usr/share/man/man1
MANSUFFIX = 1

CP = cp
LD = cc
LDFLAGS = -Wl,--defsym,CastorVersion_v$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION)=0
LN = ln

RANLIB = ranlib

SHELL = /bin/sh

#
#                      castor/tape/aggregator/Imakefile
#
# This file is part of the Castor project.
# See http://castor.web.cern.ch/castor
#
# Copyright (C) 2003  CERN
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#
# @author Steven Murray, Steven.Murray@cern.ch
#

CLIENTSDIR = client

COMMONDIR = common
CNVCPPDIR = cnv

UPVDIR = upv

HSMTOOLSDIR = hsmtools

NSDIR = ns

RFIODIR = rfio

RTCOPYDIR = rtcopy

STAGEDIR = stage

VDQMDIR = vdqm

VMGRDIR = vmgr

DLFDIR = dlf

RHCPPDIR = rh

VDQMCPPDIR = vdqm

AGGREGATORCPPDIR = aggregator
TAPECPPDIR = tape

COMMONCPPDIR = castor

ORACPPDIR = newora

DBCPPDIR = db

LIBDIR=lib
SHLIBDIR=shlib

DEBUG  = -g -O0

INCLUDES = -I ../../../h -I ../../..
CPPFLAGS = -DORATAPECONFIGFILE=\"/etc/castor/ORATAPECONFIG\" $(DEBUG) $(INCLUDES) $(MTCCFLAGS)
CFLAGS = -O -I$(INCLUDES) $(THREADFLAGS)

LIBS = -lshift -lcastorCnvs -Wl,-rpath-link,../../../shlib

AGGREGATORBIN_SRCS =   AggregatorDlfMessageStrings.cpp   AggregatorServer.cpp

MANPAGES_AGGREGATOR = $(MANDIR)/aggregatord.$(MANSUFFIX)
EMANPAGES_AGGREGATOR = $(EXPORTMAN)/man$(MANSUFFIX)/aggregatord.$(MANSUFFIX)

AGGREGATORBIN_OBJS = $(AGGREGATORBIN_SRCS:.cpp=.o)

DEPLIB = ../../../shlib/libshift.so

LDFLAGS += -L ../../../shlib $(MTLDFLAGS)
LD = g++

all: aggregatord

aggregatord: $(AGGREGATORBIN_OBJS) $(DEPLIB)
	$(LD) -o $@ $(LDFLAGS) $(AGGREGATORBIN_OBJS) $(LIBS)

../../shlib/libshift.so:	FORCE
	cd ../../shlib ; $(MAKE) libshift.so

Makefiles:

depend:
	makedepend $(INCLUDES) $(AGGREGATORBIN_SRCS) 2> /dev/null

install: $(BIN)/aggregatord

$(BIN)/aggregatord: $(INSUBDIR)aggregatord
	if [ "`whoami`" = "root" ]; then install -o root -g bin -m 750 $? $(DESTDIR)$(BIN); else install -m 750 $? $(DESTDIR)$(BIN); fi

install.man: $(MANDIR) $(MANPAGES_AGGREGATOR)

$(MANDIR):
	if [ "`whoami`" = "root" ]; then install -d $(DESTDIR)$(MANDIR) -o root -g bin -m 0755; else install -d $(DESTDIR)$(MANDIR) -m 0755; fi
$(MANDIR)/aggregatord.$(MANSUFFIX):	$(MANSUBDIR)aggregatord.man
	cat $(MANSUBDIR)aggregatord.man | perl -pe 's/^\.TH +([^ ]+) *\"?(\d+)\"?/\.TH $${1} \"$${2}castor\"/g' | perl -pe 's/^\.so \.?\/?(\w+)(.*)/\.so man'$(MANSUFFIX)'\/$${1}\.'$(MANSUFFIX)'castor/g' | nroff -man > $(MANDIR)/aggregatord.$(MANSUFFIX)castor

exportman: $(EMANPAGES_AGGREGATOR)

$(EXPORTMAN)/man$(MANSUFFIX)/aggregatord.$(MANSUFFIX):	$(MANSUBDIR)aggregatord.man
	cat $(MANSUBDIR)aggregatord.man | perl -pe 's/^.TH +([^ ]+) *\"?(\d+)\"?/\.TH $${1} \"$${2}castor\"/g' | perl -pe 's/^\.so \.?\/?(\w+)(.*)/\.so man'$(MANSUFFIX)'\/$${1}\.'$(MANSUFFIX)'castor/g' > $(EXPORTMAN)/man$(MANSUFFIX)/aggregatord.$(MANSUFFIX)castor

clean:
	@echo cleaning in `pwd`
	-@$(RM) -f *.o *.a *.so ,* .es1 core $(AGGREGATORBIN_OBJS)

clobber:	clean
	@echo clobbering in `pwd`
	-@$(RM) -f aggregatord

FORCE:

