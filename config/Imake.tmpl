/*
 * Copyright (C) 1993-1999 by CERN/IT/PDP/DM
 * All rights reserved
 */

/*
 * @(#)Imake.tmpl,v 1.5 2004/06/09 08:45:47 CERN IT-PDP/DM   Jean-Philippe Baud
 */

ifndef IMAKETMPL
  IMAKETMPL = 1

#define COMM	#
#define NO	0
#define YES	1
#include <site.def>

#ifdef linux
#include <linux.cf>
#else
#ifdef __APPLE__
#include <apple.cf>
#else
#include <Win32.cf>
#endif
#endif

DEBUG = -O0 -g
#define LOCAL_PATH __local_path__
#define PREFIX(VAR) __root_prefix__/**/_/**/VAR
CASTOR_ROOT = $(patsubst %/,%,$(dir $(patsubst %/,%,$(dir $(patsubst "%",%,__FILE__)))))
CC += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wextra -Werror
CXX += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wextra -Werror
CXXFLAGS += -I$(CASTOR_ROOT) -I$(CASTOR_ROOT)/h $(DEBUG)
CFLAGS += $(CXXFLAGS)
CPPFLAGS += -pthread -I$(CASTOR_ROOT) -I$(CASTOR_ROOT)/h
CPPFLAGS += -DBIN=\"InstallBinDir\" -DACCTFILE=SacctFile -DTPCONFIG=TapeConfigFile -DNFSROOT=NfsRoot
LDFLAGS += -pthread

PERLLIBDIR = /usr/lib/perl/CASTOR

PYTHONLIBS = $(shell python ${CASTOR_ROOT}/config/pycompile.py --libs)
PYTHONINC = $(shell python ${CASTOR_ROOT}/config/pycompile.py --inc)
PYTHONCFLAGS = $(shell python ${CASTOR_ROOT}/config/pycompile.py --cflags)
PYTHONLIBDIR = $(shell python -c "from distutils import sysconfig; print sysconfig.get_python_lib()")

ifneq ($(wildcard /etc/debian_version),)
  LIBDIR = /usr/lib
else
  LIBDIR = InstallLibDir
endif

#ifdef StagerSuperUser
STAGERSUPERUSER  = -DSTAGERSUPERUSER=StagerSuperUser
#endif
#ifdef StagerSuperGroup
STAGERSUPERGROUP = -DSTAGERSUPERGROUP=StagerSuperGroup
#endif

#include <Imake.rules>
#include <Project.tmpl>

endif

ifndef LOCAL_PATH
LOCAL_PATH = 1

.PHONY: PREFIX(clean) PREFIX(clobber) PREFIX(exportman)

clean : PREFIX(clean)
PREFIX(clean):
	RemoveFiles($(PREFIX(FilesToClean)))

clobber : PREFIX(clobber)
PREFIX(clobber): clean
	RemoveFiles($(PREFIX(FilesToClobber)))

exportman : PREFIX(exportman)

#include INCLUDE_IMAKEFILE

endif
