{% load userDefinedFilters %}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd" >
<html>
<head>
<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="PRIVATE">
<title>TreeMaps</title>

<script LANGUAGE="JavaScript">
//define global menu values

function DropDownPair(key, value)
{
	this.key = key;
	this.value = value;
}

function Modelmenu(levels,models,metrics,childrenmethods) 
{
	this.levels = levels;
	this.models = models;
	this.metrics = metrics;
	this.childrenmethods = childrenmethods;
}

menu = new Object();

function initMenu()
{
	levels = [];
	levels[0] = new DropDownPair('all levels', -1);
	levels[1] = new DropDownPair('level 0', 0);
	levels[2] = new DropDownPair('level 1', 1);
	levels[3] = new DropDownPair('level 2', 2);
	levels[4] = new DropDownPair('level 3', 3);
	levels[5] = new DropDownPair('level 4', 4);
	levels[6] = new DropDownPair('level 5', 5);
	levels[7] = new DropDownPair('level 6', 6);
	levels[8] = new DropDownPair('level 7', 7);
	
	models = [];
	models[0] = new DropDownPair("File", "CnsFileMetadata");
	models[1] = new DropDownPair("Directory", "Dirs");
	
	metrics = [];
	metrics[0] = new DropDownPair("fileid", "fileid");
	metrics[1] = new DropDownPair("parent", "parent");
	metrics[2] = new DropDownPair("name", "name");
	metrics[3] = new DropDownPair("depth", "depth");
	metrics[4] = new DropDownPair("fullname", "fullname");
	metrics[5] = new DropDownPair("totalsize", "totalsize");
	metrics[6] = new DropDownPair("sizeontape", "sizeontape");
	metrics[7] = new DropDownPair("dataontape", "dataontape");
	metrics[8] = new DropDownPair("nbfiles", "nbfiles");
	metrics[9] = new DropDownPair("nbtapes", "nbtapes");
	metrics[10] = new DropDownPair("nbfilesontape", "nbfilesontape");
	metrics[11] = new DropDownPair("nbfilecopiesontape", "nbfilecopiesontape");
	metrics[12] = new DropDownPair("nbsubdirs", "nbsubdirs");
	metrics[13] = new DropDownPair("oldestfilelastmod", "oldestfilelastmod");
	metrics[14] = new DropDownPair("avgfilelastmod", "avgfilelastmod");
	metrics[15] = new DropDownPair("sigfilelastmod", "sigfilelastmod");
	metrics[16] = new DropDownPair("newestfilelastmod", "newestfilelastmod");
	metrics[17] = new DropDownPair("avgfileontapelastmod", "avgfileontapelastmod");
	metrics[18] = new DropDownPair("sigfileontapelastmod", "sigfileontapelastmod");
	metrics[19] = new DropDownPair("newestfileontapelastmod", "newestfileontapelastmod");
	metrics[20] = new DropDownPair("timetomigrate", "timetomigrate");
	metrics[21] = new DropDownPair("timetorecall", "timetorecall");
	metrics[22] = new DropDownPair("timelostintapemarks", "timelostintapemarks");
	metrics[23] = new DropDownPair("opttimetorecall", "opttimetorecall");
	
	childrenmethods = [];
	childrenmethods[0] = new DropDownPair("getFiles", "getFiles");
	childrenmethods[1] = new DropDownPair("getDirs", "getDirs");
	childrenmethods[2] = new DropDownPair("getFilesAndFolders", "getFilesAndFolders");
	
	menu["Dirs"] = new Modelmenu(levels, models, metrics, childrenmethods);
	
	levels = [];
	levels[0] = new DropDownPair("all levels", -1);
	levels[1] = new DropDownPair("level 0", 0);
	levels[2] = new DropDownPair("level 1", 1);
	levels[3] = new DropDownPair("level 2", 2);
	levels[4] = new DropDownPair("level 3", 3);
	levels[5] = new DropDownPair("level 4", 4);
	levels[6] = new DropDownPair("level 5", 5);
	levels[7] = new DropDownPair("level 6", 6);
	levels[8] = new DropDownPair("level 7", 7);
	
	models = [];
	models[0] = new DropDownPair("File", "CnsFileMetadata");
	models[1] = new DropDownPair("Directory", "Dirs");
	
	metrics = [];
	metrics[0] = new DropDownPair("fileid", "fileid");
	metrics[1] = new DropDownPair("parent_fileid", "parent_fileid");
	metrics[2] = new DropDownPair("name", "name");
	metrics[3] = new DropDownPair("filemode", "filemode");
	metrics[4] = new DropDownPair("nlink", "nlink");
	metrics[5] = new DropDownPair("owner_uid", "owner_uid");
	metrics[6] = new DropDownPair("gid", "gid");
	metrics[7] = new DropDownPair("filesize", "atime");
	metrics[8] = new DropDownPair("atime", "atime");
	metrics[9] = new DropDownPair("mtime", "mtime");
	metrics[10] = new DropDownPair("ctime", "ctime");
	metrics[11] = new DropDownPair("status", "status");
	metrics[12] = new DropDownPair("fileclass", "fileclass");
	metrics[13] = new DropDownPair("guid", "guid");
	metrics[14] = new DropDownPair("csumtype", "csumvalue");
	metrics[15] = new DropDownPair("acl", "acl");
	
	childrenmethods = [];
	childrenmethods[0] = new DropDownPair("getChildren", "getChildren");
	
	menu["CnsFileMetadata"] = new Modelmenu(levels, models, metrics, childrenmethods);

	activateJsObjects()
}

function activateJsObjects()
{
	var optmenu = document.getElementsByName("optionsmenu")[0];
	optmenu.style.display = "inline"
}

function notImplementedWarning()
{
	alert("Not implemented yet");
}

function setModel()
{
	modelsmenu = document.getElementsByName("model")[0];
	selected = modelsmenu.options[modelsmenu.selectedIndex].value
	newmenu = menu[selected];

	//levelsmenu
	levelsmenu = document.getElementsByName("level")[0];
	levelsmenu.options.length = 0
	for (var i = 0; i < newmenu.levels.length; i++)
		levelsmenu.options.add(new Option(newmenu.levels[i].key, newmenu.levels[i].value))
		
	//modelsmenu
	modelsmenu = document.getElementsByName("model")[0];
	modelsmenu.options.length = 0
	for (var i = 0; i < newmenu.models.length; i++)
	{	
		modelsmenu.options.add(new Option(newmenu.models[i].key, newmenu.models[i].value))
		if (newmenu.models[i].value == selected)
			modelsmenu.selectedIndex = i
	}

	//metricsmenu
	metricsmenu = document.getElementsByName("metric")[0];
	metricsmenu.options.length = 0
	for (var i = 0; i < newmenu.metrics.length; i++)
		metricsmenu.options.add(new Option(newmenu.metrics[i].key, newmenu.metrics[i].value))
		
	//childrenmenu
	childrenmenu = document.getElementsByName("childmethod")[0];
	childrenmenu.options.length = 0
	for (var i = 0; i < newmenu.childrenmethods.length; i++)
		childrenmenu.options.add(new Option(newmenu.childrenmethods[i].key, newmenu.childrenmethods[i].value))	 	
		
	//alert("Changing to " + modelsmenu.options[modelsmenu.selectedIndex].value + " not implemented yet!");
	//window.open('updatemodel=' + this.options[this.selectedIndex].value,'_top')
	//optmenu.style.display = "inline"
}
</script>

</head>
<body bgcolor="#1F1F1F" text = "#7F7F7F" link = "#FFFFFF" vlink = "#7F7F7F" alink = "#000000" onload="initMenu()">
    {% if nodes %}

    <p><table style="width: auto; height: auto;" align="center">
    
    <tr>
      <td align="center" valign="middle">
    	<p><a href="/treemaps/bydir/{{parentid}}"> <img border="0" title="one level back" src="{{icondir}}/arrow.png"></a></p>
      </td>
    </tr>
    
    
    <tr>
    <td align="center" valign="middle" width={{imagewidth}} style="height: auto">     	
        	<ul id="map">
 			{% for x1, y1 ,x2 ,y2, theid, info in mapparams %}
					<li>
						<a class="cls{{theid}}" href="/treemaps/bydir/{{theid}}" title = "">
							<span>
								{{ info|escapefilter }}
							</span>
						</a>
					</li>
        	{% endfor %}
        	</ul> 
 
		
		        <style type="text/css">
					#map {
						position:relative;
						margin:0;
						padding:0;
						width:{{imagewidth}}px;
						height:{{imageheight}}px;
						background:url({{treemapdir}}/{{filename}}) top left no-repeat #fff;
						font-family:arial, helvetica, sans-serif;
						font-size:{{tooltipfontsize}}pt;
						color:#FFF;
						text-align: left;
					}
					
					#map li {
						margin:0;
						padding:0;
						list-style:none;
					}
					
					#map li a {
						position:absolute;
						display:block;
						/*style="width: auto"
						   Specifying a background image
						   (a 1px by 1px transparent gif)
						   fixes a bug in older versions of
						   IE that causeses the block to not
						   render at its full dimensions.
						*/
			   			background:url({{icondir}}/blank.gif);
			   			text-decoration:none;
						color:#000;
					}
					
					#map li a span { display:none; }
					
				{% for shiftx, shifty, twidth, theight, theid in tooltipshift %}
					#map li a.cls{{theid}}:hover span 
					{
						position:relative;
						display:block;
						width:{{twidth}}px;
						height:{{theight}}px;
						left:{{shiftx}}px;
						top:{{shifty}}px;
						border:1px solid #000;
						background:#fff;
						padding:5px;
			 			filter:alpha(opacity=70);
						opacity:0.8;
			  		}
			  	{% endfor %}
				
				{% for x1, y1 ,x2 ,y2, theid, info in mapparams %}
					#map a.cls{{theid}} 
					{
						top:{{y1}}px;
						left:{{x1}}px;
						width:{{x2|sub:x1}}px;
						height:{{y2|sub:y1}}px;
					}
				{% endfor %}
				
			   </style>  
		   
	   <br>{% for dirname, flname, theid in navilink %}<a href="/treemaps/bydir/{{theid}}" title = {{flname}}>{{dirname}}</a>{% if forloop.counter0 %}/{% endif %}{% endfor %}
	</td>	
		<td name = "optionsmenu" align="left" valign="top" height={{imageheight}} style="display:none;">	
		
		<!--  make the menu visible if JavaScript is activated -->
			<table>
				<form action="/treemaps/bydir/{{rootid}}/changemetrics/" method="post" onsubmit="notImplementedWarning()">
				
					<tr>
					<td class="descriptiontext">Level:</td> 
					
					<td><select class="dmenuwidth" name="level" id="id_level">
						{% for value, name in leveldropdown %}
							<option value="{{value}}">{{name}}</option>
						{% endfor %}
					</select></td></tr>
					
					<tr>
					<td class="descriptiontext">Model:</td>
					<td><select class="dmenuwidth" name="model" id="id_model" onchange="setModel()">
						{% for value, name in modeldropdown %}
							<option value="{{value}}">{{name}}</option>
						{% endfor %}
					</select></td></tr>
					
					<tr>
					<td class="descriptiontext">Metric:</td>
					<td><select class="dmenuwidth" name="metric" id="id_metric">
						{% for value, name in metricdropdown %}
							<option value="{{value}}">{{name}}</option>
						{% endfor %}
					</select></td></tr>
					
					<tr>
					<td class="descriptiontext">Getting children:</td>
					<td><select class="dmenuwidth" name="childmethod" id="id_childmethod">
						{% for value, name in childmethoddropdown %}
							<option value="{{value}}">{{name}}</option>
						{% endfor %}
					</select></td></tr>
					<tr><td>
						<br>
						<input class="applybutton" type="submit" value="Apply"/>
					</td></tr>
				</form>

			</table>
		</td>	
		<noscript>
			<div style="color:#FF0000" align = "center">
				This page requires JavaScript! <br>
				Please enable JavaScript and reload the page
			</div>
		</noscript>
		
	</tr></table></p>
    {% else %}
        <p>No data available / A file or an empty folder</p>
    {% endif %}

    <style type="text/css">
     .dmenuwidth {
     width:200px;
     background-color:#1F1F1F;
     color:#7F7F7F;
     }
    </style>
    
    <style type="text/css">
     .descriptiontext {
		font-size: 14px;
		color:#CFCFCF;
     }
    </style>
    
    <style type="text/css">
     .applybutton {
     background-color:#000000;
     color:#FF0000;
     }
    </style>


<!--
<style type="text/css">
	<!--
	img {border:none;}
	
	#box
	{
		height:500px;
		width:500px;
		padding:0;
		margin:20px;
		border:1px solid black;
		font:bold 14px verdana, sans-serif;
	}
	
	#box div{display:none;}
	
	#box:hover div
	{
		display:block;
		width:300px;
		position:absolute;top:20px;right:20px;
		border:1px dashed black;
		padding:15px;
		font:normal 14px verdana, sans-serif;
	}
	-->
</style>

<div id="box"><a href="info.htm"><img src="bild.png" width="80" height="80" alt=""></a>
	<div>
	<p><strong>INFO</strong></p>
	<p>Lorem ipsum dolor sit amet. <br> And so on... </p>
	</div>
</div>
-->

</body>
</html>
