COMM
COMM  Copyright (C) 1999-2003 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)Imakefile,v 1.51 2004/06/09 16:10:35 CERN IT-PDP/DM Jean-Philippe Baud

COMM    Make name server programs.

CNS_HOST = NsHost
SCNS_HOST = SNsHost
CNSHOSTPFX = NsHostPfx
SCNSHOSTPFX = SNsHostPfx

INCLUDES = ../h
LIBS = -luuid
NSLIB = -L. -lcastorns
SPOOL = NsSpool
LOGFILE = $(SPOOL)/log
SACCTDIR = SacctDir
SACCTFILE = SacctDir/sacct
ACCTFILE = -DACCTFILE=\"$(SACCTFILE)\"
LCGDM_MAPFILE = IdMapFile
NSCONFIG = NsConfigFile
ORAFLG = -DUSE_ORACLE
ORAINC = -I$(ORACLE_HOME)/precomp/public

#if BuildSecurity
SECURITYFLAG = -DCSEC
#if UseGSI
GLOBUS_LOCATION=GlobusLocation
#if defined(__STDC__)
GLOBUS_FLAVOUR=GlobusFlavour##pthr
#else
GLOBUS_FLAVOUR=GlobusFlavour/**/pthr
#endif
GLOBUS_LIBS=-L$(GLOBUS_LOCATION)/lib -lcrypto_$(GLOBUS_FLAVOUR)
LIBCSEC += $(GLOBUS_LIBS)
#endif
LIBCSEC += -ldl
#endif

DFLAGS = -DBIN=\"$(BIN)\" -DCNS_HOST=\"$(CNS_HOST)\" \
         -DSCNS_HOST=\"$(SCNS_HOST)\" \
         -DCNSHOSTPFX=\"$(CNSHOSTPFX)\" \
         -DSCNSHOSTPFX=\"$(SCNSHOSTPFX)\" \
         -DLCGDM_MAPFILE=\"$(LCGDM_MAPFILE)\" \
         -DLOGFILE=\"$(LOGFILE)\" \
         -DNSCONFIG=\"$(NSCONFIG)\" \
         $(ACCTFLAG) $(ACCTFILE) $(RDSFLG) $(ORAFLG)

CFLAGS = -g -I$(INCLUDES) $(MTCCFLAGS) $(DFLAGS) $(RDSINC) $(ORAINC) $(SECURITYFLAG)

NSDAEMON_OBJS	=	Cns_main.Osuf \
			Cns_acl.Osuf \
			Cns_chkperm.Osuf \
			Cns_oracle_ifce.Osuf \
			Cns_procreq.Osuf \
			sendrep.Osuf \
			nslogit.Osuf
NSLIB_OBJS	=	Cns_aborttrans.Osuf \
                        Cns_access.Osuf \
                        Cns_addreplica.Osuf \
                        Cns_apiinit.Osuf \
                        Cns_auth.Osuf \
                        Cns_bulkexist.Osuf \
                        Cns_chclass.Osuf \
                        Cns_chdir.Osuf \
                        Cns_chmod.Osuf \
                        Cns_chown.Osuf \
                        Cns_closedir.Osuf \
                        Cns_creat.Osuf \
                        Cns_delcomment.Osuf \
                        Cns_delete.Osuf \
                        Cns_deleteclass.Osuf \
                        Cns_delreplica.Osuf \
                        Cns_du.Osuf \
                        Cns_endsess.Osuf \
                        Cns_endtrans.Osuf \
                        Cns_enterclass.Osuf \
                        Cns_errmsg.Osuf \
                        Cns_getacl.Osuf \
                        Cns_getcomment.Osuf \
                        Cns_getcwd.Osuf \
                        Cns_getlinks.Osuf \
                        Cns_getpath.Osuf \
                        Cns_getreplica.Osuf \
                        Cns_getsegattrs.Osuf \
                        Cns_lastfseq.Osuf \
                        Cns_listclass.Osuf \
                        Cns_listtape.Osuf \
                        Cns_listlinks.Osuf \
                        Cns_listrep4gc.Osuf \
                        Cns_listreplica.Osuf \
                        Cns_listreplicax.Osuf \
                        Cns_mkdir.Osuf \
                        Cns_modifyclass.Osuf \
                        Cns_opendir.Osuf \
                        Cns_ping.Osuf \
                        Cns_queryclass.Osuf \
                        Cns_readdir.Osuf \
                        Cns_readdirc.Osuf \
                        Cns_readdirg.Osuf \
                        Cns_readdirx.Osuf \
                        Cns_readdirxc.Osuf \
                        Cns_readdirxr.Osuf \
                        Cns_readdirxt.Osuf \
                        Cns_readlink.Osuf \
                        Cns_rename.Osuf \
                        Cns_rewinddir.Osuf \
                        Cns_replaceseg.Osuf \
                        Cns_replacetapecopy.Osuf \
                        Cns_rmdir.Osuf \
                        Cns_selectsrvr.Osuf \
                        Cns_setacl.Osuf \
                        Cns_setatime.Osuf \
                        Cns_setcomment.Osuf \
                        Cns_setfsize.Osuf \
                        Cns_setsegattrs.Osuf \
                        Cns_setptime.Osuf \
                        Cns_setratime.Osuf \
                        Cns_setrstatus.Osuf \
                        Cns_startsess.Osuf \
                        Cns_starttrans.Osuf \
                        Cns_stat.Osuf \
                        Cns_symlink.Osuf \
                        Cns_tapesum.Osuf \
                        Cns_umask.Osuf \
                        Cns_undelete.Osuf \
                        Cns_unlink.Osuf \
                        Cns_updateseg_checksum.Osuf \
                        Cns_updateseg_status.Osuf \
                        Cns_updatefile_checksum.Osuf \
                        Cns_utime.Osuf \
                        send2nsd.Osuf

DependsOnLibrary(common,castorcommon)
DependsOnLibrary(dlf,castordlf)
DependsOnLibrary(upv,castorupv)
DependsOnLibrary(security,castorsecurity)

#if BuildNameServerLibrary
SharedLibraryTarget(castorns,$(NSLIB_OBJS),$(DEPLIB),$(LIBS))
#endif

#if BuildNameServerDaemon
Cns_oracle_ifce.c: Cns_oracle_ifce.pc
	proc iname=Cns_oracle_ifce include=$(INCLUDES) threads=yes char_map=string parse=full
FilesToClean += Cns_oracle_ifce.c Cns_oracle_ifce.lis
MakeDir($(SPOOL),root,bin,0755)
MakeDir($(SACCTDIR),root,bin,0777)
ORALIBS= -L$(ORACLE_HOME)/lib -lclntsh
NormalProgramTarget(nsdaemon,$(NSDAEMON_OBJS), $(DEPLIB), $(ORALIBS) $(MTLDFLAGS) $(LIBS) $(LIBCSEC),root,bin,750)
ADMMANPAGE(nsdaemon)
#endif

#if BuildNameServerClient
NSDEP = SharedLibraryTargetName(castorns)
NormalProgramTarget(nschclass,nschclass.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nschmod,nschmod.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nschown,nschown.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsdelcomment,nsdelcomment.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsdeleteclass,nsdeleteclass.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsenterclass,nsenterclass.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsfind,nsfind.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsgetacl,nsgetacl.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsgetpath,nsgetpath.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nslistclass,nslistclass.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nslisttape,nslisttape.Osuf,$(NSDEP) $(DEPLIB), $(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsln,nsln.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsls,nsls.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsmkdir,nsmkdir.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsmodifyclass,nsmodifyclass.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsping,nsping.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsrename,nsrename.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsrm,nsrm.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nsrmdir,nsrmdir.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nssetchecksum,nssetchecksum.Osuf,$(NSDEP) $(DEPLIB), $(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nssetacl,nssetacl.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nssetcomment,nssetcomment.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nssetsegment,nssetsegment.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
NormalProgramTarget(nstouch,nstouch.Osuf,$(NSDEP) $(DEPLIB),$(NSLIB) $(LIBS),root,bin,755)
#endif

LIBMANPAGE(Cns_aborttrans)
LIBMANPAGE(Cns_access)
LIBMANPAGE(Cns_addreplica)
LIBMANPAGE(Cns_chclass)
LIBMANPAGE(Cns_chdir)
LIBMANPAGE(Cns_chmod)
LIBMANPAGE(Cns_chown)
LIBMANPAGE(Cns_closedir)
LIBMANPAGE(Cns_creat)
LIBMANPAGE(Cns_creatg)
LIBMANPAGE(Cns_delcomment)
LIBMANPAGE(Cns_delete)
LIBMANPAGE(Cns_deleteclass)
LIBMANPAGE(Cns_delreplica)
LIBMANPAGE(Cns_endsess)
LIBMANPAGE(Cns_endtrans)
LIBMANPAGE(Cns_enterclass)
LIBMANPAGE(Cns_getacl)
LIBMANPAGE(Cns_getcomment)
LIBMANPAGE(Cns_getcwd)
LIBMANPAGE(Cns_getsegattrs)
LIBMANPAGE(Cns_lastfseq)
LIBMANPAGE(Cns_listclass)
LIBMANPAGE(Cns_listtape)
LIBMANPAGE(Cns_listlinks)
LIBMANPAGE(Cns_listreplica)
LIBMANPAGE(Cns_mkdir)
LIBMANPAGE(Cns_mkdirg)
LIBMANPAGE(Cns_modifyclass)
LIBMANPAGE(Cns_opendir)
LIBMANPAGE(Cns_opendirg)
LIBMANPAGE(Cns_ping)
LIBMANPAGE(Cns_queryclass)
LIBMANPAGE(Cns_readdir)
LIBMANPAGE(Cns_readdirc)
LIBMANPAGE(Cns_readdirg)
LIBMANPAGE(Cns_readdirx)
LIBMANPAGE(Cns_readdirxc)
LIBMANPAGE(Cns_readdirxt)
LIBMANPAGE(Cns_readlink)
LIBMANPAGE(Cns_rename)
LIBMANPAGE(Cns_replaceseg)
LIBMANPAGE(Cns_rewinddir)
LIBMANPAGE(Cns_rmdir)
LIBMANPAGE(Cns_selectsrvr)
LIBMANPAGE(Cns_setacl)
LIBMANPAGE(Cns_setatime)
LIBMANPAGE(Cns_setcomment)
LIBMANPAGE(Cns_setfsize)
LIBMANPAGE(Cns_setsegattrs)
LIBMANPAGE(Cns_startsess)
LIBMANPAGE(Cns_starttrans)
LIBMANPAGE(Cns_stat)
LIBMANPAGE(Cns_statg)
LIBMANPAGE(Cns_statr)
LIBMANPAGE(Cns_symlink)
LIBMANPAGE(Cns_tapesum)
LIBMANPAGE(Cns_umask)
LIBMANPAGE(Cns_undelete)
LIBMANPAGE(Cns_unlink)
LIBMANPAGE(Cns_updateseg_checksum)
LIBMANPAGE(Cns_updateseg_status)
LIBMANPAGE(Cns_updatefile_checksum)
LIBMANPAGE(Cns_utime)
EXEMANPAGE(nschclass)
EXEMANPAGE(nschmod)
EXEMANPAGE(nschown)
EXEMANPAGE(nsdelcomment)
EXEMANPAGE(nsdeleteclass)
EXEMANPAGE(nsenterclass)
EXEMANPAGE(nsfind)
EXEMANPAGE(nsgetacl)
EXEMANPAGE(nsgetpath)
EXEMANPAGE(nslistclass)
EXEMANPAGE(nslisttape)
EXEMANPAGE(nsln)
EXEMANPAGE(nsls)
EXEMANPAGE(nsmkdir)
EXEMANPAGE(nsmodifyclass)
EXEMANPAGE(nsping)
EXEMANPAGE(nsrename)
EXEMANPAGE(nsrm)
EXEMANPAGE(nsrmdir)
EXEMANPAGE(nssetchecksum)
EXEMANPAGE(nssetacl)
EXEMANPAGE(nssetcomment)
EXEMANPAGE(nssetsegment)
EXEMANPAGE(nstouch)
