COMM
COMM  Copyright (C) 1999-2003 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)Imakefile,v 1.51 2004/06/09 16:10:35 CERN IT-PDP/DM Jean-Philippe Baud

COMM    Make name server programs.

NSLIB = DepSharedLibraryTargetName(ns,castorns)
AddLdFlags(-luuid)

#if UseGSI
GLOBUS_FLAVOUR=GlobusFlavour/**/pthr
NSLIBCSEC += -L$(GLOBUS_LOCATION)/lib $(shell if [ -r "$(GLOBUS_LOCATION)/lib/libcrypto_$(GLOBUS_FLAVOUR).so" ]; then echo -lcrypto_$(GLOBUS_FLAVOUR); else echo -lcrypto; fi)
#endif
NSLIBCSEC += -ldl

CPPFLAGS += -DCNS_HOST=NsHost -DSCNS_HOST=SNsHost \
            -DCNSHOSTPFX=NsHostPfx -DSCNSHOSTPFX=SNsHostPfx \
            -DLCGDM_MAPFILE=\"IdMapFile\" \
            -DNSLOGFILE=NsLogFile -DNSCONFIG=NsConfigFile \
	    -I$(ORACLE_HOME)/precomp/public

NSD_OBJS	=	Cns_main.o \
			Cns_acl.o \
			Cns_chkperm.o \
			Cns_oracle_ifce.o \
			Cns_procreq.o \
			sendrep.o \
			nslogit.o
NSLIB_OBJS	=	Cns_aborttrans.o \
                        Cns_access.o \
                        Cns_apiinit.o \
                        Cns_auth.o \
                        Cns_bulkexist.o \
                        Cns_chclass.o \
                        Cns_chdir.o \
                        Cns_chmod.o \
                        Cns_chown.o \
                        Cns_closedir.o \
                        Cns_creat.o \
                        Cns_delcomment.o \
                        Cns_delete.o \
                        Cns_deleteclass.o \
                        Cns_dropsegs.o \
                        Cns_delsegbycopyno.o \
                        Cns_du.o \
                        Cns_endsess.o \
                        Cns_endtrans.o \
                        Cns_enterclass.o \
                        Cns_errmsg.o \
                        Cns_getacl.o \
                        Cns_getcomment.o \
                        Cns_getcwd.o \
                        Cns_getlinks.o \
                        Cns_getpath.o \
                        Cns_getsegattrs.o \
                        Cns_lastfseq.o \
                        Cns_listclass.o \
                        Cns_listtape.o \
                        Cns_listlinks.o \
                        Cns_mkdir.o \
                        Cns_modifyclass.o \
                        Cns_opendir.o \
                        Cns_ping.o \
                        Cns_queryclass.o \
                        Cns_readdir.o \
                        Cns_readdirc.o \
                        Cns_readdirg.o \
                        Cns_readdirx.o \
                        Cns_readdirxc.o \
                        Cns_readdirxt.o \
                        Cns_readlink.o \
                        Cns_rename.o \
                        Cns_rewinddir.o \
                        Cns_replaceseg.o \
                        Cns_replacetapecopy.o \
                        Cns_rmdir.o \
                        Cns_selectsrvr.o \
                        Cns_setacl.o \
                        Cns_setatime.o \
                        Cns_setcomment.o \
                        Cns_setfsize.o \
                        Cns_setsegattrs.o \
                        Cns_startsess.o \
                        Cns_starttrans.o \
                        Cns_stat.o \
                        Cns_symlink.o \
                        Cns_tapesum.o \
                        Cns_umask.o \
                        Cns_undelete.o \
                        Cns_unlink.o \
                        Cns_unlinkbyvid.o \
                        Cns_updateseg_checksum.o \
                        Cns_updateseg_status.o \
                        Cns_updatefile_checksum.o \
                        Cns_utime.o \
                        send2nsd.o

CommonDependsOnLibrary(common,castorcommon)
CommonDependsOnLibrary(security,castorsecurity)
ClientSharedLibraryTarget(castorns,$(NSLIB_OBJS),,)

ClientProgramTarget(nschclass,nschclass.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nschmod,nschmod.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nschown,nschown.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsdelcomment,nsdelcomment.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsdeleteclass,nsdeleteclass.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsdelsegment,nsdelsegment.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsenterclass,nsenterclass.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsfind,nsfind.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsgetacl,nsgetacl.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsgetpath,nsgetpath.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nslistclass,nslistclass.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nslisttape,nslisttape.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsln,nsln.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsls,nsls.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsmkdir,nsmkdir.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsmodifyclass,nsmodifyclass.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsping,nsping.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsrename,nsrename.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsrm,nsrm.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsrmdir,nsrmdir.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nsrmvid,nsrmvid.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nssetchecksum,nssetchecksum.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nssetacl,nssetacl.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nssetcomment,nssetcomment.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nssetfsize,nssetfsize.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nssetsegment,nssetsegment.o,$(NSLIB),$(NSLIB),755)
ClientProgramTarget(nstouch,nstouch.o,$(NSLIB),$(NSLIB),755)

CLIENTLIBMANPAGE(Cns_aborttrans)
CLIENTLIBMANPAGE(Cns_access)
CLIENTLIBMANPAGE(Cns_chclass)
CLIENTLIBMANPAGE(Cns_chdir)
CLIENTLIBMANPAGE(Cns_chmod)
CLIENTLIBMANPAGE(Cns_chown)
CLIENTLIBMANPAGE(Cns_closedir)
CLIENTLIBMANPAGE(Cns_creat)
CLIENTLIBMANPAGE(Cns_creatg)
CLIENTLIBMANPAGE(Cns_delcomment)
CLIENTLIBMANPAGE(Cns_delete)
CLIENTLIBMANPAGE(Cns_deleteclass)
CLIENTLIBMANPAGE(Cns_dropsegs)
CLIENTLIBMANPAGE(Cns_delsegbycopyno)
CLIENTLIBMANPAGE(Cns_endsess)
CLIENTLIBMANPAGE(Cns_endtrans)
CLIENTLIBMANPAGE(Cns_enterclass)
CLIENTLIBMANPAGE(Cns_getacl)
CLIENTLIBMANPAGE(Cns_getcomment)
CLIENTLIBMANPAGE(Cns_getcwd)
CLIENTLIBMANPAGE(Cns_getsegattrs)
CLIENTLIBMANPAGE(Cns_lastfseq)
CLIENTLIBMANPAGE(Cns_listclass)
CLIENTLIBMANPAGE(Cns_listtape)
CLIENTLIBMANPAGE(Cns_listlinks)
CLIENTLIBMANPAGE(Cns_mkdir)
CLIENTLIBMANPAGE(Cns_mkdirg)
CLIENTLIBMANPAGE(Cns_modifyclass)
CLIENTLIBMANPAGE(Cns_opendir)
CLIENTLIBMANPAGE(Cns_opendirg)
CLIENTLIBMANPAGE(Cns_ping)
CLIENTLIBMANPAGE(Cns_queryclass)
CLIENTLIBMANPAGE(Cns_readdir)
CLIENTLIBMANPAGE(Cns_readdirc)
CLIENTLIBMANPAGE(Cns_readdirg)
CLIENTLIBMANPAGE(Cns_readdirx)
CLIENTLIBMANPAGE(Cns_readdirxc)
CLIENTLIBMANPAGE(Cns_readdirxt)
CLIENTLIBMANPAGE(Cns_readlink)
CLIENTLIBMANPAGE(Cns_rename)
CLIENTLIBMANPAGE(Cns_replaceseg)
CLIENTLIBMANPAGE(Cns_rewinddir)
CLIENTLIBMANPAGE(Cns_rmdir)
CLIENTLIBMANPAGE(Cns_selectsrvr)
CLIENTLIBMANPAGE(Cns_setacl)
CLIENTLIBMANPAGE(Cns_setatime)
CLIENTLIBMANPAGE(Cns_setcomment)
CLIENTLIBMANPAGE(Cns_setfsize)
CLIENTLIBMANPAGE(Cns_setsegattrs)
CLIENTLIBMANPAGE(Cns_startsess)
CLIENTLIBMANPAGE(Cns_starttrans)
CLIENTLIBMANPAGE(Cns_stat)
CLIENTLIBMANPAGE(Cns_statg)
CLIENTLIBMANPAGE(Cns_symlink)
CLIENTLIBMANPAGE(Cns_tapesum)
CLIENTLIBMANPAGE(Cns_umask)
CLIENTLIBMANPAGE(Cns_undelete)
CLIENTLIBMANPAGE(Cns_unlink)
CLIENTLIBMANPAGE(Cns_unlinkbyvid)
CLIENTLIBMANPAGE(Cns_updateseg_checksum)
CLIENTLIBMANPAGE(Cns_updateseg_status)
CLIENTLIBMANPAGE(Cns_updatefile_checksum)
CLIENTLIBMANPAGE(Cns_utime)
CLIENTEXEMANPAGE(nschclass)
CLIENTEXEMANPAGE(nschmod)
CLIENTEXEMANPAGE(nschown)
CLIENTEXEMANPAGE(nsdelcomment)
CLIENTEXEMANPAGE(nsdeleteclass)
CLIENTEXEMANPAGE(nsdelsegment)
CLIENTEXEMANPAGE(nsenterclass)
CLIENTEXEMANPAGE(nsfind)
CLIENTEXEMANPAGE(nsgetacl)
CLIENTEXEMANPAGE(nsgetpath)
CLIENTEXEMANPAGE(nslistclass)
CLIENTEXEMANPAGE(nslisttape)
CLIENTEXEMANPAGE(nsln)
CLIENTEXEMANPAGE(nsls)
CLIENTEXEMANPAGE(nsmkdir)
CLIENTEXEMANPAGE(nsmodifyclass)
CLIENTEXEMANPAGE(nsping)
CLIENTEXEMANPAGE(nsrename)
CLIENTEXEMANPAGE(nsrm)
CLIENTEXEMANPAGE(nsrmdir)
CLIENTEXEMANPAGE(nsrmvid)
CLIENTEXEMANPAGE(nssetchecksum)
CLIENTEXEMANPAGE(nssetacl)
CLIENTEXEMANPAGE(nssetcomment)
CLIENTEXEMANPAGE(nssetfsize)
CLIENTEXEMANPAGE(nssetsegment)
CLIENTEXEMANPAGE(nstouch)

DependsOnLibrary(upv,castorupv)
DependsOnLibrary(dlf,castordlf)

PROC(Cns_oracle_ifce)
MakeDir(LogPath,0755)
NSORALIBS= -L$(ORACLE_HOME)/lib -lclntsh

NormalProgramTarget(nsd,$(NSD_OBJS),,$(NSORALIBS) $(NSLIBCSEC),750)
ADMMANPAGE(nsd)
LOGROTATE(castor-ns-server,install)
SYSCONFIG(nsd,install)
INITSCRIPT(nsd,install)
CONFIGFILE(NS,install)
