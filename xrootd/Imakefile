COMM
COMM                    xrootd/Imakefile
COMM
COMM This file is part of the Castor project.
COMM See http://castor.web.cern.ch/castor
COMM
COMM Copyright (C) 2012  CERN
COMM This program is free software; you can redistribute it and/or
COMM modify it under the terms of the GNU General Public License
COMM as published by the Free Software Foundation; either version 2
COMM of the License, or (at your option) any later version.
COMM This program is distributed in the hope that it will be useful,
COMM but WITHOUT ANY WARRANTY; without even the implied warranty of
COMM MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
COMM GNU General Public License for more details.
COMM You should have received a copy of the GNU General Public License
COMM along with this program; if not, write to the Free Software
COMM Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
COMM
COMM
COMM @author castor-dev@cern.ch
COMM

CPPFLAGS += -I$(XROOT_LOCATION)/include/xrootd -I$(XROOT_LOCATION)/include/xrootd/private 

AddLdFlags( -L$(XROOT_LIB_LOCATION) -lstdc++ )

XCASTOR2FS_SRCS= XrdxCastor2Fs.cpp        \
                 XrdxCastor2FsConfig.cpp  \
	         XrdxCastor2FsStats.cpp   \
	         XrdxCastor2ServerAcc.cpp \
                 XrdxCastor2Stager.cpp    \
                 XrdxCastor2Proc.cpp      \
                 XrdxCastorLogging.cpp    \
                 XrdxCastorTiming.cpp     \
                 XrdxCastorClient.cpp

XCASTOR2FS_OBJS=$(XCASTOR2FS_SRCS:.cpp=.o)

DependsOnLibrary(common,castorcommon)
DependsOnLibrary(castor,castorclient)
DependsOnLibrary(ns,castorns)


COMPILECPP(XrdxCastor2Fs.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)        
COMPILECPP(XrdxCastor2FsConfig.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdxCastor2FsStats.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)  
COMPILECPP(XrdxCastor2ServerAcc.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error) 
COMPILECPP(XrdxCastor2Stager.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)    
COMPILECPP(XrdxCastor2Proc.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)      
COMPILECPP(XrdxCastorLogging.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)    
COMPILECPP(XrdxCastorTiming.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdxCastorClient.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)

SharedLibraryTarget(XrdxCastor2Fs,$(XCASTOR2FS_OBJS),,-lXrdUtils -lXrdCl -lXrdClient -lXrdOfs -l UUIDLIBNAME -lcrypto -lrt)


XCASTOR2SERVERACC_SRCS= XrdxCastor2ServerAcc.cpp \
                        XrdxCastorTiming.cpp

XCASTOR2SERVERACC_OBJS=$(XCASTOR2SERVERACC_SRCS:.cpp=.o)
SharedLibraryTarget(XrdxCastor2ServerAcc,$(XCASTOR2SERVERACC_OBJS),,-lXrdUtils -lcrypto -lrt)


XCASTOR2OFS_SRCS= XrdxCastor2Ofs.cpp         \
	          XrdxCastor2OfsFSctl.cpp    \
                  XrdxCastor2OfsTransfer.cpp \
                  XrdxCastor2OfsProc.cpp     \
                  XrdTransfer.cpp            \
                  XrdTransferManager.cpp     \
                  XrdxCastorLogging.cpp      \
                  XrdxCastorTiming.cpp

XCASTOR2OFS_OBJS=$(XCASTOR2OFS_SRCS:.cpp=.o)

COMPILECPP(XrdxCastor2Ofs.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdxCastor2OfsFSctl.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdxCastor2OfsTransfer.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdxCastor2OfsProc.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdTransfer.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)
COMPILECPP(XrdTransferManager.cpp, -D_FILE_OFFSET_BITS=64 -Wno-error)

SharedLibraryTarget(XrdxCastor2Ofs,$(XCASTOR2OFS_OBJS),,-lXrdUtils -lXrdOfs -lXrdCl -lXrdClient -l UUIDLIBNAME -lcrypto -lz -lrt)

XRDTRANSFER_SRCS=XrdTransfer.cpp
XRDTRANSFER_OBJS=$(XRDTRANSFER_SRCS:.cpp=.o)
NormalProgramTarget(XrdTransfer,$(XRDTRANSFER_OBJS),,-lXrdUtils -lXrdClient -lcrypto,755)

InstallNonExecFile(x2proc,/usr/bin,755)
InstallNonExecFile(x2cp,/usr/bin,755)
InstallNonExecFile(xrd-logs,/etc/cron.d,775)
InstallNonExecFile(xrd.cf.server.example,/etc,744)
InstallNonExecFile(xrd.cf.manager.example,/etc,744)
SYSCONFIG(xrootd.server,install)
SYSCONFIG(xrootd.manager,install)

MakeDir(/var/log/xrootd/manager,755)
MakeDir(/var/log/xrootd/server,755)
MakeDir(/var/log/xrootd/manager/proc,755)
MakeDir(/var/log/xrootd/server/proc,755)
MakeDir(/var/spool/xrootd/admin,755)
MakeDir(/var/spool/xrootd/core,755)
MakeDir(/var/spool/xrootd/manager,755)
MakeDir(/var/spool/xrootd/server,755)
MakeDir(/var/run/xrootd,775)

