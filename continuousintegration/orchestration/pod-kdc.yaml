apiVersion: v1
kind: Pod
metadata:
  name: kdc
  labels:
    k8s-app: kdc
spec:
  restartPolicy: Never
  containers:
  - name: kdc
    serviceAccountName: secret-creator
    image: gitlab-registry.cern.ch/cta/ctageneric:7713827gitf24c5f5c
    stdin: true
    env:
    - name: MY_NAME
      valueFrom:
        fieldRef:
          fieldPath: metadata.name
    - name: MY_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: INSTANCE_NAME
      value: "$(MY_NAMESPACE)"
    - name: TERM
      value: "xterm"
    command: ['/opt/run/bin/kdc.sh']
    args: ["none"]
    volumeMounts:
    - mountPath: /shared
      name: shared
    - mountPath: /mnt/logs
      name: logstorage
    - mountPath: /etc/krb5.conf
      name: krb5-config-volume
      subPath: krb5.conf
    - name: keypass-names
      mountPath: /tmp/keypass-names.txt
      subPath: keypass-names.txt
    securityContext:
      privileged: true

  volumes:
  - name: shared
    hostPath:
      path: /opt/cta
  - name: logstorage
    persistentVolumeClaim:
      claimName: claimlogs
  - name: krb5-config-volume
    configMap: 
      name: krb5-config
  - name: keypass-names
    configMap: 
      name: keypass-names-config
  imagePullSecrets:
  - name: ctaregsecret
