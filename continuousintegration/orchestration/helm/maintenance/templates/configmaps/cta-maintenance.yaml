
{{- $schedulerConfig := include "scheduler.config" . | fromYaml -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: cta-maintenance-conf
  labels:
    {{-  include "common.labels.standard" $ | nindent 4 }}
data:
  cta-maintenance.conf: |-
    # General
    cta.instance_name {{ $.Release.Namespace }}
    cta.scheduler_backend_name {{ $schedulerConfig.backend }}
    cta.daemon_user {{ $.Values.conf.general.user }}
    cta.daemon_group {{ $.Values.conf.general.group }}

    cta.log.level {{ $.Values.conf.log.level }}
    cta.log.format {{ $.Values.conf.log.format }}

    cta.catalogue.config_file {{ $.Values.conf.maintenance.catalogueConfigPath }}
    cta.objectstore.backendpath {{ include "global.schedulerUrl" $ }}

    cta.schedulerdb.tape_cache_max_age_secs {{ $.Values.conf.maintenance.tapeCacheMaxAgeSecs }}
    cta.schedulerdb.retrieve_queue_cache_max_age_secs {{ $.Values.conf.maintenance.retrieveQueueCacheMaxAgeSecs }}

    cta.maintenance.sleep_interval {{ $.Values.conf.maintenance.sleep_interval }}

    cta.disk_reporter.enabled {{ $.Values.conf.runners.disk_reporter.enabled }}
    cta.disk_reporter.batch_size {{ $.Values.conf.runners.disk_reporter.batchSize  }}
    cta.disk_reporter.soft_timeout {{ $.Values.conf.runners.disk_reporter.softTimeout }}

    cta.garbage_collector.enabled {{ $.Values.conf.runners.garbage_collector.enabled }}

    cta.queue_cleanup.enabled {{ $.Values.conf.runners.queue_cleanup.enabled }}
    cta.queue_cleanup.batch_size {{ $.Values.conf.runners.queue_cleanup.batchSize }}

    cta.repack.enabled {{ $.Values.conf.runners.repack.enabled }}
    cta.repack.request_manager.max_to_toexpand {{ $.Values.conf.runners.repack.maxToToExpand }}
    cta.repack.reporter.soft_timeout {{ $.Values.conf.runners.repack.softTimeout }}

    # Telemetry
    cta.experimental.telemetry.enabled {{ $.Values.conf.telemetry.enabled }}

    cta.telemetry.retain_instance_id_on_restart {{ $.Values.conf.telemetry.retainInstanceIdOnRestart }}
    cta.telemetry.metrics.backend {{ $.Values.conf.telemetry.metricsBackend }}
    {{- if $.Values.conf.telemetry.metricsExportInterval }}
    cta.telemetry.metrics.export.interval {{ $.Values.conf.telemetry.metricsExportInterval }}
    {{- end }}
    {{- if $.Values.conf.telemetry.metricsExportTimeout }}
    cta.telemetry.metrics.export.timeout {{ $.Values.conf.telemetry.metricsExportTimeout }}
    {{- end }}
    {{- if $.Values.conf.telemetry.metricsExportOtlpEndpoint }}
    cta.telemetry.metrics.export.otlp.endpoint {{ $.Values.conf.telemetry.metricsExportOtlpEndpoint }}
    {{- end }}
    {{- if $.Values.conf.telemetry.metricsExportOtlpBasicAuthSecret }}
    cta.telemetry.metrics.export.otlp.basic_auth_file /etc/cta/otlp-basic-auth.conf
    {{- end }}
    {{- if $.Values.conf.telemetry.metricsExportFileEndpoint }}
    cta.telemetry.metrics.export.file.endpoint {{ $.Values.conf.telemetry.metricsExportFileEndpoint }}
    {{- end }}
 
