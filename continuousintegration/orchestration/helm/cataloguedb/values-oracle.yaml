
nameOverride: cataloguedb
isPriviliged: false

image:
  registry: gitlab-registry.cern.ch
  repository: cta/ctageneric
  tag: 7894245git8a4cc01b
  pullPolicy: IfNotPresent
  pullSecrets: 
    - ctaregsecret

# The connection parameters for the Catalogue DB must be configured by the user of the Chart.
catalogueBackend: postgres # Can be sqlite, orale or postgres.
catalogueconfig:
  postgres:
    username: ""
    password: ""
    server: ""
    database: ""


# Changes the entrypoint of the image to the script and provide arguments if needed
customEntrypoint:
  command: ['/opt/run/bin/init.sh']
  args: ["none"]

catalogue:
  schemaVersion: "15.0"

pvcs:
  claimstg:
    selectors:
      type: stg
    storage: 3Gi
    accessModes:
      - ReadWriteMany
  claimlogs:
    selectors:
      type: logs
    storage: 2Gi
    accessModes:
      - ReadWriteMany

env:
- name: KEEP_DATABASE
  value: "0"


volumeMounts:
# - mountPath: /shared
#   name: shared
- mountPath: /etc/config/database
  name: mydatabase
- mountPath: /mnt/logs
  name: logstorage


volumes:
# - name: shared
#   hostPath:
#     path: /opt/cta
- name: mydatabase
  configMap:
    name: database-config
- name: logstorage
  persistentVolumeClaim:
    claimName: claimlogs

# Catalogue
postgres:
  name: postgres
  service:
    ports:
    - name: postgres
      port: 5432
      protocol: TCP
  pod:
    image: docker.io/postgres:14.10
    env:
    - name: POSTGRES_USER
      value: cta
    - name: POSTGRES_PASSWORD
      value: cta
    - name: PGDATA
      value: /var/lib/postgresql/data/pgdata
    - name: POSTGRES_DB
      value: cta
