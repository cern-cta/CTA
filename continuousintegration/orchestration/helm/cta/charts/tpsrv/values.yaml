# If required, the user can specify a custom image here
image:
component: tpsrv
partOf: cta

# tapeServers: {}
# The following is an example format of tapeServers
#
# tpsrv01:
#   libraryType: "MHVTL"
#   libraryDevice: "sg0"
#   libraryName: "VLSTK10"
#   drives:
#     - name: "VDSTK01"
#       device: "nst2"
#     - name: "VDSTK02"
#       device: "nst0"
# tpsrv02:
#   libraryType: "MHVTL"
#   libraryDevice: "sg0"
#   libraryName: "VLSTK10"
#   drives:
#     - name: "VDSTK03"
#       device: "nst1"

conf:
  rmcd:
    coreFileLimit: "unlimited"
    options: "/dev/smc"
  taped:
    bufferSizeBytes: 262144
    bufferCount: 200
    mountCriteria: "2000000, 100"
    watchdogIdleSessionTimer: 2 # Make tape servers more responsive, thus improving CI test speed
    useEncryption: "no"
    tapeCacheMaxAgeSecs: 1
    retrieveQueueCacheMaxAgeSecs: 1
    secProtocol: "sss"
    secSssktPath: "/etc/cta"
    ctaTapedSss: "cta-taped.sss.keytab"
  general:
    instanceName: "CI"

taped:
  command: ["/bin/sh", "-c"]
  # Not moving chown here due to the fact that the user might not yet exist
  args:
  - |
    cat /tmp/dump/cta/cta-tpsrv-tmp.sss.keytab > /etc/cta/cta-taped.sss.keytab;
    chmod 600 /etc/cta/cta-taped.sss.keytab;
    /opt/run/bin/taped.sh;
  env:
  - name: TERM
    value: "xterm"
  volumeMounts:
  - mountPath: /tmp/dump/cta/cta-tpsrv-tmp.sss.keytab
    name: tape-sss
    subPath: cta-tpsrv-tmp.sss.keytab
  volumes:
  - name: tape-sss
    secret:
      secretName: tpsrv-sss-keytab
