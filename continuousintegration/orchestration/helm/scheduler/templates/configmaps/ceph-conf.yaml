{{- /*
SPDX-FileCopyrightText: 2025 CERN
SPDX-License-Identifier: GPL-3.0-or-later
*/ -}}

{{- $schedulerConfig := include "scheduler.config" . | fromYaml }}
{{- if eq $schedulerConfig.backend "ceph" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: ceph-conf
data:
  ceph.conf: |
    [global]
      mon host = {{ $schedulerConfig.cephConfig.mon }}:{{ $schedulerConfig.cephConfig.monport }}

  ceph.client.{{ $schedulerConfig.cephConfig.id }}.keyring: |
    [client.{{ $schedulerConfig.cephConfig.id }}]
      key = {{ $schedulerConfig.cephConfig.key }}
      caps mon = "allow r"
      caps osd = "allow rwx pool={{ $schedulerConfig.cephConfig.pool }} namespace={{ $schedulerConfig.cephConfig.namespace }}"

{{- end }}
