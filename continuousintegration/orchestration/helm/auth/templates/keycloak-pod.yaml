{{- $name := include "keycloak.fullname" . }}
apiVersion: v1
kind: Pod
metadata:
  name: {{ $name }}
  namespace: {{ .Release.Namespace | quote }}
  labels:
    app.kubernetes.io/name: {{ $name }}
    {{- include "common.labels.withoutname" $ | nindent 4 }}
spec:
  restartPolicy: Never
  containers:
    - name: keycloak
      image: quay.io/keycloak/keycloak:26.1
      command: ["sh", "-c"]
      args:
        - |
          /opt/keycloak/bin/kc.sh start-dev --http-port=8080 --import-realm
      env:
        - name: KEYCLOAK_ADMIN
          value: admin
        - name: KEYCLOAK_ADMIN_PASSWORD
          value: admin
      ports:
        - containerPort: 8080
      volumeMounts:
      - name: grpc-realm-volume
        mountPath: /opt/keycloak/data/import
  volumes:
  - name: grpc-realm-volume
    configMap:
      name: grpc-realm


## useful: https://www.reddit.com/r/KeyCloak/comments/1cmc75l/import_realm/
## look at https://www.keycloak.org/server/containers