apiVersion: v1
kind: Pod
metadata:
  name: dbupdatetest
  labels:
    k8s-app: dbupdatetest
spec:
  restartPolicy: Never
  containers:
  - name: dbupdatetest
    image: gitlab-registry.cern.ch/cta/eoscta-operations/registry/container_registry/cta-catalogue-updater:testing
    stdin: true
    env:
    - name: MY_NAME
      valueFrom:
        fieldRef:
          fieldPath: metadata.name
    - name: MY_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: INSTANCE_NAME
      value: "$(MY_NAMESPACE)"
    - name: CATALOGUE_SOURCE_VERSION
      value: "CATALOGUE_SOURCE_VERSION_VALUE"
    - name: CATALOGUE_DESTINATION_VERSION
      value: "CATALOGUE_DESTINATION_VERSION_VALUE"
    - name: CTA_VERSION
      value: "CTA_VERSION_VALUE"
    - name: COMMIT_ID
      value: "COMMIT_ID_VALUE"
    - name: TERM
      value: "xterm"
    command: ["/usr/bin/bash"]
    args: ["/shared/scripts/dbupdatetest.sh"]
    volumeMounts:
    - mountPath: /etc/config/database
      name: mydatabase
    - mountPath: /etc/yum.repos.d
      name: repos
    - mountPath: /shared/scripts
      name: scripts
    - mountPath: /mnt/logs
      name: logstorage
    securityContext:
      privileged: true

  volumes:
  - name: repos
    configMap:
      name: yum.repos.d-config
  - name: scripts
    configMap:
      name: dbupdatetestscript-config
  - name: mydatabase
    configMap:
      name: database-config
  - name: logstorage
    persistentVolumeClaim:
      claimName: claimlogs

  imagePullSecrets:
  - name: ctaregsecret
