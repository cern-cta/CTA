apiVersion: v1
kind: Pod
metadata:
  name: init
  labels:
    k8s-app: cta-init
spec:
  restartPolicy: Never
  containers:
  - name: ctainit
    image: gitlab-registry.cern.ch/cta/ctageneric:%CTA_BUILD_ID
    stdin: true
    env:
    - name: MY_NAME
      valueFrom:
        fieldRef:
          fieldPath: metadata.name
    - name: MY_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: INSTANCE_NAME
      value: "$(MY_NAMESPACE)"
    - name: objectstore
      value: "/shared/$(INSTANCE_NAME)/objectstore"
    - name: catdbdir
      value: "/shared/$(INSTANCE_NAME)/catdb"
    - name: catdbfile
      value: "catdb"
    - name: LIBRARY_CONFIG
      value: "/shared/$(INSTANCE_NAME)/libraryconfig"
    command: ['/opt/ci/init/init.sh']
    args: ["none"]
    volumeMounts:
    - mountPath: /shared
      name: shared
    - mountPath: /library
      name: mylibrary
    securityContext:
      privileged: true

  volumes:
  - name: shared
    hostPath:
      path: /opt/cta
  - name: mylibrary
    persistentVolumeClaim:
      claimName: claimlibrary
