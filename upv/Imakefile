COMM
COMM  Copyright (C) 1999-2002 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)Imakefile,v 1.3 2005/01/23 08:49:33 CERN IT-PDP/DM Ben Couturier

COMM    Make UPV programs.

CUPVLIB = SharedLibraryTargetName(castorupv)
LOGDIR = /var/log/castor
LOGFILE = $(LOGDIR)/cupvd.log
CUPVCONFIG = CupvConfigFile
CUPV_HOST = CupvHost
USE_CUPV=-DUSE_CUPV
#if BuildSecureCupv
SECURITYFLAG=-DCSEC
#endif

CPPFLAGS += -DBIN=\"$(BIN)\" -DCUPV_HOST=\"$(CUPV_HOST)\" $(USE_CUPV) \
            -DLOGFILE=\"$(LOGFILE)\" -DCUPVCONFIG=\"$(CUPVCONFIG)\" \
            -DUSE_ORACLE $(SECURITYFLAG)
CFLAGS += -I$(ORACLE_HOME)/precomp/public

DependsOnLibrary(common,castorcommon)
CUPVLIB_OBJS = Cupv_apiinit.Osuf Cupv_errmsg.Osuf send2Cupv.Osuf Cupv_delete.Osuf Cupv_list.Osuf Cupv_util.Osuf Cupv_check.Osuf Cupv_modify.Osuf Cupv_add.Osuf
SharedLibraryTarget(castorupv,$(CUPVLIB_OBJS),$(DEPLIB),$(LIBS))

LIBMANPAGE(Cupv_add)
LIBMANPAGE(Cupv_check)
LIBMANPAGE(Cupv_delete)
LIBMANPAGE(Cupv_list)
LIBMANPAGE(Cupv_modify)

ClientProgramTarget(Cupvadd, Cupvadd.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvmodify, Cupvmodify.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvcheck, Cupvcheck.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvdelete, Cupvdelete.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvlist, Cupvlist.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)

EXEMANPAGE(Cupvadd)
EXEMANPAGE(Cupvmodify)
EXEMANPAGE(Cupvcheck)
EXEMANPAGE(Cupvdelete)
EXEMANPAGE(Cupvlist)

Cupv_oracle_ifce.c: Cupv_oracle_ifce.pc
	proc iname=Cupv_oracle_ifce include=../h threads=yes char_map=string parse=full prefetch=1000
COMM We overwrite here the default rule for the compilation of Cupv_oracle_ifce in order
COMM to be able to discard the -Werror present in the standard flags. The reason is that
COMM the code generated by proc is full of warnings...
Cupv_oracle_ifce.o: Cupv_oracle_ifce.c
	$(COMPILE.c) $(OUTPUT_OPTION) -Wno-error $<
FilesToClean += Cupv_oracle_ifce.c Cupv_oracle_ifce.lis
CUPVD_OBJS = Cupv_main.Osuf Cupv_oracle_ifce.Osuf Cupv_procreq.Osuf sendrep.Osuf Cupv_util.Osuf Cupvlogit.Osuf
MakeDir($(LOGDIR),0755)
ORALIBS= -L$(ORACLE_HOME)/lib -lclntsh
NormalProgramTarget(cupvd,$(CUPVD_OBJS), $(DEPLIB), $(ORALIBS) $(LIBS),750)
ADMMANPAGE(cupvd)
LOGROTATE(castor-upv-server,..,install)
SYSCONFIG(cupvd,install)
INITSCRIPT(cupvd,install)
CONFIGFILE(CUPV,..,install)

