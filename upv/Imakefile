COMM
COMM  Copyright (C) 1999-2002 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)Imakefile,v 1.3 2005/01/23 08:49:33 CERN IT-PDP/DM Ben Couturier

COMM    Make UPV programs.

INCLUDES = ../h
CUPVLIB = -L. -lcastorupv
OPSGRP = OperatorGid
SPOOL = CupvSpool
LOGFILE = $(SPOOL)/log
CUPVCONFIG = CupvConfigFile
CUPV_HOST = CupvHost
ORAFLG = -DUSE_ORACLE
ORAINC = -I$(ORACLE_HOME)/precomp/public
USE_CUPV=-DUSE_CUPV
#if BuildSecureCupv
SECURITYFLAG=-DCSEC
#endif  

DFLAGS = -DBIN=\"$(BIN)\" -DCUPV_HOST=\"$(CUPV_HOST)\" $(USE_CUPV) \
         -DLOGFILE=\"$(LOGFILE)\" -DCUPVCONFIG=\"$(CUPVCONFIG)\" \
         $(RDSFLG) $(ORAFLG)
CFLAGS = -I$(INCLUDES) $(MTCCFLAGS) $(DFLAGS) $(RDSINC) $(ORAINC) $(SECURITYFLAG)

DependsOnLibrary(common,castorcommon)

#if BuildCupvDaemon
Cupv_oracle_ifce.c: Cupv_oracle_ifce.pc
	proc iname=Cupv_oracle_ifce include=$(INCLUDES) threads=yes CHAR_MAP=STRING PARSE=FULL
FilesToClean += Cupv_oracle_ifce.c Cupv_oracle_ifce.lis
CUPVDAEMON_OBJS = Cupv_main.Osuf Cupv_oracle_ifce.Osuf Cupv_procreq.Osuf sendrep.Osuf Cupv_util.Osuf Cupvlogit.Osuf
MakeDir($(SPOOL),root,bin,0755)
ORALIBS= -L$(ORACLE_HOME)/lib -lclntsh
NormalProgramTarget(Cupvdaemon,$(CUPVDAEMON_OBJS), $(DEPLIB), $(ORALIBS) $(MTLDFLAGS) $(LIBS),root,bin,750)
ADMMANPAGE(Cupvdaemon)
#endif

#if BuildCupvClient
UPVDEP = SharedLibraryTargetName(castorupv)
NormalProgramTarget(Cupvadd, Cupvadd.Osuf,$(UPVDEP) $(DEPLIB),$(CUPVLIB) $(LIBS),root,bin,755)
NormalProgramTarget(Cupvmodify, Cupvmodify.Osuf,$(UPVDEP) $(DEPLIB),$(CUPVLIB) $(LIBS),root,bin,755)
NormalProgramTarget(Cupvcheck, Cupvcheck.Osuf,$(UPVDEP) $(DEPLIB),$(CUPVLIB) $(LIBS),root,bin,755)
NormalProgramTarget(Cupvdelete, Cupvdelete.Osuf,$(UPVDEP) $(DEPLIB),$(CUPVLIB) $(LIBS),root,bin,755)
NormalProgramTarget(Cupvlist, Cupvlist.Osuf,$(UPVDEP) $(DEPLIB),$(CUPVLIB) $(LIBS),root,bin,755)
EXEMANPAGE(Cupvadd)
EXEMANPAGE(Cupvmodify)
EXEMANPAGE(Cupvcheck)
EXEMANPAGE(Cupvdelete)
EXEMANPAGE(Cupvlist)
#endif

CUPVLIB_OBJS = Cupv_apiinit.Osuf Cupv_errmsg.Osuf send2Cupv.Osuf Cupv_delete.Osuf Cupv_list.Osuf Cupv_util.Osuf Cupv_check.Osuf Cupv_modify.Osuf Cupv_add.Osuf
SharedLibraryTarget(castorupv,$(CUPVLIB_OBJS),$(DEPLIB),$(LIBS))

LIBMANPAGE(Cupv_add)
LIBMANPAGE(Cupv_check)
LIBMANPAGE(Cupv_delete)
LIBMANPAGE(Cupv_list)
LIBMANPAGE(Cupv_modify)

FilesToClobber += Cupv_oracle_ifce.c Cupv_oracle_ifce.lis













