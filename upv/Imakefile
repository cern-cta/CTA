COMM
COMM  Copyright (C) 1999-2002 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)Imakefile,v 1.3 2005/01/23 08:49:33 CERN IT-PDP/DM Ben Couturier

COMM    Make UPV programs.

INCLUDES = ../h
CUPVLIB = SharedLibraryTargetName(castorupv)
SPOOL = /var/spool/upv
LOGFILE = $(SPOOL)/log
CUPVCONFIG = CupvConfigFile
CUPV_HOST = CupvHost
ORAFLG = -DUSE_ORACLE
ORAINC = -I$(ORACLE_HOME)/precomp/public
USE_CUPV=-DUSE_CUPV
#if BuildSecureCupv
SECURITYFLAG=-DCSEC
#endif  

DFLAGS = -DBIN=\"$(BIN)\" -DCUPV_HOST=\"$(CUPV_HOST)\" $(USE_CUPV) \
         -DLOGFILE=\"$(LOGFILE)\" -DCUPVCONFIG=\"$(CUPVCONFIG)\" \
         $(RDSFLG) $(ORAFLG)
CFLAGS = -I$(INCLUDES) $(MTCCFLAGS) $(DFLAGS) $(RDSINC) $(ORAINC) $(SECURITYFLAG)

DependsOnLibrary(common,castorcommon)
CUPVLIB_OBJS = Cupv_apiinit.Osuf Cupv_errmsg.Osuf send2Cupv.Osuf Cupv_delete.Osuf Cupv_list.Osuf Cupv_util.Osuf Cupv_check.Osuf Cupv_modify.Osuf Cupv_add.Osuf
SharedLibraryTarget(castorupv,$(CUPVLIB_OBJS),$(DEPLIB),$(LIBS))

LIBMANPAGE(Cupv_add)
LIBMANPAGE(Cupv_check)
LIBMANPAGE(Cupv_delete)
LIBMANPAGE(Cupv_list)
LIBMANPAGE(Cupv_modify)

ClientProgramTarget(Cupvadd, Cupvadd.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvmodify, Cupvmodify.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvcheck, Cupvcheck.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvdelete, Cupvdelete.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)
ClientProgramTarget(Cupvlist, Cupvlist.Osuf,$(CUPVLIB) $(DEPLIB),$(CUPVLIB) $(LIBS),755)

EXEMANPAGE(Cupvadd)
EXEMANPAGE(Cupvmodify)
EXEMANPAGE(Cupvcheck)
EXEMANPAGE(Cupvdelete)
EXEMANPAGE(Cupvlist)

Cupv_oracle_ifce.c: Cupv_oracle_ifce.pc
	proc iname=Cupv_oracle_ifce include=$(INCLUDES) threads=yes CHAR_MAP=STRING PARSE=FULL
FilesToClean += Cupv_oracle_ifce.c Cupv_oracle_ifce.lis
CUPVDAEMON_OBJS = Cupv_main.Osuf Cupv_oracle_ifce.Osuf Cupv_procreq.Osuf sendrep.Osuf Cupv_util.Osuf Cupvlogit.Osuf
MakeDir($(SPOOL),0755)
ORALIBS= -L$(ORACLE_HOME)/lib -lclntsh
NormalProgramTarget(Cupvdaemon,$(CUPVDAEMON_OBJS), $(DEPLIB), $(ORALIBS) $(MTLDFLAGS) $(LIBS),750)
ADMMANPAGE(Cupvdaemon)
LOGROTATE(castor-upv-server,..,install)
SYSCONFIG(Cupvdaemon,install)
INITSCRIPT(Cupvdaemon,install)
CONFIGFILE(CUPV,..,install)