COMM
COMM  Copyright (C) 2004 by CERN/IT/ADC
COMM  All rights reserved
COMM
COMM     @(#)$RCSfile: Imakefile,v $ $Revision: 1.2 $ $Date: 2004/06/30 16:37:45 $ CERN IT-ADC Vitaly Motyakov
COMM    Make expert programs.

#include <Project.tmpl>

INCLUDES = FileName(..,h)
#if _AIX
LIBS = -L../lib -lshift
#else
#if defined(__alpha) && defined(__osf__)
LIBS = -no_so -L../lib -lshift -so_archive
#else
#if hpux
LIBS = -L../lib -lshift
#else
#if linux
LIBS = -L../lib -lshift $(ADNSLIB) -lnsl
#else
#if sgi
LIBS = -L../lib -lshift
#else
#if SOLARIS
LIBS = -L../lib -lshift -lsocket -lnsl
#else
#if _WIN32
LIBS = ..\lib\shift.lib wsock32.lib advapi32.lib
#endif
#endif
#endif
#endif
#endif
#endif
#endif
#if _WIN32
EXPERTLIB = expert.lib
#else
EXPERTLIB = -L. -lexpert
#endif
OPSGRP = OperatorGid
SPOOL = ExpertSpool
LOGFILE = FileName($(SPOOL),log)
EXPERT_CONFIG = ExpertConfigFile
EXPERT_HOST = ExpertHost
 
COMM######################### FLAGS ##############################
 
DFLAGS = -DBIN=\"$(BIN)\" -DEXPERT_HOST=\"$(EXPERT_HOST)\" \
         -DLOGFILE=\"$(LOGFILE)\" -DEXPERT_CONFIG=\"$(EXPERT_CONFIG)\"
 
CFLAGS =        -I$(INCLUDES) $(MTCCFLAGS) $(DFLAGS)
 
COMM######################### DEPENDENCY LIBRARIES ###############
 
DEPLIB = DepLibraryTargetName(lib,shift)
 
COMM######################### RULES ##############################

MANPAGES = $(MANDIR)/expertd.$(MANSUFFIX) \
	   $(MANDIR)/expert.$(MANSUFFIX) \
	   $(MANDIR)/expert_send_request.$(MANSUFFIX) \
	   $(MANDIR)/expert_receive_data.$(MANSUFFIX) \
	   $(MANDIR)/expert_send_data.$(MANSUFFIX)

EXPORTMANPAGES = $(EXPORTMAN)/man1/expertd.$(MANSUFFIX) \
	   $(EXPORTMAN)/man1/expert.$(MANSUFFIX) \
	   $(EXPORTMAN)/man3/expert_send_request.$(MANSUFFIX) \
	   $(EXPORTMAN)/man3/expert_receive_data.$(MANSUFFIX) \
	   $(EXPORTMAN)/man3/expert_send_data.$(MANSUFFIX)

#if BuildExpertClient
CLIENT = LibraryTargetName(expert) \
	 ProgramTargetName(expexec)

IPROGS_C =	

EPROGS_C = 	$(EXPORTBIN)/expexec
#endif
#if BuildExpertDaemon
PROGS_D = ProgramTargetName(expertd)
IPROGS_D = FileName($(BIN),ProgramTargetName(expertd))
EPROGS_D = $(EXPORTBIN)/expertd
#endif

EXPERTD_OBJS	=	expertd.Osuf \
			exp_procreq.Osuf \
			sendrep.Osuf \
			explogit.Osuf
EXPERTLIB_OBJS	=	send2expert.Osuf \
			exp_errmsg.Osuf \
			exp_api.Osuf \
			exp_apiinit.Osuf

all: $(CLIENT) $(PROGS_D)

NormalProgramTarget(expertd,$(EXPERTD_OBJS), $(DEPLIB), $(LIBS))

NormalProgramTarget(expexec,expexec.Osuf,LibraryTargetName(expert) $(DEPLIB),$(EXPERTLIB) $(LIBS))

NormalLibraryTarget(expert,$(EXPERTLIB_OBJS))

MakeDepLibrary(lib,shift)

#if BuildExpertDaemon
install: $(BIN) $(IPROGS_C) $(IPROGS_D) $(SPOOL)
#else
install: $(BIN) $(IPROGS_C)
#endif

InstallProgram(expertd,$(BIN),root,bin,750)
IEXPORT(expertd,$(EXPORTBIN),750);

MakeDir($(BIN),root,bin,0755)
MakeDir($(SPOOL),root,bin,0755)
 
install.man: $(MANDIR) $(MANPAGES)

MakeDir($(MANDIR),root,bin,0755)

IMANPAGE(expert,$(MANDIR),$(MANSUFFIX))
IMANPAGE(expertd,$(MANDIR),$(MANSUFFIX))
IMANPAGE(expert_send_request,$(MANDIR),$(MANSUFFIX))
IMANPAGE(expert_send_data,$(MANDIR),$(MANSUFFIX))
IMANPAGE(expert_receive_data,$(MANDIR),$(MANSUFFIX))

EMANPAGE(expert,$(EXPORTMAN)/man1,$(MANSUFFIX))
EMANPAGE(expertd,$(EXPORTMAN)/man1,$(MANSUFFIX))
EMANPAGE(expert_send_request,$(EXPORTMAN)/man3,$(MANSUFFIX))
EMANPAGE(expert_send_data,$(EXPORTMAN)/man3,$(MANSUFFIX))
EMANPAGE(expert_receive_data,$(EXPORTMAN)/man3,$(MANSUFFIX))

export: $(EPROGS_C) $(EPROGS_D)

exportman: $(EXPORTMANPAGES)

exportshr:

COMM###################### CLEANING RULES ########################
 
clean:
	-@RemoveFiles(FilesToClean)
 
clobber:        clean
	-@RemoveFiles($(CLIENT) $(PROGS_D))
 
#if _WIN32
depend:
	@echo Not supported on this platform
#else
depend:
	makedepend -Y$(INCLUDES) *.c 2> /dev/null
#endif

Makefiles:
 
FORCE:

COMM###################### DEPENDENCIES ##########################

COMM DO NOT DELETE THIS LINE -- make  depend  depends  on  it.
