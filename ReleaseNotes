-----------
- 2.1.3-* -
-----------

  New Features and Changes
  ------------------------
  This release brings the new LSF plugin and a brand new monitoring architecture.
  Details concerning the monitoring :
   - rmmaster daemon is now only doing job scheduling and is not used anymore for monitoring
     although it is still active. As a consequence, rmgetnodes won't give anything
   - as a corrolate, rmnode is no more distributed and does not run anymore on the diskservers.
     rmadminnode should not be used anymore and the fileSystem service of the stager was dropped.
   - the new daemon is called rmMasterDaemon and should run on the scheduler node. It is distributed
     in the same package castor-rmmaster as rmmaster so this package should be installed on both
     the scheduler node and the rmmaster node even if both daemons are not needed in both places.
   - rmMasterDaemon uses shared memory to store the data. This set of memory will survive it
     in case of crash and be reused when restarting. In case of reboot, it can be reinitialized from
     the data contained in the stager DB, which are constantly updated.
   - the new command lines are rmAdminNode and rmGetNodes (the last one being only available on
     the scheduler node).
   - the new monitoring daemon is called rmNodeDaemon and is distributed in castor-rmnode. On top
     of monitoring the node and sending data to the rmMasterDaemon, it also keeps the current status
     of the node in the daemon in /etc/castor/status
   - the new monitoring monitors :
     - for each diskserver : ram(total+free), memory(total+free), swap(total+free), load, status and adminStatus
     - for each filesystem : space(total+free), nbRead/ReadWrite/WriteStreams, read/writeRate, status and adminstatus
   - the status can be Production, Down or Draining
   - the admin status can be None or Force. If None, the status in the master is updated according
     to monitoring. It Force, it is not updated. rmAdminNode also uses the Release admin status to
     switch from Force to None.
  Details concerning the LSF/shared memory part :
   - there is a new LSF plugin with same name and same interface.
   - it uses shared memory to get data from the rmMasterDaemon and thus has to run on the same machine
   - this shared memory is also accessed by rmGetNodes that basically dumps it
   - In case of corruption, the way to reset the shared memory is to stop rmMasterDaemon and LSF and
     use ipcs/ipcrm. the key used is 0x946
  Other new parts :
   - the DB schema was changed to integrate the new monitoring parts
   - the external clips policy for the scheduling was dropped so clips is no more needed
   - all executables and libraries now have a new symbol storing the CASTOR version number.
     just do an "nm <exe or lib file> | grep CastorVersion" to get it
  Improvements and bug fixes :
   - the default values for the cleaning daemon time intervals were fixed
   - Fixed handling of exception in createRecallCandidate that was leading to a segfault in stager_db_service. The point is that the link subrequest->diskCopy was not suppressed while the diskCopy was deleted.
   - Fixed the problem of reservedSpace accumulation. Three cases were not covered properly, in the sense that the reserved space was not removed :
      + puts with no file size given. Fixed in prepareForMigration
      + disk2diskcopies. Fixed in disk2diskCopyDone
      + aborted disk2diskCopies in the case LSF scheudules the copy on a filesystem already having the file. Fixed in getUpdateStart.
   - Optimized several ORACLE procedures (getUpdateStart, bestTapeCopyForStream, internalStageQuery)
   - putDones are not scheduled anymore
   - many fixes on repack and in the tape part
   - the maximum file name length in the nameserver was changed from 231 to 255 characters
  
  Upgrade from 2.1.2-*
  --------------------
  - Stop all the CASTOR daemons
  - Upgrade the database;
  - Upgrade all nodes (the order is not important)
  - Restart the services


-----------
- 2.1.2-7 -
-----------

  New Features and Changes
  ------------------------
  This release brings selected fixes and no new functionality with respect to the previous 2.1.2:
  - Fixes for reservedSpace accumulation in case of failed Puts and Puts from SRM
  - Fixes in the stager to prevent segmentation faults in case of exception handling for tape recalls
  - Fix for the stagemap handling

  Upgrade from 2.1.2-6
  --------------------
  - Upgrade the database 
  - Upgrade all head nodes (the order is not important)


-----------
- 2.1.2-6 -
-----------

  New Features and Changes
  ------------------------
  This release brings a number of bug fixes:
   - Fixed potential double/invalid frees in the database access layer
   - Fixed error checking in the PrepareToGet in case of tape recalls
   - Bug Fixed in repack worker and monitoring now is able to deal with the stager timeout.
   - Fixed the socket leak in DLF client when the DLF server is not reachable
   - Fixed the stagerJob for xroot. We were calling prepareForMigration while xroot does it for us.
   - Optimized version of stage_qry
   - Fixes for the processing of update requests
   - Fixed the reservedSpace accumulation problem
   - Fixed garbage collector job
  
  Upgrade from 2.1.2-4
  --------------------
  - Upgrade the database 
  - Upgrade all head nodes (the order is not important)


-----------
- 2.1.2-4 -
-----------

  New Features and Changes
  ------------------------
  This release brings a number of bug fixes and improvements:
  - A PrepareToGet request is not scheduled anymore if the requested file is to be recalled from tape
  - Bugfixes and finalization of the Repack system
  - Implemented Repack check and Repack undo
  - Fixes around the DLF and the web interface
  - Fixed all known database deadlocks to date
  - Reconnection to the db more robust in case of transient failures, many more are recognized now
  - Cleaned NS clients and CUPV code for 64bit
  - Many optimizations in the PL/SQL code
  - Minor fixes to be able to compile the C++ part with gcc-3.4 and gcc-4.1 without warnings
  - Fixed a problem in TapeErrorHandler to allow tape retries upon error
  - Fixed query used by the cleaningDaemon to delete old failed subRequests
  - Bugfix for #22620: Uncaught C++ exception causes TapeErrorHandler to Abort
  - Bugfix for #22382: rtcpclientd does not stop gracefully upon signal
  - Bugfix for #21824: internalPutDoneFunc tries to delete the prepareTo request too hard
  - Bugfix for #21541: change location of RTCOPY
  - Bugfix for #21482: bad values on defaultFileSize when using modifySvcClass
  
  Upgrade from 2.1.1-9
  --------------------
  - Stop all the CASTOR daemons
  - Upgrade the database; new database code does not work with old stagers
  - Upgrade all nodes (the order is not important) and restart the service


-----------
- 2.1.1-9 -
-----------

  New Features and Changes
  ------------------------
  This release brings a number of bug fixes and improvements:
  - Improvements around the Repack system, added Repack multi-stager ability
  - Bugfix for #21093: strange files created on local disk, when DLF is not able to log
  - Bugfix for #20069: if user has the wrong (non existent) svcclass there is no intelligible error reported
  - Bugfix for very large files
  - Improved selection of migration candidates via PL/SQL procedure
  - Improved port handling in clients in case of many concurrent callbacks on a small port range
  - Improved stager_qry in case of castorFiles with many diskCopies
  - Bugfix for stager_qry (#19044, #19836)
  - Improved logging in the Request Handler
  - Support for 700Gb tapes

  Upgrade from 2.1.1-4
  --------------------
  - Upgrade the database
  - Upgrade all nodes (the order is not important).


-----------
- 2.1.1-4 -
-----------

  New Features and Changes
  ------------------------
  This release brings a number of bug fixes:
  - Fixes around the Repack system
  - Improved cleaning procedures and config for the cleaningDaemon, now it shares castor.conf
  - Fixed Oracle deadlock which was leading to many diskcopies left in status 9
  - Fixed Oracle deadlock in streams leading to inconsistencies in NbTapeCopiesInFS
  - Fixes in the migrator
  - Improved GC trigger to resurrect the GC job if it previously died
  - Improved stagerJob to prevent it to loop forever for a missing msgbox 4 from LSF

  Upgrade from 2.1.1-0
  --------------------
  - Upgrade the database
  - Upgrade the head nodes and the diskservers (the order is not important).


-----------
- 2.1.1-3 -
-----------

  New Features and Changes
  ------------------------
  This release brings the new Repack for CASTOR2 system, and a number of bug fixes:
  - Fixed leak of stager_rm subrequests in status ready
  - Fixed deadlock in the updateFsFileOpen/Close SQL methods
  - Fixed stager_qry for prepareToPut requests
  - Fix concerning retrieval of castorversion from stagemap if the env variable is not set
  - Take '*' as a wildcard for the svcClass in a stager_qry
  - Changed compression factor for IBM3592 in order to activate NVC bit
  - Included modifications for xrootd

  Upgrade from 2.1.1-0
  --------------------
  - Upgrade the head nodes
  - Then for the other nodes no special order is required.


-----------
- 2.1.1-2 -
-----------

  - This release is broken in the rtcpclientd.


-----------
- 2.1.1-1 -
-----------

  New Features and Changes
  ------------------------
  This release is exactly the same as the 2.1.1-0 except for a minor fix on the DLF server.
  It has been rebuilt to widely deploy it at CERN, as the first attempt for the 2.1.1-0 had
  a major problem leading to backward incompatibilities on the client.
  Note that the RPMs in the castor download area are correct for both 2.1.1-0 and 2.1.1-1.

  Upgrade from 2.1.1-0
  --------------------
  Not needed. If you're running an older version, please follow upgrade instructions below.


-----------
- 2.1.1-0 -
-----------

  New Features and Changes
  ------------------------
  This is a major release with many fixes and features. See the changelog for all the details.
  The most important new features are:
  - New rewritten version of DLF
  - Resurrection of the db connection when it's lost
  - Many fixes to the SQL code
  - Fixed some deadlock between the GC and the updateFsFileClosed PL/SQL function
  - Fixed the random port issue on the client
  - Changed default nb of threads to 20 for DB and JOB (optimal value according to Olof's tests)
  - Modifications to be ready with RFIO merge
  - Increased the number of test suites
  
  Upgrade from 2.1.0-x
  --------------------
  The upgrade to be done concerns the whole system (database, stager, clients, tape servers),
  and backward compatibility is ensured only if clients are uprgraded BEFORE servers.
  - Upgrade all clients (they can still connect to an OLD stager).
  - Upgrade the stager database (you don't need to stop the services nor daemons for that).
  - Drop and recreate the DLF database.
  - Then upgrade the head nodes.

-----------
- 2.1.0-8 -
-----------

  New Features and Changes (from 2.1.0-7)
  ---------------------------------------
  - Fixed temporaly the problems with rfcp command for CASTOR1

  Upgrade from 2.1.0-7
  --------------------
  Only CLIENTS using CASTOR1 should upgrade. For CASTOR2 there are no changes
    
-----------
- 2.1.0-7 -
-----------
  
  New Features and Changes (from 2.1.0-6)
  ---------------------------------------
  - Fixed a problem with the memory leak in RFIO
  - Temporary fix, the port used in the bind is now a pseudo-random value that change for each request.To reduce the probability that the answer of an aborted request is returned to a new one.

  Upgrade from 2.1.0-6
  --------------------
  Non special order is required.
  
-----------
- 2.1.0-6 -
-----------
  New Features and Changes (from 2.1.0-5)
  ---------------------------------------
  - Made the output of stager_qry -s less wide
  - Added CF.lastKnownFileName as a result of diskServer_qry -i 
  - Mir valid/invalid checking on IBM3592E05 tape drives, new IBM3592E05 firmware release (172E) fixed problem seen before.
  - Connection reset messages from rmc are just sent to msgdaemon after 2 retries.
  - Rmcdaemon now checks if tape is in the storage slot before returning dismount OK
  - Fixed the cleaning of the DiskCopy in case of put failure. This was leading to orphaned DiskCopies
  - Fixed a bug in updateFiles2Delete
  - Handle properly exceptions in sendRequest and especially release memory and close the socket
  - Fixed missing filling of the svcclass of a castorfile in memory.The consequence was that the svcclass could be overwritten in case  of reuse of a castorfile in 2 different service classes


  Upgrade from 2.1.0-5
  --------------------

  - Upgrade the Database
  - Upgrade the head nodes
  - Then for the other components there are no restrictions in that release.

-----------
- 2.1.0-5 -
-----------
  New Features and Changes (from 2.1.0-5)
  ---------------------------------------
  - Fixed some deadlock between the GC and the updateFsFileClosed PL/SQL function
  - Fixed a missing chkconfig line in debian/cleaning.init
  - RFIO_USE_CASTOR_V2 NOT case sensitive.
  - Fixed the bug of permissions when creating a file (stager_put)
  - Remove check for already migrated files preventing recreated files from being migrated
  - Fixed stage_open, broken since the integration of O_LARGEFILE
  - Fixed tpdump for toot usage

  Upgrade from 2.1.0-4
  --------------------

  - Upgrade the Database
  - Upgrade the head nodes
  - Then for the other components there are no restrictions in that release.

-----------
- 2.1.0-4 -
-----------
  New Features and Changes (from 2.1.0-3)
  ---------------------------------------
  This is a bug fix release, strictly identical to 2.1.0-3 with some exceptions:
  - The name server client commands(nsln, nsgetacl and nssetacl) for manipulating the ACLs are included in castor-ns-client package
  - Fixed TURL parsing in rfcp
  - Updated the man pages with the new turl
  - Added some changes in the stager and disk server to support xrootd protocol
  - Fixed bug #17720, backport fix in rtcpcld_putFailed from 1.143.0.2
  - Added message when skipping not-staged files
  - Stager client command line is CASTOR2 by default (RFIO_USE_CASTOR_V2 doesn't need to be set with this client version)
  - Check of tapealerts hard error, media error, write failure, read failure at release time. 
  - Removal of MIR validity check, on IBM3592EO5 in some situation gives false positive results.
  

  Upgrade from 2.1.0-3
  --------------------

   - The upgrade to be done concerns to the whole system but the database( stager, client, disk servers and tape servers)
   - There are no specific modifications of the database
   - If your are upgrading 2.1.0-3 no order is required, but if you are upgrading from 2.1.0-2 or previous versions please follow the order specified in "2.1.0-3 upgrade from 2.1.0-2"  
   



-----------
- 2.1.0-3 -
-----------
  New Features and Changes (from 2.1.0-2)
  ---------------------------------------
  This is a bug fix release, strictly identical to 2.1.0-2 with some exceptions:
  - Fixes concerning the TURL parsing in RFIO
  - The garbage collection was optimized 
  - Added the check of MIR validity at mount time for SUN/STK T10000, LTO and IBM3592
  - Fixes concerning the deadlocks in PL/SQL and avoiding replication of STAGEOUT files
  - Added dependency on castor_lib_compact 2.0.2_1 to avoid relinking.
  - Fixed the inicialitation of the file systemd for minAllowedFreeSpace
  

  Upgrade from 2.1.0-2
  --------------------

    - The upgrade to be done concerns the whole system (database, stager, client, tape servers)
    - Upgrade the database (you don't need to stop the services nor daemons for that).
    - Then upgrade the rest of the system. 


  

-----------
- 2.1.0-2 -
-----------

  New Features and Changes (from 2.1.0-0)
  ---------------------------------------
  
  This is a bug fix release, strictly identical to 2.1.0-0 except
  for the tape part.
  On previous releases of Castor, the report of compression statistics
  from SUN T10000 tape drives was wrong. This behaviour was due to the
  wrong handling of the T10000 device when decoding the sequential log page.
  Castor will report wrong compression statistics on IBM3592 tape drives
  if the tape drive is set with NVC mode on. The tape drive will only post
  correct statistics after the flush of the NVC buffer, this behaviour is
  particularly seen when files are smaller than the NVC buffer size
  (~300MBytes).

  Upgrade from 2.1.0-0
  --------------------

    - The only upgrade to be done concerns the tape servers.


-----------
- 2.1.0-1 -
-----------

  New Features and Changes (from 2.1.0-0)
  ---------------------------------------
  This is not really a release but modifications at the rpm level
  
-----------
- 2.1.0.0 -
-----------

  New Features and Changes (from 2.0.4-1)
  ---------------------------------------

  This version is strictly identical to 2.0.4-1.
  It is however prefered to 2.0.4-* since the soname of the libraries changed
  which was needed after we introduced some non backward compatible change in
  the interface.

  Upgrade from 2.0.4-1
  --------------------

    - The only upgrade to be done concerns the castor.conf: it has to be
      upgraded everywhere (head nodes and diskservers) with the new library
      name (ends with 2.1 instead of 2.0).
    - Note that for the client part, we advice to let castor-lib 2.0.* live
      aside the new one, so that applications linked with libshift.2.0 don't
      break suddenly. Once all users have relinked there applications with
      the new version, it can be removed.

-----------
- 2.0.4-1 -
-----------

  New Features and Changes (from 2.0.4-0)
  ---------------------------------------
    
    - Fixes concerning the TURL parsing in RFIO
    - Implementation of a port range for the ports used by the stager clients.
      Default range in [30000,30100], it can be overwritten in castor.conf
    - The file permission checks were fixed in the stager
    - The getNext functionnalities were made available to update requests
    - The cleaning daemon now has an init script
    - The flags given to RFIO when opening a file are now correctly handled
    - Queries on directories are now properly handled
    - SQL scripts are now also provided for sqlplus
    - The garbage collection was fixed (it was broken in 2.0.4-0 due to the new archiving of subrequests)
    - stager_qry -s was fixed (ordering was wrong)

  Upgrade from 2.0.4-0
  --------------------

    - The database schema has not evolved. However, some fixes in the PL/SQL code
      were added. Use upgrades/2.0.4-0_to_2.0.4-1.sql to upgrade.
    - Clients can be updated completely independently (before or after the server
      update).

-----------
- 2.0.4-0 -
-----------

  New Features and Changes (from 2.0.3-0)
  ---------------------------------------

    - Fixes concerning the IBM 3592 tapes
    - Support for preallocation and direct i/o were added to RFIO
    - A Cleaning service was added that cleans up old requests
      and errors after some (configurable) time
    - stager_qry support for regexp was improved. Regexp is
      no more the default but can be activated using options.
      Directory listing is also supported and several fixes were applied.
    - stager_qry -s was implemented for getting statistics on diskpools
    - (prepareTo)Get/Put requests now detect directory names
    - RFIO was modified for supporting extended TURLs needed for
      SRM : rfio://stager:port//castor/.../file?svcclass=...&castorversion=...
    - /etc/castor/ORASTAGERCONFIG can now contain several lines in order
      to be able to switch between several CASTOR2 instances. The environment
      variable CASTOR_INSTANCE defines which line to use
    - VMGR now updates correctly the estimated free space, even for full tapes
    - rmnode has no more default for the RMMASTER_HOST. It raises an error
      if nothing is set.
    - Better logging of rmmaster to DLF

  Upgrade from 2.0.3-*
  --------------------

    - The database schema has evolved. Use upgrades/2.0.3_to_2.0.4.sql to upgrade.
      This can be done anytime before the software upgrade and does not imply any
      service interruption.
    - The server code can be updated after the DB, still without service interruption
      if you play with several processes.
    - Clients can be updated completely independently (before or after the server
      update). However, new functionnalities will lead to strange errors in case
      servers were not updated, typically :
          > stager_qry -s
          Error: Invalid argument
          stage_diskpoolsquery: Server Error 22 :
          Unable to read Request object from socket.
          No factory found for object type 103 and representation type 1

-----------
- 2.0.3-5 -
-----------

  Prerelease of future 2.0.4-0. To be tested.

-----------
- 2.0.3-4 -
-----------

  Bug fix release. Should again only be used for IBM 3592 taperservers

-----------
- 2.0.3-3 -
-----------

  Bug fix release. This release should be used in place of v2_0_3_0. It fixes
  a packaging bug that was introducing a symbol main in the library libshift.
  It is otherwise fully identical to v2_0_3_0.

-----------
- 2.0.3-2 -
-----------

  Bug fix release. Should again only be used for IBM 3592 taperservers

-----------
- 2.0.3-1 -
-----------

  Bug fix release. Should only be used for IBM 3592 taperservers

-----------
- 2.0.3-0 -
-----------

  New Features and Changes
  ------------------------

    - Support for ACLs in the nameserver
    - Regular expression support in stager_qry. The feature is
      limited on the server side via the FILEQUERY/MAXNBRESPONSES
      entry in the castor.conf.
    - LSF plugin is using new fixes coming with LSF 6.1-24. This
      allows to remove an internal fork. This change is incompatible
      with any old version of LSF
    - Interface for passing an authorization id to the stager on top
      of a user id.
    - Framework for multithreaded applications was ported to C++
    - Fixed compilation for x86_64 architecture
    - New package castor-dlf-gui
    - tpdaemon uses sg0 device instead of sga
    - Write filemarks with sg driver and immediate bit set

  Upgrade from 2.0.2-*
  --------------------

    - LSF 6.1-24 or higher must be used
    - The database schema has evolved. Use upgrades/2.0.2_to_2.0.3.sql to upgrade
    - Once the database is upgraded, the content of the lastKnownFileName column
      of the CastorFile table is still empty. It will be updated when the files
      are accessed but you can update it by hand using upgrades/2.0.2_to_2.0.3.pl
      Note that the only disadvantage of not updating is that stager_qry -M will
      not return files that were not updated.
    - For the nameserver, the database must be updated first, using the script
      ns/Cns_oracle_add_ACL.sql. Then the daemons can be updated and finally the
      clients. Note that each step is backward compatible, so that an old daemon
      can run on a new database and an old client can contact a new daemon.

