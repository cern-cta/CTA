COMM
COMM  Copyright (C) 1999-2003 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)$RCSfile: Imakefile,v $ $Revision: 1.18 $ $Date: 2009/08/18 09:43:02 $ CERN IT-PDP/DM Jean-Philippe Baud

COMM    Make volume manager programs.

OPSGRP = OperatorGid
LOGDIR = /var/log/castor
LOGFILE = $(LOGDIR)/vmgrd.log
VMGRCONFIG = VmgrConfigFile
#if BuildSecureVmgr
SECURITYFLAG=-DCSEC
LIBS += -ldl
#endif
CPPFLAGS += -DBIN=\"$(BIN)\" -DLOGFILE=\"$(LOGFILE)\" -DVMGRCONFIG=\"$(VMGRCONFIG)\" -DUSE_ORACLE -I$(ORACLE_HOME)/precomp/public $(SECURITYFLAG)

DependsOnLibrary(ns,castorns)
DependsOnLibrary(common,castorcommon)
DependsOnLibrary(upv,castorupv)

MakeDir($(LOGDIR),0755)
vmgr_oracle_ifce.c: vmgr_oracle_ifce.pc
	proc iname=vmgr_oracle_ifce include=../h  threads=yes char_map=string parse=full prefetch=1000
COMM We overwrite here the default rule for the compilation of vmgr_oracle_ifce in order
COMM to be able to discard the -Werror present in the standard flags. The reason is that
COMM the code generated by proc is full of warnings...
vmgr_oracle_ifce.o: vmgr_oracle_ifce.c
	$(COMPILE.c) $(OUTPUT_OPTION) -Wno-error $<

FilesToClean += vmgr_oracle_ifce.c vmgr_oracle_ifce.lis
VMGRD_OBJS = vmgr_main.Osuf vmgr_oracle_ifce.Osuf vmgr_procreq.Osuf sendrep.Osuf vmgrlogit.Osuf
ORALIBS= -L$(ORACLE_HOME)/lib -lclntsh
NormalProgramTarget(vmgrd,$(VMGRD_OBJS), $(DEPLIB), $(ORALIBS) $(LIBS),750)
ADMMANPAGE(vmgrd)
LOGROTATE(castor-vmgr-server,..,install)
SYSCONFIG(vmgrd,install)
INITSCRIPT(vmgrd,install)
CONFIGFILE(VMGR,..,install)

VMGRLIB_OBJS = vmgr_apiinit.Osuf vmgr_deletedenmap.Osuf vmgr_deletedgnmap.Osuf vmgr_deletelibrary.Osuf vmgr_deletemodel.Osuf vmgr_deletepool.Osuf vmgr_deletetape.Osuf vmgr_deltag.Osuf vmgr_enterdenmap.Osuf vmgr_enterdgnmap.Osuf vmgr_enterlibrary.Osuf vmgr_entermodel.Osuf vmgr_enterpool.Osuf vmgr_entertape.Osuf vmgr_errmsg.Osuf vmgr_gettag.Osuf vmgr_gettape.Osuf vmgr_listdenmap.Osuf vmgr_listdgnmap.Osuf vmgr_listlibrary.Osuf vmgr_listmodel.Osuf vmgr_listpool.Osuf vmgr_listtape.Osuf vmgr_modifylibrary.Osuf vmgr_modifymodel.Osuf vmgr_modifypool.Osuf vmgr_modifytape.Osuf vmgr_querylibrary.Osuf vmgr_querymodel.Osuf vmgr_querypool.Osuf vmgr_querytape.Osuf vmgr_reclaim.Osuf vmgr_settag.Osuf vmgr_tpmounted.Osuf vmgr_updatetape.Osuf send2vmgr.Osuf vmgrcheck.Osuf
ClientSharedLibraryTarget(castorvmgr,$(VMGRLIB_OBJS),$(DEPLIB),$(LIBS))

LIBMANPAGE(vmgr_deletedenmap)
LIBMANPAGE(vmgr_deletedgnmap)
LIBMANPAGE(vmgr_deletelibrary)
LIBMANPAGE(vmgr_deletemodel)
LIBMANPAGE(vmgr_deletepool)
LIBMANPAGE(vmgr_deletetape)
LIBMANPAGE(vmgr_deltag)
LIBMANPAGE(vmgr_enterdenmap)
LIBMANPAGE(vmgr_enterdgnmap)
LIBMANPAGE(vmgr_enterlibrary)
LIBMANPAGE(vmgr_entermodel)
LIBMANPAGE(vmgr_enterpool)
LIBMANPAGE(vmgr_entertape)
LIBMANPAGE(vmgr_gettag)
LIBMANPAGE(vmgr_gettape)
LIBMANPAGE(vmgr_listdenmap)
LIBMANPAGE(vmgr_listdgnmap)
LIBMANPAGE(vmgr_listlibrary)
LIBMANPAGE(vmgr_listmodel)
LIBMANPAGE(vmgr_listpool)
LIBMANPAGE(vmgr_listtape)
LIBMANPAGE(vmgr_modifylibrary)
LIBMANPAGE(vmgr_modifymodel)
LIBMANPAGE(vmgr_modifypool)
LIBMANPAGE(vmgr_modifytape)
LIBMANPAGE(vmgr_querylibrary)
LIBMANPAGE(vmgr_querymodel)
LIBMANPAGE(vmgr_querypool)
LIBMANPAGE(vmgr_querytape)
LIBMANPAGE(vmgr_reclaim)
LIBMANPAGE(vmgr_seterrbuf)
LIBMANPAGE(vmgr_settag)
LIBMANPAGE(vmgr_tpmounted)
LIBMANPAGE(vmgr_updatetape)

VMGRLIB = SharedLibraryTargetName(castorvmgr)
ClientProgramTarget(vmgrdeletedenmap,vmgrdeletedenmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeletedgnmap,vmgrdeletedgnmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeletelibrary,vmgrdeletelibrary.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeletemodel,vmgrdeletemodel.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeletepool,vmgrdeletepool.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeletetape,vmgrdeletetape.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrdeltag,vmgrdeltag.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrenterdenmap,vmgrenterdenmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrenterdgnmap,vmgrenterdgnmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrenterlibrary,vmgrenterlibrary.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrentermodel,vmgrentermodel.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrenterpool,vmgrenterpool.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrentertape,vmgrentertape.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrgettag,vmgrgettag.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlistdenmap,vmgrlistdenmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlistdgnmap,vmgrlistdgnmap.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlistlibrary,vmgrlistlibrary.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlistmodel,vmgrlistmodel.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlistpool,vmgrlistpool.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrlisttape,vmgrlisttape.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrmodifylibrary,vmgrmodifylibrary.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrmodifypool,vmgrmodifypool.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrmodifytape,vmgrmodifytape.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
ClientProgramTarget(vmgrsettag,vmgrsettag.Osuf,$(VMGRLIB) $(DEPLIB),$(VMGRLIB) $(LIBS),755)
EXEMANPAGE(vmgrdeletedenmap)
EXEMANPAGE(vmgrdeletedgnmap)
EXEMANPAGE(vmgrdeletelibrary)
EXEMANPAGE(vmgrdeletemodel)
EXEMANPAGE(vmgrdeletepool)
EXEMANPAGE(vmgrdeletetape)
EXEMANPAGE(vmgrdeltag)
EXEMANPAGE(vmgrenterdenmap)
EXEMANPAGE(vmgrenterdgnmap)
EXEMANPAGE(vmgrenterlibrary)
EXEMANPAGE(vmgrentermodel)
EXEMANPAGE(vmgrenterpool)
EXEMANPAGE(vmgrentertape)
EXEMANPAGE(vmgrgettag)
EXEMANPAGE(vmgrlistdenmap)
EXEMANPAGE(vmgrlistdgnmap)
EXEMANPAGE(vmgrlistlibrary)
EXEMANPAGE(vmgrlistmodel)
EXEMANPAGE(vmgrlistpool)
EXEMANPAGE(vmgrlisttape)
EXEMANPAGE(vmgrmodifylibrary)
EXEMANPAGE(vmgrmodifypool)
EXEMANPAGE(vmgrmodifytape)
EXEMANPAGE(vmgrsettag)
EXEMANPAGE(vmgr)
