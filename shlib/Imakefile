COMM       @(#)$RCSfile: Imakefile,v $ $Revision: 1.15 $ $Date: 2004/06/23 16:57:33 $ CERN IT-PDP/DM Jean-Philippe Baud
COMM
COMM  Copyright (C) 2000-2002 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM

COMM 		Make CASTOR shared libraries           GENERIC

#include <Library.tmpl>

LIB = InstallLibDir

COMM Archive symbol table entry name
#if __osf__ && __alpha
SYMTABNAM = ________64ELEL_
#else
SYMTABNAM = __.SYMDEF
#endif

COMM Libraries to include in SharedLibraryTargetName(shift)
LIBRARIES = $(COMMONLIB) $(RFIOLIB) $(SYSREQLIB) $(HPSSLIB) $(NSLIB) $(STGLIB) $(VMGRLIB) $(UPVLIB) $(RHCLIENTLIB) $(SECURITYLIB) $(RTCOPYLIB) $(VDQMLIB) $(DLFLIB) $(TAPELIB) $(DBLIB) $(MONITORLIB)
LIBRARIES2 = $(RHORALIB)
SHLIBREQLIBS2 = $(SHLIBREQLIBS) -L$(ORACLE_HOME)/lib -locci -lclntsh -L . -lshift
LIBRARIES3 = $(RHPROTOLIB)
SHLIBREQLIBS3 = $(SHLIBREQLIBS)

all:    SharedLibraryTargetName(shift) SharedLibraryTargetName(castorCommonOra) SharedLibraryTargetName(castorProto)

install: $(LIB) FileName($(LIB),SharedLibraryTargetName(shift)) FileName($(LIB),SharedLibraryTargetName(castorCommonOra)) FileName($(LIB),SharedLibraryTargetName(castorProto))

export: $(EXPORTLIB)/SharedLibraryTargetName(shift) $(EXPORTLIB)/SharedLibraryTargetName(castorCommonOra) $(EXPORTLIB)/SharedLibraryTargetName(castorProto)

exportman: 

exportshr: 

libshift.sl libshift.so:     $(LIBRARIES)
	@echo " making $@ in `pwd`"
	@-rm -rf tmp
	@mkdir tmp
	@for i in $? ;\
	do (cd tmp; $(AR) x ../$$i; rm -f $(SYMTABNAM)) done
	@(cd tmp; $(CXX) $(SHLIBLDFLAGS) -o ../$@ *.o $(SHLIBREQLIBS))
	@-rm -rf tmp

libcastorCommonOra.so: $(LIBRARIES2)
	@echo " making $@ in `pwd`"
	@-rm -rf tmp
	@mkdir tmp
	@for i in $? ;\
	do (cd tmp; $(AR) x ../$$i; rm -f $(SYMTABNAM)) done
	@(cd tmp; $(CXX) $(SHLIBLDFLAGS) -o ../$@ *.o $(SHLIBREQLIBS2))
	@-rm -rf tmp

libcastorProto.so: $(LIBRARIES3)
	@echo " making $@ in `pwd`"
	@-rm -rf tmp
	@mkdir tmp
	@for i in $? ;\
	do (cd tmp; $(AR) x ../$$i; rm -f $(SYMTABNAM)) done
	@(cd tmp; $(CXX) $(SHLIBLDFLAGS) -o ../$@ *.o $(SHLIBREQLIBS3))
	@-rm -rf tmp

shift.dll:	$(LIBRARIES)
	@echo  making $@ in CurDir
	link /dll /noentry /nologo /out:$@ $**

libcastorCommonOra.dll:	$(LIBRARIES2)
	@echo  making $@ in CurDir
	link /dll /noentry /nologo /out:$@ $**

libcastorProto.dll:	$(LIBRARIES2)
	@echo  making $@ in CurDir
	link /dll /noentry /nologo /out:$@ $**

MakeDir($(LIB),root,bin,0755)

InstallSharedLibrary(shift,__CASTOR_VERSION__,$(LIB))
InstallSharedLibrary(castorCommonOra,__CASTOR_VERSION__,$(LIB))
InstallSharedLibrary(castorProto,__CASTOR_VERSION__,$(LIB))

InstallSharedLibrary(shift,__CASTOR_VERSION__,$(EXPORTLIB))
InstallSharedLibrary(castorCommonOra,__CASTOR_VERSION__,$(EXPORTLIB))
InstallSharedLibrary(castorProto,__CASTOR_VERSION__,$(EXPORTLIB))

install.man:

#if _WIN32
clean:
	@echo cleaning in CurDir
	-@RemoveFiles(FilesToClean)
#else
clean:
	@echo cleaning in CurDir
	-@RemoveFiles(FilesToClean)
	-@rm -rf tmp > /dev/null 2>&1
#endif
clobber:        clean

Makefiles:

MakeDepLibrary(common,common)

MakeDepLibrary(rfio,rfio)

MakeDepLibrary(sysreq,sysreq)

#if BuildHpssClient
MakeDepLibrary(hpss,hpss_common)
#endif

MakeDepLibrary(ns,ns)

MakeDepLibrary(stage,stage)

MakeDepLibrary(vmgr,vmgr)

MakeDepLibrary(upv,upv)

MakeDepLibrary(castor,castorClient)

MakeDepLibrary(castor/proto,castorProto)

MakeDepLibrary(rtcopy,rtcpapi)

MakeDepLibrary(vdqm,vdqmapi)

MakeDepLibrary(dlf,dlf)

MakeDepLibrary(tape,tape)

MakeDepLibrary(castor/db/ora,castorCommonOra)

FORCE:

