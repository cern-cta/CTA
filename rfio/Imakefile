COMM   @(#)Imakefile,v 1.51 2004/06/09 16:10:36 IT-PDP/DM  Jean-Philippe Baud
COMM
COMM  Copyright (C) 1990-2003 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM

COMM 		Make rfio library and daemon            GENERIC

COMM
COMM Define the file indicating that no more RFIO requests
COMM should be issued.
COMM

CPPFLAGS += -DSACCT -DNOMORERFIO=RfioNoMore -DRFIOLOGFILE=RfioLogFile \
	    -DCNS_ROOT=NsRoot $(STAGERSUPERUSER) $(STAGERSUPERGROUP) -DFORTRAN

RFIOLIB = DepSharedLibraryTargetName(rfio,castorrfio)

#if UseGSI
GLOBUS_LOCATION=GlobusLocation
GLOBUS_FLAVOUR=GlobusFlavour/**/pthr
GLOBUS_LIBS=-L$(GLOBUS_LOCATION)/lib
LIB_CRYPTO=$(shell if [ -r "$(GLOBUS_LOCATION)/lib/libcrypto_$(GLOBUS_FLAVOUR).so" ]; then echo -lcrypto_$(GLOBUS_FLAVOUR); else echo -lcrypto; fi)
LIBCSEC += $(GLOBUS_LIBS) $(LIB_CRYPTO)
#endif
AddLdFlags(-ldl)

#if UseXFSPrealloc
CFLAGS += -DUSE_XFSPREALLOC
#endif

CKSUMLIB = -lz

CommonDependsOnLibrary(common,castorcommon)
CommonDependsOnLibrary(ns,castorns)
CommonDependsOnLibrary(dlf,castordlf)
CommonDependsOnLibrary(security,castorsecurity)
CommonDependsOnLibrary(castor,castorclient)

RFIOLIB_OBJS = access.o alrm.o chdir.o checkkey.o chmod.o \
		chown.o close.o closedir.o connect.o error.o \
		fchmod.o fchown.o fclose.o feof.o ferror.o \
		fflush.o fileno.o fio.o fopen.o \
		fread.o fseek.o fstat.o ftell.o \
		fwrite.o getc.o getcwd.o lockf.o \
		lseek.o lstat.o lun2fn.o misc.o \
		mkdir.o mstat.o msymlink.o munlink.o open.o opendir.o parse.o  \
		pclose.o popen.o pread.o preseek.o pwrite.o \
		read.o readdir.o readlink.o rename.o rewinddir.o \
		rfio_HsmIf.o rfio_rdirfdt.o rfio_rfilefdt.o \
		rfstatfs.o rmdir.o setopt.o stat.o statfs.o stream.o \
		switch_req.o symlink.o unlink.o write.o xyclose.o xyopen.o \
		xyread.o xywrite.o \
		fopen64.o fseeko64.o fstat64.o ftello64.o \
		lockf64.o lseek64.o open64.o \
		preseek64.o read64.o stream64.o write64.o RfioTURL.o
ClientSharedLibraryTarget(castorrfio,$(RFIOLIB_OBJS),,)

ClientProgramTarget(rfcat,rfcat.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfchmod,rfchmod.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfcp,rfcp.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfstat,rfstat.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfrm,rfrm.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfdir,rfdir.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfmkdir,rfmkdir.o, $(RFIOLIB), $(RFIOLIB),755)
ClientProgramTarget(rfrename,rfrename.o, $(RFIOLIB), $(RFIOLIB),755)

EXEMANPAGE(rfcat)
EXEMANPAGE(rfchmod)
EXEMANPAGE(rfcp)
EXEMANPAGE(rfrm)
EXEMANPAGE(rfdir)
EXEMANPAGE(rfmkdir)
EXEMANPAGE(rfrename)
LIBMANPAGE(rfio_access)
LIBMANPAGE(rfio_chmod)
LIBMANPAGE(rfio_chown)
LIBMANPAGE(rfio_close)
LIBMANPAGE(rfio_closedir)
LIBMANPAGE(rfio_fchmod)
LIBMANPAGE(rfio_fclose)
LIBMANPAGE(rfio_feof)
LIBMANPAGE(rfio_ferror)
LIBMANPAGE(rfio_fflush)
LIBMANPAGE(rfio_fileno)
LIBMANPAGE(rfio_fopen)
LIBMANPAGE(rfio_fopen64)
LIBMANPAGE(rfio_fread)
LIBMANPAGE(rfio_fseek)
LIBMANPAGE(rfio_fseeko64)
LIBMANPAGE(rfio_fstat)
LIBMANPAGE(rfio_fstat64)
LIBMANPAGE(rfio_ftell)
LIBMANPAGE(rfio_ftello64)
LIBMANPAGE(rfio_fwrite)
LIBMANPAGE(rfio_lockf)
LIBMANPAGE(rfio_lockf64)
LIBMANPAGE(rfio_lseek)
LIBMANPAGE(rfio_lseek64)
LIBMANPAGE(rfio_lstat)
LIBMANPAGE(rfio_lstat64)
LIBMANPAGE(rfio_mkdir)
LIBMANPAGE(rfio_mstat)
LIBMANPAGE(rfio_mstat64)
LIBMANPAGE(rfio_munlink)
LIBMANPAGE(rfio_msymlink)
LIBMANPAGE(rfio_open)
LIBMANPAGE(rfio_open64)
LIBMANPAGE(rfio_opendir)
LIBMANPAGE(rfio_pclose)
LIBMANPAGE(rfio_perror)
LIBMANPAGE(rfio_popen)
LIBMANPAGE(rfio_preseek)
LIBMANPAGE(rfio_preseek64)
LIBMANPAGE(rfio_read)
LIBMANPAGE(rfio_readdir)
LIBMANPAGE(rfio_readlink)
LIBMANPAGE(rfio_rename)
LIBMANPAGE(rfio_rewinddir)
LIBMANPAGE(rfio_rmdir)
LIBMANPAGE(rfio_serror)
LIBMANPAGE(rfio_stat)
LIBMANPAGE(rfio_stat64)
LIBMANPAGE(rfio_statfs)
LIBMANPAGE(rfio_symlink)
LIBMANPAGE(rfio_unlink)
LIBMANPAGE(rfio_write)
LIBMANPAGE(rfioreadopt)
LIBMANPAGE(rfiosetopt)

MakeDir(LogPath,0755)
SRVOBJS = Csemaphore.o rfio_serv.o rfio_calls.o \
		rfio_call64.o rfio_fcalls.o rfio_callhandlers.o switch_req.o \
		checkkey.o fio.o rfstatfs.o alrm.o \
		rfioacct.o RemoteJobSvc.o stager_catalogInterface.o \
		stager_util.o stager_messages.o stager_extern_globals.o \
		stager_uuid.o
#if UseXFSPrealloc
SRVOBJS += rfio_alignedbuf.o rfio_xfsprealloc.o
#endif

NormalProgramTarget(rfiod,$(SRVOBJS),$(RFIOLIB),$(RTFLAGS) $(RTLIBS) $(LIBCSEC) $(RFIOLIB) $(CKSUMLIB),755)
LOGROTATE(castor-rfio-server,install)
SYSCONFIG(rfiod,install)
INITSCRIPT(rfiod,install)

EXEMANPAGE(rfiod)

