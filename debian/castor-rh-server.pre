if [ -f /etc/rc.d/init.d/rhserver ]; then
    /sbin/service rhserver stop > /dev/null 2>&1 || :
fi
# Move old log files to /var/log/castor
if [ -d /var/spool/rhserver ]; then
    /bin/mkdir /var/log/castor 2>/dev/null
    for src in `ls /var/spool/rhserver/log.*.gz 2>/dev/null`; do
        dest=`basename $src | sed 's/log/rhd.log/'`
        /bin/mv $src /var/log/castor/$dest 2>/dev/null
    done
    /bin/mv /var/spool/rhserver/log /var/log/castor/rhd.log 2>/dev/null
    /bin/chmod 644 /var/log/castor/rhd.* 2>/dev/null
    # Correct the selinux context of the new log files
    if [ -x /usr/bin/chcon ]; then
      /usr/bin/chcon -R --reference=/var/log/castor /var/log/castor > /dev/null 2>&1
    fi
    # Remove old log directory
    /bin/rm -rf /var/spool/rhserver 2>/dev/null || :
fi
