COMM
COMM  Copyright (C) 2000-2003 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)$RCSfile: Imakefile,v $ $Revision: 1.9 $ $Date: 2005/06/28 13:11:58 $ CERN IT-PDP/DM Jean-Philippe Baud
 
COMM    Make HSM admin tools.

#include <Project.tmpl>

INCLUDES = FileName(..,h)
INCLUDES_CPP = FileName(..,)

#if UseTms
TMS = TMS
#else
TMS = NOTMS
#endif
#if _AIX
LIBS = -L../shlib -lshift
#else
#if defined(__alpha) && defined(__osf__)
LIBS = -no_so -L../shlib -lshift -so_archive
#else
#if hpux
LIBS = -L../shlib -lshift
#else
#if linux
LIBS = -L../shlib -lshift $(ADNSLIB) -lnsl
#else
#if sgi
LIBS = -L../shlib -lshift
#else
#if SOLARIS
LIBS = -L../shlib -lshift -lsocket -lnsl
#else
#if _WIN32
LIBS = ..\lib\shift.lib wsock32.lib ws2_32.lib /NODEFAULTLIB:libc.lib advapi32.lib
#endif
#endif
#endif
#endif
#endif
#endif
#endif
#if _WIN32
LIBS2 = $(LIBS) ..\lib\castorCommonOra.lib
#else
LIBS2 = $(LIBS) -L../shlib -lcastorCommonOra
#endif
SPOOL = HsmToolsSpool
PERLLIBDIR = "/usr/lib/perl/CASTOR"
 
COMM######################### FLAGS ##############################
 
DFLAGS = -D$(TMS)
 
CFLAGS =        -I$(INCLUDES) -I$(INCLUDES_CPP) $(DFLAGS)
 
COMM######################### DEPENDENCY LIBRARIES ###############
 
DEPLIB = DepSharedLibraryTargetName(shlib,shift)
DEPLIB2 = $(DEPLIB) DepSharedLibraryTargetName(shlib,castorCommonOra)
COMM######################### RULES ##############################

MANPAGES = $(MANDIR)/reclaim.$(MANSUFFIX) \
	   $(MANDIR)/repack.$(MANSUFFIX) \
	   $(MANDIR)/tapetohsm.$(MANSUFFIX) \
	   $(MANDIR)/enterFileClass.$(MANSUFFIX) \
	   $(MANDIR)/modifyFileClass.$(MANSUFFIX) \
	   $(MANDIR)/deleteFileClass.$(MANSUFFIX)
EXPORTMANPAGES = FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),reclaim.$(MANSUFFIX))) \
		 FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),repack.$(MANSUFFIX))) \
		 FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),tapetohsm.$(MANSUFFIX))) \
		 FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),enterFileClass.$(MANSUFFIX))) \
		 FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),modifyFileClass.$(MANSUFFIX))) \
		 FileName($(EXPORTMAN),FileName(man$(MANSUFFIX),deleteFileClass.$(MANSUFFIX)))

PROGS =  ProgramTargetName(reclaim) \
	 ProgramTargetName(repack) \
	 ProgramTargetName(tapetohsm) \
	 ProgramTargetName(enterFileClass) \
	 ProgramTargetName(modifyFileClass) \
	 ProgramTargetName(deleteFileClass) \
	 ProgramTargetName(printFileClass) \
	 ProgramTargetName(enterSvcClass) \
	 ProgramTargetName(modifySvcClass) \
	 ProgramTargetName(deleteSvcClass) \
	 ProgramTargetName(printSvcClass) \
	 ProgramTargetName(listSvcClass)
IPROGS = FileName($(BIN),ProgramTargetName(reclaim)) \
	 FileName($(BIN),ProgramTargetName(repack)) \
	 FileName($(BIN),ProgramTargetName(tapetohsm)) \
	 FileName($(BIN),ProgramTargetName(enterFileClass)) \
	 FileName($(BIN),ProgramTargetName(modifyFileClass)) \
	 FileName($(BIN),ProgramTargetName(deleteFileClass)) \
	 FileName($(BIN),ProgramTargetName(printFileClass)) \
	 FileName($(BIN),ProgramTargetName(enterSvcClass)) \
	 FileName($(BIN),ProgramTargetName(modifySvcClass)) \
	 FileName($(BIN),ProgramTargetName(deleteSvcClass)) \
	 FileName($(BIN),ProgramTargetName(printSvcClass)) \
	 FileName($(BIN),ProgramTargetName(listSvcClass))
EPROGS = $(EXPORTBIN)/reclaim \
	 $(EXPORTBIN)/repack \
	 $(EXPORTBIN)/tapetohsm \
	 $(EXPORTBIN)/enterFileClass \
	 $(EXPORTBIN)/modifyFileClass \
	 $(EXPORTBIN)/deleteFileClass \
	 $(EXPORTBIN)/printFileClass \
	 $(EXPORTBIN)/enterSvcClass \
	 $(EXPORTBIN)/modifySvcClass \
	 $(EXPORTBIN)/deleteSvcClass \
	 $(EXPORTBIN)/printSvcClass \
	 $(EXPORTBIN)/listSvcClass

IPERL = FileName($(PERLLIBDIR),castor_tools.pm)
EPERL = $(EXPORTPERL)/castor_tools.pm

all: $(PROGS)

NormalProgramTarget(reclaim,reclaim.Osuf,$(DEPLIB),$(LIBS))
NormalProgramTarget(repack,repack.Osuf,$(DEPLIB),$(LIBS))
NormalProgramTarget(tapetohsm,tapetohsm.Osuf,$(DEPLIB),$(LIBS))
NormalProgramTarget(enterFileClass,enterFileClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(modifyFileClass,modifyFileClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(deleteFileClass,deleteFileClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(printFileClass,printFileClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(enterSvcClass,enterSvcClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(modifySvcClass,modifySvcClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(deleteSvcClass,deleteSvcClass.Osuf,$(DEPLIB2),$(LIBS2))
NormalProgramTarget(printSvcClass,printSvcClass.Osuf,$(DEPLIB2),$(LIBS2))

MakeDepSharedLibrary(shlib,shift)
MakeDepSharedLibrary(shlib,castorCommonOra)

install: $(BIN) $(IPROGS) $(SPOOL) $(PERLLIBDIR) $(IPERL)

InstallProgram(reclaim,$(BIN),root,bin,755)
IEXPORT(reclaim,$(EXPORTBIN),755);

InstallProgram(repack,$(BIN),root,bin,755)
IEXPORT(repack,$(EXPORTBIN),755);

InstallProgram(tapetohsm,$(BIN),root,bin,755)
IEXPORT(tapetohsm,$(EXPORTBIN),755);

InstallProgram(enterFileClass,$(BIN),root,bin,755)
IEXPORT(enterFileClass,$(EXPORTBIN),755);

InstallProgram(modifyFileClass,$(BIN),root,bin,755)
IEXPORT(modifyFileClass,$(EXPORTBIN),755);

InstallProgram(deleteFileClass,$(BIN),root,bin,755)
IEXPORT(deleteFileClass,$(EXPORTBIN),755);

InstallProgram(printFileClass,$(BIN),root,bin,755)
IEXPORT(printFileClass,$(EXPORTBIN),755);

InstallProgram(enterSvcClass,$(BIN),root,bin,755)
IEXPORT(enterSvcClass,$(EXPORTBIN),755);

InstallProgram(modifySvcClass,$(BIN),root,bin,755)
IEXPORT(modifySvcClass,$(EXPORTBIN),755);

InstallProgram(deleteSvcClass,$(BIN),root,bin,755)
IEXPORT(deleteSvcClass,$(EXPORTBIN),755);

InstallProgram(printSvcClass,$(BIN),root,bin,755)
IEXPORT(printSvcClass,$(EXPORTBIN),755);

InstallNonExecFile(castor_tools.pm,$(PERLLIBDIR),root,bin,755)
IEXPORT(castor_tools.pm,$(EXPORTPERL),755);

InstallProgram(listSvcClass,$(BIN),root,bin,755)
IEXPORT(listSvcClass,$(EXPORTBIN),755);

MakeDir($(BIN),root,bin,0755)
MakeDir($(SPOOL),root,bin,0755)
MakeDir($(PERLLIBDIR),root,bin,0755)
 
install.man: $(MANDIR) $(MANPAGES)

MakeDir($(MANDIR),root,bin,0755)

IMANPAGE(reclaim,$(MANDIR),$(MANSUFFIX))
IMANPAGE(repack,$(MANDIR),$(MANSUFFIX))
IMANPAGE(tapetohsm,$(MANDIR),$(MANSUFFIX))
IMANPAGE(enterFileClass,$(MANDIR),$(MANSUFFIX))
IMANPAGE(modifyFileClass,$(MANDIR),$(MANSUFFIX))
IMANPAGE(deleteFileClass,$(MANDIR),$(MANSUFFIX))
EMANPAGE(reclaim,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))
EMANPAGE(repack,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))
EMANPAGE(tapetohsm,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))
EMANPAGE(enterFileClass,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))
EMANPAGE(modifyFileClass,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))
EMANPAGE(deleteFileClass,FileName($(EXPORTMAN),man$(MANSUFFIX)),$(MANSUFFIX))

export: $(EPROGS) $(EXPORTPERL) $(EPERL)

exportman: $(EXPORTMANPAGES)

exportshr:

COMM###################### CLEANING RULES ########################
 
clean:
	-@RemoveFiles(FilesToClean)
 
clobber:        clean
	-@RemoveFiles($(PROGS))
 
#if _WIN32
depend:
	@echo Not supported on this platform
#else
depend:
	makedepend -Y$(INCLUDES) *.c 2> /dev/null
#endif

Makefiles:
 
FORCE:

COMM###################### DEPENDENCIES ##########################

COMM DO NOT DELETE THIS LINE -- make  depend  depends  on  it.
