.\" $Id: stagechng.man,v 1.18 2003/05/12 12:45:10 jdurand Exp $
.\"
.\" @(#)$RCSfile: stagechng.man,v $ $Revision: 1.18 $ $Date: 2003/05/12 12:45:10 $ CERN IT-PDP/DM Jean-Damien Durand
.\" Copyright (C) 2001-2002 by CERN/IT/DS/HSM
.\" All rights reserved
.\"
.TH STAGECHNG "1" "$Date: 2003/05/12 12:45:10 $" "CASTOR" "Stage User Commands"
.SH NAME
stagechng \- change status and time dependency of records in the stager catalog
.SH SYNOPSIS
.B stagechng
[
.BI \-h " host"
] [
.BI \-p " poolname"
]
.I files
.LP
.B stagechng
[
.BI \-h " host"
] [
.BI \-M " hsmfile"
] [
.BI \-\-mintime " mintime"
]  [
.BI \-p " poolname"
]  [
.BI \-\-hsmcreat
]  [
.BI \-\-reqid " reqid"
] [
.BI \-\-retenp " retenp"
] [
.BI \-\-status " status"
]
.SH DESCRIPTION
In the first form, 
.BI stagechng
changes request in status STAGED to status STAGEOUT in the stager catalog.
The file must be in state STAGED and corresponding to an HSM file.
.I file
may be a local path, the combination
.I machine:fullpath
(NFS syntax) or a full path starting with the NFS_ROOT, i.e. /shift.
.LP
In the second form, 
.BI stagechng
can change the 
.BI mintime
before migration, the retention period on disk (
.BI retenp
) and the
.BI status
of an 
.BI hsmfile.
The status can be an explicit value that correspond to a bit-OR'ed of several values, known only a-priori to stager gurus. Neverthless the shortcuts
.BI CAN_BE_MIGR
and
.BI STAGEOUT|CAN_BE_MIGR
, \fBonly\fP in the scope of this application, are provided and are considered equivalent (
.BI stagechng
will convert them to a single value). That is, if you say \-\-status CAN_BE_MIGR, it will be converted to the explicit value equivalent of STAGEOUT|CAN_BE_MIGR, which is the the bit-OR'ed value that describes a candidate for migration in the stager. Although, in theory, all bit-OR'ed allowed values could be supported, the functionnality of this command is restricted to the only one possible option value which is \fBCAN_BE_MIGR\fP (or \fBSTAGEOUT|CAN_BE_MIGR\fP). This \-\-status option value is then useful only if you want to put back in migration candidates stack a file that was put in PUT_FAILED status, e.g. for which a previous migration has failed or could not have been executed for configuration reasons.
.SH OPTIONS
.TP
.BI \-h " host"
Sends the request to the stager on
.IR host .
This may also be specified thru the environment variable STAGE_HOST.
.TP
.BI \-M " hsmfile"
Restrict the action on CASTOR HSM name that is
.IR hsmfile .
.TP
.BI \-\-mintime " mintime"
Sets the minimum time before migration, with respect to original value of its fileclass. You cannot extend a minimum time before migration, only decrease it. Default unit is in second. If the option value ends with 'S', 's', second is also assumed. If it ends with 'M' or 'm', unit is the minute. If it ends with 'H' or 'h', unit is the hour. If it ends with 'D' or 'd', unit is the day. With 'Y' or 'y', unit is the year (365 days).
.TP
.BI \-p " poolname"
Restrict the pools where file is to be searched in pool
.IR poolname .
This may also be specified thru the environment variable STAGE_POOL.
.TP
.BI \-\-hsmcreat
Creates file in the Name Server if necessary.
.TP
.BI \-\-reqid " reqid"
Forces the search to this internal request id.
.TP
.BI \-\-retenp " retenp"
Sets the retention period on disk. Applies only for
.IR STAGED
files. Default unit is in day. If the option value ends with 'S', 's', second is assumed. If it ends with 'M' or 'm', unit is the minute. If it ends with 'H' or 'h', unit is the hour. If it ends with 'D' or 'd', unit is the day. With 'Y' or 'y', unit is the year (365 days). Special keywords \fBAS_LONG_AS_POSSIBLE\fP and \fBINFINITE_LIFETIME\fP are supported. Special values are: \-1 (reset to default fileclass value) and 0 (advisory delete). Except for \fBAS_LONG_AS_POSSIBLE\fP and \fB\-1\fP, any value is checked against a maximum that is a pool parameter setted at the stager daemon level. 
.TP
.BI \-\-status " status"
Sets the internal status. Only
.IR CAN_BE_MIGR
or its equivalent
.IR STAGEOUT|CAN_BE_MIGR
option values are supported.
.SH RETURN CODES
\
.br
0       Ok.
.br
1       Bad parameter.
.br
2       System error.
.br
3       Unknown error.

.SH SEE ALSO
\fBstageqry\fP(1)

.SH AUTHOR
\fBCASTOR\fP Team <castor.support@cern.ch>
