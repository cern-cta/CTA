


STGDAEMON(l)      Misc. Reference Manual Pages       STGDAEMON(l)



NNNNAAAAMMMMEEEE
     stgdaemon - starts the stage daemon

SSSSYYYYNNNNOOOOPPPPSSSSIIIISSSS
     ssssttttggggddddaaaaeeeemmmmoooonnnn

DDDDEEEESSSSCCCCRRRRIIIIPPPPTTTTIIIIOOOONNNN
     The ssssttttggggddddaaaaeeeemmmmoooonnnn command starts the stage daemon.  This command
     is  usually executed at system startup time (////eeeettttcccc////rrrrcccc....llllooooccccaaaallll).
     This will read the pool configuration file, the stage  cata-
     log   to   remove  uncompleted  transactions  and  look  for
     requests.  Short requests like ssssttttaaaaggggeeeeqqqqrrrryyyy are processed in the
     main  loop.  The  daemon  forks  overlays  to  execute  long
     requests like disk/tape copy or pool cleanup.   In  case  of
     system  error,  the  commands are automatically retried from
     the failing subrequest.  If a file nnnnoooommmmoooorrrreeeessssttttaaaaggggeeee exists in the
     operator  directory,  new stage commands will be rejected by
     the daemon and will wait on the client side.  All error mes-
     sages and statistical information are kept in a log.  On all
     client hosts and on the stager host there should be  entries
     for the stager in ////eeeettttcccc////sssseeeerrrrvvvviiiicccceeeessss like:

          rfio               5001/tcp                           #
               Remote File Access System

          stage           5007/tcp                        # SHIFT
               stager

     On  all  client  hosts  there  should   be   an   entry   in
     ////eeeettttcccc////sssshhhhiiiifffftttt....ccccoooonnnnffff giving the stager hostname.  For example:

          STG     HOST            shd02
     The stager hostname may also be specified thru the  environ-
     ment variable STAGE_HOST.

     If  TMS  is  used,  there  should  also  be  an   entry   in
     ////eeeettttcccc////sssseeeerrrrvvvviiiicccceeeessss like:

          sysreq             4001/tcp                           #
               SYSREQ/TCP

     On all disk servers having filesystems in the pool(s), there
     should be three entries in ////eeeettttcccc////sssshhhhiiiifffftttt....ccccoooonnnnffff giving permission
     to the stager to execute programs, unlink  files  or  create
     directories  as  root.  The server where ssssttttggggddddaaaaeeeemmmmoooonnnn runs does
     not need these entries.  For example:

          RFIOD   POPENTRUST      shd02
          RFIOD   LINKTRUST       shd02
          RFIOD   MKDIRTRUST      shd02
          RFIOD   CHOWNTRUST      shd02




SunOS 5.5.1           Last change: 05/18/95                     1






STGDAEMON(l)      Misc. Reference Manual Pages       STGDAEMON(l)



     There must be one entry in the configuration file  per  pool
          giving:

          POOL name this will be used as ---- pppp  parameter  in  user
               commands

          DEFSIZE   maximum filesize if the  ---- ssss  option  is  not
               specified on user commands

          MINFREE   minimum free space to  be  available  in  the
               pool.  This is a percentage.  For example, MMMMIIIINNNNFFFFRRRREEEEEEEE
               11110000 corresponds to 10% of free space.

          GC   full path name of the  garbage  collector  program
               (NFS syntax).

     There must be also one entry per pool element giving:

          server         full path of the stage directory

by an entry
     If several pools are configured, a default pool must  be  defined

          DEFPOOL        default pool name

     The stage catalog contains the following information:
          maximum block size
          density
          device group
          file id
          file status: new = 'n', old = 'o'
          file sequence number requested by user
          keep flag; if non zero, keep data on  disk  after  suc-
          cessful stagewrt
          label type: al, nl, sl or blp
          record length
          number of blocks/records to be copied
          pool name
          record format
          retention period in days
          size in Mbytes of data to be staged
          tape server specified by user
          Tflag; if non zero,  do not check trailer labels
          visual_identifier(s)
          volume_serial_number(s)
          internal path
          user group
          login name
          uid
          gid
          umask
          request id



SunOS 5.5.1           Last change: 05/18/95                     2






STGDAEMON(l)      Misc. Reference Manual Pages       STGDAEMON(l)



          status
          actual_size
          creation time
          last access time
          nb of accesses

     A secondary catalog contains the list of symbolic  links  to
     the staged files.

     In  the  log  each  entry  has  a  timestamp.   All  entries
     corresponding  to one request have the same request id.  For
     each user command there is one message STG98 giving the com-
     mand,  one message STG97 per try to stage a file or one mes-
     sage STG96 if the file was already staged and a  final  mes-
     sage  STG99 giving the return code.  The message STG97 gives
     the following information:  internal file path, tape server,
     tape unit, network interface, actual file size, waiting time
     and transfer time.  The message  STG96  gives  the  internal
     file path and the current number of accesses to the file.  A
     message STG95 giving the internal file path appears  in  the
     log every time a file is deleted.

FFFFIIIILLLLEEEESSSS
     ////eeeettttcccc////SSSSTTTTGGGGCCCCOOOONNNNFFFFIIIIGGGG configuration file

     ////uuuussssrrrr////ssssppppoooooooollll////ssssttttaaaaggggeeee////ssssttttggggccccaaaatttt
                    main catalog

     ////uuuussssrrrr////ssssppppoooooooollll////ssssttttaaaaggggeeee////ssssttttggggppppaaaatttthhhh
                    secondary catalog (symbolic links)

     ////uuuussssrrrr////ssssppppoooooooollll////ssssttttaaaaggggeeee////lllloooogggg

     ////eeeettttcccc////ooooppppeeeerrrraaaattttoooorrrr////nnnnoooommmmoooorrrreeeessssttttaaaaggggeeee

EEEEXXXXAAAAMMMMPPPPLLLLEEEESSSS
     Here is an example of a configuration file:

          #
          #               shd02 stager configuration
          #
          POOL   stagetest   DEFSIZE   200    MINFREE    10    GC
          shd02:/usr/local/bin/stage_clean
            shd02 /stage


     Here is a simple example of a stage_clean script:

          stageqry -a -p $1 -S  |  cut -c31-  |  cut -d" " -f1  |
          stageclr -c -i -p $1





SunOS 5.5.1           Last change: 05/18/95                     3






STGDAEMON(l)      Misc. Reference Manual Pages       STGDAEMON(l)



     Here is a small log:

          01/12 17:52:18     1 stgdaemon: STG98 - stageqry
          01/12 17:52:27     2 stgdaemon: STG98 - stageqry -s
          01/12  17:54:45      3  stgdaemon:  STG98   -   stagein
          -vCZ0134 -g CART -d 38000 -l al fort.41
          01/12    18:11:42        3    stgdaemon:    STG97     -
          shd02:CZ0134.1.al    staged    by   (baud,c3),   server
          shd03.cern.ch  unit  cartST0   ifce  le0   size  324000
          wtim 1006  ttim 4 rc 0
          01/12 18:11:52     3 sendrep: STG99 - stage returns 0
          01/13 07:13:50     8 stgdaemon: STG98 - stageqry -P
          01/13  07:15:39      9  stgdaemon:  STG98   -   stagein
          -vCZ0134 -g CART -d 38000 -l al fort.42
          01/13 07:15:39     9  stgdaemon:  STG96  -  CZ0134.1.al
          already staged, size = 324000 (.3MB), nbaccess = 2
          01/13 07:15:39     9 sendrep: STG99 - stage returns 0
          01/13 07:15:46    10 stgdaemon: STG98 - stageqry
          01/13  07:18:28     12  stgdaemon:  STG98   -   stagein
          -vCZ0134 -q1,2 -g CART -d 38000 -l al fort.43 fort.44
          01/13 07:18:28    12  stgdaemon:  STG96  -  CZ0134.1.al
          already staged, size = 324000 (.3MB), nbaccess = 3
          01/13 07:18:41    14 stgdaemon: STG98 - stageqry
          01/13    07:30:07       12    stgdaemon:    STG97     -
          shd02:CZ0134.2.al    staged    by   (baud,c3),   server
          shd03.cern.ch  unit  cartST1   ifce  le0   size  648000
          wtim 687  ttim 6 rc 0
          01/13 07:30:17    12 sendrep: STG99 - stage returns 0



























SunOS 5.5.1           Last change: 05/18/95                     4



