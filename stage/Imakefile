COMM
COMM  Copyright (C) 1993-2001 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM
COMM       @(#)$RCSfile: Imakefile,v $ $Revision: 1.9 $ $Date: 2008/11/26 14:51:58 $ CERN IT-PDP/DM Jean-Philippe Baud Jean-Damien Durand

COMM 	Make stage daemon programs. 

CPSHELL = /bin/sh
TMS = NOTMS
VMGR = VMGR
NOMORESTAGE = OperatorDir/nomorestage
NOMOREMIGR = OperatorDir/nomoremigr
OPSDIR = OperatorDir
OPSGRP = OperatorGid
SPOOL = StageSpool
STAGEHOST = StageHost
SACCTDIR = SacctDir
SACCTFILE = SacctDir/sacct
ACCTFILE = -DACCTFILE=\"$(SACCTFILE)\"
STAGEACCT = stageacct.Osuf
ACCTFLAG = -DSACCT
STGGRP = StagerGid
STGCONFIG = StageConfigFile

#if BuildNameServerLibrary
#ifdef NsRoot
NSROOT0 = NsRoot
NSROOT  = -DNSROOT=\"$(NSROOT0)\"
#endif
#ifdef NsHostPfx
NSHOSTPFX0 = NsHostPfx
NSHOSTPFX  = -DNSHOSTPFX=\"$(NSHOSTPFX0)\"
#endif
#ifdef NsHost
NSHOST0 = NsHost
NSHOST  = -DNSHOST=\"$(NSHOST0)\"
#endif
#endif

#ifdef NfsRoot
NFSROOT0 = NfsRoot
NFSROOT  = -DNFSROOT=\"$(NFSROOT0)\"
#endif

#ifdef StagerSuperUser
STAGERSUPERUSER0 = StagerSuperUser
#else
STAGERSUPERUSER0 = stage
#endif
#ifdef StagerSuperGroup
STAGERSUPERGROUP0 = StagerSuperGroup
#else
STAGERSUPERGROUP0 = st
#endif
STAGERSUPERUSER  = -DSTAGERSUPERUSER=\"$(STAGERSUPERUSER0)\"
STAGERSUPERGROUP = -DSTAGERSUPERGROUP=\"$(STAGERSUPERGROUP0)\"

DFLAGS = -DBIN=\"$(BIN)\" \
	 -DLOGFILE=\"$(SPOOL)/log\" \
	 -DMIGLOGFILE=\"$(SPOOL)/mig_log\" \
	 -DSTAGEHOST=\"$(STAGEHOST)\" \
	 -DSTGCAT=\"$(SPOOL)/stgcat\" \
	 -DSTGPATH=\"$(SPOOL)/stgpath\" \
	 -DSTGCONFIG=\"$(STGCONFIG)\" \
	 -DSTGGRP=\"$(STGGRP)\" \
	 -DNOMORESTAGE=\"$(NOMORESTAGE)\" \
	 -DNOMOREMIGR=\"$(NOMOREMIGR)\" \
	 -D$(TMS) -D$(VMGR) $(ACCTFLAG) $(ACCTFILE) \
	 $(NSROOT) $(NSHOSTPFX) $(NSHOST) $(NFSROOT) $(STAGERSUPERUSER) $(STAGERSUPERGROUP)

CFLAGS = -g -I../h $(DFLAGS) $(MTCCFLAGS)

DependsOnLibrary(common,castorcommon)
DependsOnLibrary(vmgr,castorvmgr)
DependsOnLibrary(rfio,castorrfio)
DependsOnLibrary(ns,castorns)

#if BuildStageClientOld
NormalProgramTarget(stagein, stagein.Osuf getlisttp.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
LinkFile(stageout,stagein,root,bin,755)
NormalProgramTarget(stageput, stageput.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
LinkFile(stagewrt,stagein,root,bin,755)
NormalProgramTarget(stageqry, stageqry.Osuf getlisttp.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
NormalProgramTarget(stageclr, stageclr.Osuf getlisttp.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
LinkFile(stagecat,stagein,root,bin,755)
NormalProgramTarget(stagealloc, stagealloc.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
NormalProgramTarget(stageget, stageget.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
NormalProgramTarget(stageupdc, stageupdc.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
NormalProgramTarget(stagechng, stagechng.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
NormalProgramTarget(stageping, stageping.Osuf send2stgd_cmd.Osuf,$(DEPLIB),$(LIBS),root,bin,755)
#endif

#if Accounting
NormalProgramTarget(stagestat, stagestat.Osuf,$(DEPLIB),$(LIBS) $(MATHLIB),root,bin,755)
#endif

EXEMANPAGE(stage)
EXEMANPAGE(stagein)
EXEMANPAGE(stageout)
EXEMANPAGE(stageput)
EXEMANPAGE(stagewrt)
EXEMANPAGE(stageqry)
EXEMANPAGE(stageclr)
EXEMANPAGE(stageupdc)
EXEMANPAGE(stagechng)
EXEMANPAGE(stageping)
EXEMANPAGE(stagecat)
EXEMANPAGE(stagealloc)
EXEMANPAGE(stageget)
EXEMANPAGE(stagestat)
EXEMANPAGE(stage_other_options)
LIBMANPAGE(print_stcp)
LIBMANPAGE(print_stpp)
LIBMANPAGE(rc_castor2shift)
LIBMANPAGE(stage_alloc)
LIBMANPAGE(stage_api)
LIBMANPAGE(stage_clr_Disk)
LIBMANPAGE(stage_clr_Hsm)
LIBMANPAGE(stage_clr_Link)
LIBMANPAGE(stage_clr_Path)
LIBMANPAGE(stage_clr_Tape)
LIBMANPAGE(stage_constants)
LIBMANPAGE(stage_get)
LIBMANPAGE(stage_getcallback)
LIBMANPAGE(stage_geterrbuf)
LIBMANPAGE(stage_getlog)
LIBMANPAGE(stage_getoutbuf)
LIBMANPAGE(stage_kill)
LIBMANPAGE(stage_limits)
LIBMANPAGE(stage_macros)
LIBMANPAGE(stage_put_hsm)
LIBMANPAGE(stage_setcallback)
LIBMANPAGE(stage_seterrbuf)
LIBMANPAGE(stage_setlog)
LIBMANPAGE(stage_setoutbuf)
LIBMANPAGE(stage_struct)
LIBMANPAGE(stage_updc)
LIBMANPAGE(stage_in_disk)
LIBMANPAGE(stage_in_hsm)
LIBMANPAGE(stage_in_tape)
LIBMANPAGE(stage_out_disk)
LIBMANPAGE(stage_out_hsm)
LIBMANPAGE(stage_out_tape)
LIBMANPAGE(stage_ping)
LIBMANPAGE(stage_qry_Disk)
LIBMANPAGE(stage_qry_Hsm)
LIBMANPAGE(stage_qry_Tape)
LIBMANPAGE(stage_wrt_disk)
LIBMANPAGE(stage_wrt_hsm)
LIBMANPAGE(stage_wrt_tape)
