.\" $Id: stagewrt_tape.man,v 1.2 2002/10/08 11:45:57 baud Exp $
.\"
.\" @(#)$RCSfile: stagewrt_tape.man,v $ $Revision: 1.2 $ $Date: 2002/10/08 11:45:57 $ CERN IT-DS/HSM Jean-Damien Durand
.\" Copyright (C) 2002 by CERN/IT/DS/HSM
.\" All rights reserved
.\"
.TH STAGEWRT_TAPE "3" "$Date: 2002/10/08 11:45:57 $" "CASTOR" "Stage Library Functions"
.SH NAME
stagewrt_tape \- Asks for one or more tape files, present on disk, to be written to tape
.SH SYNOPSIS
.BI "#include <" stage_api.h ">"
.sp
.BI "int stagewrt_tape(u_signed64 " flags ,
.BI "int " openflag ,
.BI "char *" hostname ,
.BI "char *" pooluser ,
.BI "int " nstcp_input ,
.BI "struct stgcat_entry *" stcp_input ,
.BI "int *" nstcp_output ,
.BI "struct stgcat_entry **" stcp_output ,
.BI "int " nstpp_input ,
.BI "struct stgpath_entry *" stpp_input ");"

.SH DESCRIPTION
The \fBstagewrt_tape\fP API method asks the stager for one or more files present on disk to be written to tape.
There are two ouputs: the default ttys (unless you use \fBstage_setlog\fP) and the output parameters, that are allocated on the fly (e.g. the user will have to free them if necessary/wanted).

.SH PARAMETERS
.TP 1.5i
.I flags
Can be zero or a bit-wise of the following values:
.RS
.TP
.I STAGE_REQID
The member reqid of all 
.I stcp_input
structures given in input must match a known record having exactly this request id. Otherwise, even if it is set in the input structures, the reqid member will be ignored when processing the request.
.TP
.I STAGE_INFO
Gives as an MSG_ERR (standard error by default, unless you use 
.B stage_setlog
function), as an option string, the main characteristics of the tape file just staged. This includes block size (-b), record format (\-F), file identifier (\-f), record length (\-L), full pathname of diskfile in the pool (\-P) and file sequence number (\-q). The line is prefixed by the string "STG47  \-  ".
.TP
.I STAGE_SILENT
Print nothing (the log callback will never be notified either).
.TP
.I STAGE_NORETRY
If data is to be read from tape, and there is a medium error, internal retries by the I/O process doing the read will be skipped. It does not prevent stager daemon to decide to do a retry, nevertheless. This flag also prevents client to keep retrying in any case. Can be set with environment variable $STAGE_NORETRY to a non\-zero value.
.TP
.I STAGE_NOWAIT
If data is to be read from tape, this will be done in the background, and client will get an immediate return with ok status.
.RE
.TP
.I openflags
Not meaningful here. Should be zero.
.TP
.I hostname
Gives explicitely the hostname where is the stager daemon. If it NULL, default value apply: either the environment variable $STAGE_HOST, an entry 'STG HOST' in /etc/shift.conf file, or the default "stagepublic".
.TP
.I pooluser
Not used here.
.TP
.I nstcp_input
Number of stcp_input entries.
.TP
.I stcp_input
Entries describing the files you want to be staged. The members of the 
.I u1.t
union of the
.I stcp_input
structures are important: they describe the data from tape you want to read. In particular:
.RS
.TP
.I u1.t.vid[0]
Volume Id. Other indexes are used only if you do Volume Spanning.
.TP
.I u1.t.fseq
File sequence (cannot be a range).
.TP
Other fields you can use are:
.TP
.I recfm
Record format. Usually it is 'F'.
.TP
.I size
Limit size to
.I size
bytes.
.TP
.I charconv
Character conversion. A logical or of 
.IR EBCCONV ,
.IR FIXVAR ,
and
.I ASCCONV.
.TP
.I lrecl
Record length, in bytes.
.TP
.I poolname
Explicit disk poolname
.RE
.TP
.I nstcp_output
Filled with the number of staged entries at return.
.TP
.I stcp_output
Filled with the address of an array containg the staged entries at return. Up to the user to free it if necessary.
.TP
.I nstpp_input
Number of 
.I stpp_input
entries describing user links.
.TP
.I stpp_input
User links pointing to source files to be written.

.SH RETURN VALUE
0 on success, -1 on failure.

.SH ERRORS
If failure, the serrno variable might contain one of the following error codes:
.TP 1.9i
.B SENOMAPFND
Can't open mapping database (Windows only)
.TP
.B EFAULT
Bad address
.TP
.B EINVAL
Invalid argument
.TP
.B ESTGROUP
Invalid group
.TP
.B SECONNDROP
Connection closed by remote end
.TP
.B SECOMERR
Communication error
.TP
.B SEINTERNAL
Internal error
.TP
.B SEUSERUNKN
User unknown
.TP
.B SEOPNOTSUP
Operation not supported (should not happen)
.TP
.B ESTMEM
Request too big
.TP
.B ENOENT
No such file or directory
.TP
.B SESYSERR
System error
.TP
.B ESTCLEARED
Request cleared
.TP
.B ESTKILLED
Request killed
.TP
.B ENOSPC
No space left on device
.TP
.B EBUSY
Device or resource busy
.TP
.B ESTNACT
Stager not active (if you specify the STAGE_NORETRY flag - default is to retry forever)
.TP
.B SENOSHOST
Host not known

.SH SEE ALSO
\fBstagewrt\fP(1), \fBstage_limits\fP(3), \fBCastor_limits\fP(3), \fBstage_setlog\fP(3), \fBrc_castor2shift\fP(3), \fBstage_kill\fP(3), \fBstage_struct\fP(3)

.SH AUTHOR
\fBCASTOR\fP Team <castor.support@cern.ch>

