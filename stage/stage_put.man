.\"
.\" $Id: stage_put.man,v 1.7 2001/09/26 09:13:54 jdurand Exp $
.\"
.\" @(#)$RCSfile: stage_put.man,v $ $Revision: 1.7 $ $Date: 2001/09/26 09:13:54 $ CERN IT-PDP/DM Jean-Damien Durand
.\" Copyright (C) 1994-1999 by CERN/IT/PDP/DM
.\" All rights reserved
.\"
.TH STAGE_PUT "3" "$Date: 2001/09/26 09:13:54 $" "CASTOR" "Stage Library Functions"
.SH NAME
stage_put \- copy disk files to tape, to an external disk file or to a
Hierarchical Storage Management System.
.SH SYNOPSIS
.BI "#include <" stage_api.h ">"
.sp
.BI "int stage_put_hsm (char *" stghost ", int " Migrationflag ", stage_hsm_t " *hsmstruct ");"

.SH DESCRIPTION
.B stage_put_hsm
copies disk files to a Hierarchical Storage Management System. It can only be used after a
.B stageout
command, or a
.B stage_out_hsm
API call. The HSM file must be in state STAGEOUT or PUT_FAILED.

.SH PARAMETERS
.B stghost
is the stager machine name that hosts the stage daemon. If this parameter is
.P
.B NULL
, then default value is taken (either from configuration file, from environment variable
.B STAGE_HOST
, or from hardcoded value, "castor").
.P
.B Migrationflag
, if different than zero, indicates the system that the corresponding HSM files will belong to automatic migration. That is, the HSM file stage will become STAGEOUT|CAN_BE_MIGR. The stageqry output on such HSM file will show CAN_BE_MIGR. The difference between something that belongs to automatic migration or not is the uid/gid under which the migration process will be done. For a user-level migration, it will be under the account "stage", for experiment-level migration, it will under one of the accounts of the HSM files to be migrated.
.P
.B hsmstruct
is a linked list giving all the HSM files that have to be writen on tape. This structure is composed of the following members:
.TP 1.9i
.B char *xfile
Pointer to a HSM file name. Required to be non-NULL and non-zero length.
.TP
.B char *path
Pointer to the corresponding user filename. Required to be non-NULL and non-zero length.
.TP
.B u_signed64 size
Size limitation. Will be ignored if equal to zero.
.TP
.B stage_hsm_t *next
Pointer to next structure.
.B NULL
will indicate the end of the linked list.

.SH RETURN VALUE
0 on success, -1 on failure.

.SH ERRORS
The
.B serrno
variable might contain the following values:
\
.br
0       Ok.
.br
1       Bad parameter.
.br
2       System error.
.br
4       Configuration error.
.br
28      ENOSPC: tape volume overflow.
.br
192     Request cancelled by stageclr.
.br
197     Stageing limited by size.
.SH AUTHOR
\fBCASTOR\fP Team <castor.support@cern.ch>
