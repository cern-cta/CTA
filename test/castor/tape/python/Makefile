# Makefile generated by imake - do not edit!
# $XConsortium: imake.c,v 1.51 89/12/12 12:37:30 jim Exp $

#       @(#)linux.cf,v 1.10 2002/11/19 10:24:12 CERN IT-PDP/DM Jean-Philippe Baud
#
#  Copyright (C) 1997-2002 by CERN/IT/PDP/DM
#  All rights reserved
#

#  Default rules for Make          Linux

LDFLAGS += -Wl,--defsym,CastorVersion_v$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION)=0

CASTOR_ROOT?=$(shell pwd | sed -e 's=CASTOR2/.*$$=CASTOR2=' -e 's=trunk/.*$$=trunk=' -e 's=\(v2_1_[^/]*\)/.*$$=\1=' -e 's=\(castor-[0-9\-\.]*\)/.*$$=\1=')
CC += -fPIC -D_LARGEFILE64_SOURCE -Wall -Werror
CXX += -fPIC -D_LARGEFILE64_SOURCE -Wall -Werror
MTCCFLAGS = -pthread -DCTHREAD_POSIX -D_THREAD_SAFE -D_REENTRANT
MTLDLIBS =
MTLDFLAGS = -pthread
SHLIBLDFLAGS = -shared
SHLIBREQLIBS = -lc -lpthread `g++ -print-file-name=libstdc++.so` -ldl

PERLLIBDIR = /usr/lib/perl/CASTOR

PYTHONLIBS = `python ${CASTOR_ROOT}/config/pycompile.py --libs`
PYTHONINC = `python ${CASTOR_ROOT}/config/pycompile.py --inc`
PYTHONCFLAGS = `python ${CASTOR_ROOT}/config/pycompile.py --cflags`
PYTHONLIBDIR = $(shell python -c "from distutils import sysconfig; print sysconfig.get_python_lib()")

ACCTFLAG=-DSACCT
BIN = /usr/bin
LIBDIR = /usr/lib64
CONFIGDIR = /etc/sysconfig
CP = cp
LD = cc
LN = ln
SHELL = /bin/sh

DLFWEB=/var/www/html/dlf
DLFCONF=/var/www/conf/dlf

.PHONY : install clean clobber Makefiles depend checkDESTDIR checkORACLE checkLSF checkGLOBUS checkSTK checkXROOT checkVERSION

all: checkORACLE checkLSF checkGLOBUS checkXROOT tape client
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

tape: checkSTK

client:

EXPORTMAN?=$(DESTDIR)/usr/share
checkDESTDIR:
	@if [ -z "${DESTDIR}" ]; then 	  echo "Please set DESTDIR environment variable before invoking make install."; 	  exit 1; 	fi;

checkORACLE:
	@if [ -z ${ORACLE_HOME} ]; then 	  echo "Please define ORACLE_HOME environment variable before invoking make."; 	  exit 1; 	fi; 	if [ ! -r ${ORACLE_HOME}/lib/libclntsh.so ]; then 	  echo "Could not find libclntsh.so in ${ORACLE_HOME}/lib. Giving up."; 	  exit 1; 	fi

checkLSF:
	@if [ ! -e /usr/lib64/liblsf.so -o ! -d /usr/include/lsf ]; then 	  echo "Could not find LSF installation. Giving up."; 	  exit 1; 	fi

GLOBUS_LOCATION ?= /opt/globus
checkGLOBUS:
	@if [ ! -r ${GLOBUS_LOCATION}/lib/libglobus_ftp_control_gcc64dbg.so -o ! -d ${GLOBUS_LOCATION}/include ]; then 	  echo "Could not find Globus installation at ${GLOBUS_LOCATION}. Giving up."; 	  exit 1; 	fi

checkSTK:
	@if [ ! -z "${CASTOR_NOSTK}" ]; then 	  echo "Compiling without STK support."; 	else 	  if [ ! -e /usr/lib64/CDK/libapi.so -o ! -e /usr/lib64/CDK/libutl.so -o ! -e /usr/lib64/CDK/libipc.so -o ! -e /usr/lib64/CDK/libcl.so ]; then 	    echo "Could not find STK libraries. Giving up."; 	    exit 1;           fi; 	  if [ ! -d /usr/include/CDK ]; then 	    echo "Could not find STK development files. Giving up."; 	    exit 1;           fi; 	fi

XROOT_LOCATION ?= /opt/xrootd
checkXROOT:
	@if [ ! -r ${XROOT_LOCATION}/lib/libXrdPosix.so -o ! -d ${XROOT_LOCATION}/include ]; then 	  echo "Could not find XROOT installation at ${XROOT_LOCATION}. Giving up."; 	  exit 1; 	fi

checkVERSION:
	@if [ -z "${MAJOR_CASTOR_VERSION}" -o -z "${MINOR_CASTOR_VERSION}" ]; then 	  echo "Please define MAJOR/MINOR_CASTOR_VERSION before installing."; 	  exit 1; 	fi

install: checkDESTDIR checkVERSION all exportman
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

clean:
	rm -f $(FilesToClean)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

clobber: clean
	rm -f $(FilesToClobber)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

Makefiles:
	@for i in $(SUBDIRS);	do (if [ -d $$i ] ;	    then 	      (echo " $$i:" ; cd $$i ;	      $(CASTOR_ROOT)/imake/imake -I$(CASTOR_ROOT)/config;	      $(MAKE) $(MFLAGS) $@) ;	    else 	      (echo "ERROR : No directory $$i" ;	      exit 1) ;	    fi )	done ;

exportman:
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

depend:
	makedepend -I $(CASTOR_ROOT) -I $(CASTOR_ROOT)/h *.c *.cpp *.hpp *.h 2> /dev/null
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                 	  (echo "  $$i:" ; cd  $$i ;           	  $(MAKE) $@) ;                     	else                                 	  (echo "ERROR : No directory  $$i" ; 	  exit 1) ;                          	fi;); 	done;

#
#                      test/castor/tape/utils/Imakefile
#
# This file is part of the Castor project.
# See http://castor.web.cern.ch/castor
#
# Copyright (C) 2003  CERN
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#
# @author Nicola.Bessone@cern.ch Steven.Murray@cern.ch
#

CPPFLAGS = -g -O0 -I../../../../h -I../../../.. $(PYTHONINC) $(MTCCFLAGS)
CFLAGS = -O -I../../../../h -I../../../.. $(THREADFLAGS)
LDFLAGS += $(MTLDFLAGS)
LD = g++
LIBS = $(PYTHONLIBS)

DEPLIB += ../../../../castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/upv -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/ns
../../../../castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../castor ; $(MAKE) libcastorclient.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorclient.so:
	cd ../../../../castor ; $(MAKE) $@
DEPLIB += ../../../../castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/castor -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/ns -Wl,-rpath-link,$(CASTOR_ROOT)/security
../../../../castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../castor/db/cnv ; $(MAKE) libcastorcnvs.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorcnvs.so:
	cd ../../../../castor/db/cnv ; $(MAKE) $@
DEPLIB += ../../../../castor/tape/python/libcastortapepython.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../castor/tape/python/libcastortapepython.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/ns -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/castor
../../../../castor/tape/python/libcastortapepython.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../castor/tape/python ; $(MAKE) libcastortapepython.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastortapepython.so:
	cd ../../../../castor/tape/python ; $(MAKE) $@
DEPLIB += ../../../../castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/ns -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/castor
../../../../castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../castor/tape/utils ; $(MAKE) libcastortapeutils.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastortapeutils.so:
	cd ../../../../castor/tape/utils ; $(MAKE) $@
DEPLIB += ../../../../common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
../../../../common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../common ; $(MAKE) libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorcommon.so:
	cd ../../../../common ; $(MAKE) $@
DEPLIB += ../../../../dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common
../../../../dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../dlf ; $(MAKE) libcastordlf.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastordlf.so:
	cd ../../../../dlf ; $(MAKE) $@
DEPLIB += ../../../../vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common
../../../../vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../vdqm ; $(MAKE) libcastorvdqm.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorvdqm.so:
	cd ../../../../vdqm ; $(MAKE) $@
DEPLIB += ../../../../vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION)
LIBS += ../../../../vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/upv
../../../../vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION):
	cd ../../../../vmgr ; $(MAKE) libcastorvmgr.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorvmgr.so:
	cd ../../../../vmgr ; $(MAKE) $@

TESTTAPEPYTHONBIN_SRCS =   TestPythonMain.cpp

TESTTAPEPYTHONBIN_OBJS = $(TESTTAPEPYTHONBIN_SRCS:.cpp=.o)

testpython: $(TESTTAPEPYTHONBIN_OBJS) $(DEPLIB)
	$(LD) -o $@ $(LDFLAGS) $(TESTTAPEPYTHONBIN_OBJS) $(LIBS)
all: testpython
$(DESTDIR)/$(BIN)/testpython: $(INSUBDIR)testpython $(if $(DEPLIB),$(addprefix $(DESTDIR)/$(LIBDIR)/,$(subst .$(MAJOR_CASTOR_VERSION),,$(notdir $(DEPLIB)))))
	install -d $(DESTDIR)/$(BIN) -m 0755
	install -m 750 $< $(DESTDIR)/$(BIN)
install: $(DESTDIR)/$(BIN)/testpython

FilesToClean += $(TESTTAPEPYTHONBIN_OBJS)
FilesToClobber += testpython

# DO NOT DELETE

TestPythonMain.o: /usr/local/src/CASTOR_SVN_CO/trunk/castor/tape/python/python.hpp
TestPythonMain.o: /usr/local/src/CASTOR_SVN_CO/trunk/castor/exception/Exception.hpp
TestPythonMain.o: /usr/local/src/CASTOR_SVN_CO/trunk/h/serrno.h
TestPythonMain.o: /usr/local/src/CASTOR_SVN_CO/trunk/h/osdep.h
TestPythonMain.o: /usr/include/sys/types.h /usr/include/features.h
TestPythonMain.o: /usr/include/sys/cdefs.h /usr/include/gnu/stubs.h
TestPythonMain.o: /usr/include/bits/types.h /usr/include/bits/wordsize.h
TestPythonMain.o: /usr/lib/gcc/x86_64-redhat-linux/3.4.6/include/stddef.h
TestPythonMain.o: /usr/include/bits/typesizes.h /usr/include/time.h
TestPythonMain.o: /usr/include/pthread.h /usr/include/sched.h
TestPythonMain.o: /usr/include/bits/sched.h /usr/include/signal.h
TestPythonMain.o: /usr/include/bits/sigset.h /usr/include/bits/pthreadtypes.h
TestPythonMain.o: /usr/include/bits/initspin.h /usr/include/bits/sigthread.h
