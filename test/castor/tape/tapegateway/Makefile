# Makefile generated by imake - do not edit!
# $XConsortium: imake.c,v 1.51 89/12/12 12:37:30 jim Exp $

#       @(#)linux.cf,v 1.10 2002/11/19 10:24:12 CERN IT-PDP/DM Jean-Philippe Baud
#
#  Copyright (C) 1997-2002 by CERN/IT/PDP/DM
#  All rights reserved
#

#  Default rules for Make          Linux

LDFLAGS += -Wl,--defsym,CastorVersion_v$(MAJOR_CASTOR_VERSION).$(MINOR_CASTOR_VERSION)=0

DEBUG = -O0 -g
CASTOR_ROOT?=$(shell pwd | sed -e 's=CASTOR2/.*$$=CASTOR2=' -e 's=trunk/.*$$=trunk=' -e 's=\(v2_1_[^/]*\)/.*$$=\1=' -e 's=\(castor-[0-9\-\.]*\)/.*$$=\1=')
CC += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wextra -Werror
CXX += -fPIC -D_LARGEFILE64_SOURCE -Wall -Wextra -Werror
CXXFLAGS += -I$(CASTOR_ROOT) -I$(CASTOR_ROOT)/h $(DEBUG)
CFLAGS += $(CXXFLAGS)
CPPFLAGS += -pthread -DCTHREAD_POSIX -D_THREAD_SAFE -D_REENTRANT -I$(CASTOR_ROOT) -I$(CASTOR_ROOT)/h
LDFLAGS += -pthread

PERLLIBDIR = /usr/lib/perl/CASTOR

PYTHONLIBS = `python ${CASTOR_ROOT}/config/pycompile.py --libs`
PYTHONINC = `python ${CASTOR_ROOT}/config/pycompile.py --inc`
PYTHONCFLAGS = `python ${CASTOR_ROOT}/config/pycompile.py --cflags`
PYTHONLIBDIR = $(shell python -c "from distutils import sysconfig; print sysconfig.get_python_lib()")

BIN = /usr/bin
ifneq ($(wildcard /etc/debian_version),)
  LIBDIR = /usr/lib
else
  LIBDIR = /usr/lib64
endif

STAGERSUPERUSER0 = stage
STAGERSUPERUSER  = -DSTAGERSUPERUSER=\"$(STAGERSUPERUSER0)\"

STAGERSUPERGROUP0 = st
STAGERSUPERGROUP = -DSTAGERSUPERGROUP=\"$(STAGERSUPERGROUP0)\"

DLFWEB=/var/www/html/dlf
DLFCONF=/var/www/conf/dlf

.PHONY : install clean clobber Makefiles checkDESTDIR checkORACLE checkLSF checkGLOBUS checkSTK checkXROOT checkVERSION

all: checkORACLE checkLSF checkGLOBUS checkXROOT tape client
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                       	  (echo "  $$i:" ; cd  $$i ;     	  $(MAKE) $@) ;                           	else                                       	  (echo "ERROR : No  $$i  $$i" ; 	  exit 1) ;                                	fi;); 	done;

tape: checkSTK

client:

EXPORTMAN?=$(DESTDIR)/usr/share
checkDESTDIR:
	@if [ -z "${DESTDIR}" ]; then 	  echo "Please set DESTDIR environment variable before invoking make install."; 	  exit 1; 	fi;

checkORACLE:
	@if [ -z ${ORACLE_HOME} ]; then 	  echo "Please define ORACLE_HOME environment variable before invoking make."; 	  exit 1; 	fi; 	if [ ! -r ${ORACLE_HOME}/lib/libclntsh.so ]; then 	  echo "Could not find libclntsh.so in ${ORACLE_HOME}/lib. Giving up."; 	  exit 1; 	fi

checkLSF:
	@if [ ! -e $(LIBDIR)/liblsf.so -o ! -d /usr/include/lsf ]; then 	  echo "Could not find LSF installation. Giving up."; 	  exit 1; 	fi

GLOBUS_LOCATION ?= /opt/globus
checkGLOBUS:
	@if [ ! -r ${GLOBUS_LOCATION}/lib/libglobus_ftp_control_gcc64dbg.so -o ! -d ${GLOBUS_LOCATION}/include ]; then 	  echo "Could not find Globus installation at ${GLOBUS_LOCATION}. Giving up."; 	  exit 1; 	fi

checkSTK:
	@if [ ! -z "${CASTOR_NOSTK}" ]; then 	  echo "Compiling without STK support."; 	else 	  if [ ! -e $(LIBDIR)/CDK/libapi.so -o ! -e $(LIBDIR)/CDK/libutl.so -o ! -e $(LIBDIR)/CDK/libipc.so -o ! -e $(LIBDIR)/CDK/libcl.so ]; then 	    echo "Could not find STK libraries. Giving up."; 	    exit 1;           fi; 	  if [ ! -d /usr/include/CDK ]; then 	    echo "Could not find STK development files. Giving up."; 	    exit 1;           fi; 	fi

XROOT_LOCATION ?= /opt/xrootd
checkXROOT:
	@if [ ! -r ${XROOT_LOCATION}/lib/libXrdPosix.so -o ! -d ${XROOT_LOCATION}/include ]; then 	  echo "Could not find XROOT installation at ${XROOT_LOCATION}. Giving up."; 	  exit 1; 	fi

checkVERSION:
	@if [ -z "${MAJOR_CASTOR_VERSION}" -o -z "${MINOR_CASTOR_VERSION}" ]; then 	  echo "Please define MAJOR/MINOR_CASTOR_VERSION before installing."; 	  exit 1; 	fi

install: checkDESTDIR checkVERSION all exportman
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                       	  (echo "  $$i:" ; cd  $$i ;     	  $(MAKE) $@) ;                           	else                                       	  (echo "ERROR : No  $$i  $$i" ; 	  exit 1) ;                                	fi;); 	done;

clean:
	rm -f $(FilesToClean)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                       	  (echo "  $$i:" ; cd  $$i ;     	  $(MAKE) $@) ;                           	else                                       	  (echo "ERROR : No  $$i  $$i" ; 	  exit 1) ;                                	fi;); 	done;

clobber: clean
	rm -f $(FilesToClobber)
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                       	  (echo "  $$i:" ; cd  $$i ;     	  $(MAKE) $@) ;                           	else                                       	  (echo "ERROR : No  $$i  $$i" ; 	  exit 1) ;                                	fi;); 	done;

Makefiles:
	@for i in $(SUBDIRS);	do (if [ -d $$i ] ;	    then 	      (echo " $$i:" ; cd $$i ;	      $(CASTOR_ROOT)/imake/imake -I$(CASTOR_ROOT)/config;	      $(MAKE) $(MFLAGS) $@) ;	    else 	      (echo "ERROR : No directory $$i" ;	      exit 1) ;	    fi )	done ;

exportman:
	@for i in $(SUBDIRS) ; do       	  (if [ -d  $$i ] ;                      	then                                       	  (echo "  $$i:" ; cd  $$i ;     	  $(MAKE) $@) ;                           	else                                       	  (echo "ERROR : No  $$i  $$i" ; 	  exit 1) ;                                	fi;); 	done;

create_d = gcc -MM $(CPPFLAGS) $< | sed -n "H;$$ {g;s,\($*\)\.o[ :]*,\1.o $@ : ,;p}" > $@

%.d: %.c
	@$(create_d)

%.d: %.cpp
	@$(create_d)

include $(wildcard *.d)

#
#                      test/castor/tape/tapegateway/Imakefile
#
# This file is part of the Castor project.
# See http://castor.web.cern.ch/castor
#
# Copyright (C) 2003  CERN
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
#
#
# @author Nicola.Bessone@cern.ch Steven.Murray@cern.ch
#

DEPLIB += $(CASTOR_ROOT)/castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/upv -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/ns
$(CASTOR_ROOT)/castor/libcastorclient.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/castor ; $(MAKE) libcastorclient.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorclient.so:
	cd $(CASTOR_ROOT)/castor ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/castor -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/ns -Wl,-rpath-link,$(CASTOR_ROOT)/security
$(CASTOR_ROOT)/castor/db/cnv/libcastorcnvs.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/castor/db/cnv ; $(MAKE) libcastorcnvs.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorcnvs.so:
	cd $(CASTOR_ROOT)/castor/db/cnv ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/security -Wl,-rpath-link,$(CASTOR_ROOT)/ns -Wl,-rpath-link,$(CASTOR_ROOT)/dlf -Wl,-rpath-link,$(CASTOR_ROOT)/castor
$(CASTOR_ROOT)/castor/tape/utils/libcastortapeutils.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/castor/tape/utils ; $(MAKE) libcastortapeutils.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastortapeutils.so:
	cd $(CASTOR_ROOT)/castor/tape/utils ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
$(CASTOR_ROOT)/common/libcastorcommon.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/common ; $(MAKE) libcastorcommon.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorcommon.so:
	cd $(CASTOR_ROOT)/common ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common
$(CASTOR_ROOT)/dlf/libcastordlf.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/dlf ; $(MAKE) libcastordlf.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastordlf.so:
	cd $(CASTOR_ROOT)/dlf ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common
$(CASTOR_ROOT)/vdqm/libcastorvdqm.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/vdqm ; $(MAKE) libcastorvdqm.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorvdqm.so:
	cd $(CASTOR_ROOT)/vdqm ; $(MAKE) $@
DEPLIB += $(CASTOR_ROOT)/vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION)
LIBS += $(CASTOR_ROOT)/vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION) -Wl,-rpath-link,$(CASTOR_ROOT)/common -Wl,-rpath-link,$(CASTOR_ROOT)/upv
$(CASTOR_ROOT)/vmgr/libcastorvmgr.so.$(MAJOR_CASTOR_VERSION):
	cd $(CASTOR_ROOT)/vmgr ; $(MAKE) libcastorvmgr.so.$(MAJOR_CASTOR_VERSION)
$(DESTDIR)/$(LIBDIR)/libcastorvmgr.so:
	cd $(CASTOR_ROOT)/vmgr ; $(MAKE) $@

TAPE_TAPEGATEWAY_SRCS =   ../../../../castor/tape/tapegateway/daemon/MountIdToFseqMap.cpp

TESTTAPEGATEWAYBIN_SRCS =   TestTapegatewayMain.cpp   $(TAPE_TAPEGATEWAY_SRCS)

TESTTAPEGATEWAYBIN_OBJS = $(TESTTAPEGATEWAYBIN_SRCS:.cpp=.o)

testtapegateway: $(TESTTAPEGATEWAYBIN_OBJS) $(COMMONDEPLIB) $(DEPLIB)
	$(CC) -o $@ $(LDFLAGS) $(TESTTAPEGATEWAYBIN_OBJS) $(COMMONLIBS) $(LIBS)
all: testtapegateway
$(DESTDIR)/$(BIN)/testtapegateway: $(INSUBDIR)testtapegateway $(if $(COMMONDEPLIB) $(DEPLIB) ,$(addprefix $(DESTDIR)/$(LIBDIR)/,$(subst .$(MAJOR_CASTOR_VERSION),,$(notdir $(COMMONDEPLIB) $(DEPLIB) ))))
	install -d $(DESTDIR)/$(BIN) -m 0755
	install -m 750 $< $(DESTDIR)/$(BIN)
install: $(DESTDIR)/$(BIN)/testtapegateway

FilesToClean += $(TESTTAPEGATEWAYBIN_OBJS) $(patsubst %.o,%.d,$(TESTTAPEGATEWAYBIN_OBJS))
FilesToClobber += testtapegateway
$(TESTTAPEGATEWAYBIN_OBJS): %.o: %.d

