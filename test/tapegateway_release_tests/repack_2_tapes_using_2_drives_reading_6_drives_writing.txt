1. Dedicate read-only (mode=0), 2 tape drives which can read the 2 input test-tapes:

vdqm_admin -dedicate -dgn 359B1B -drive 35921011 -server tpsrv212 -match 'mode=0'
vdqm_admin -dedicate -dgn 359B1B -drive 35921012 -server tpsrv213 -match 'mode=0'

2. Create yourself a repack-destination tape-pool with 6 tapes.  It would be ideal if
   there are enough drives to mount in parallel each tape for writing.

vmgrenterpool --name gatewayrepack --user murrayc3 --group c3

vmgrmodifytape -V I12021 --pool gatewayrepack
vmgrmodifytape -V I12025 --pool gatewayrepack
vmgrmodifytape -V I12027 --pool gatewayrepack
vmgrmodifytape -V I12029 --pool gatewayrepack
vmgrmodifytape -V I12030 --pool gatewayrepack
vmgrmodifytape -V I12031 --pool gatewayrepack

3. Choose a service class for your test and make sure it has your newly created tape pool as its one and only tape pool:

modifySvcClass --Name default --AddTapePools gatewaytest

4. Make sure your service class will use exactly 6 drives for migrations:

modifySvcClass --Name default --NbDrives 6


modifySvcClass --Name largedisk1 --RemoveTapePools gatewaystress
modifySvcClass --Name largedisk1 --AddTapePools gatewayrepack


vi /etc/castor/policies/migration.py
...
def migratorPolicyAlwaysReturning1(tapepool, castorfilename,copynb,fileId,fileSize,fileMode,uid,gid,aTime,mTime,cTime,fileClass):
  return 1
...


vi /etc/castor/policies/stream.py
...
def streamPolicyAlwaysReturning1(runningStreams,numFiles,dataVolume,maxNumStreams,age):
  return 1
...

modifySvcClass --Name largedisk1 --MigratorPolicy migratorPolicyAlwaysReturning1
modifySvcClass --Name largedisk1 --StreamPolicy streamPolicyAlwaysReturning1

For each of the two input test-tapes, store the list of files on the tape in
file.

nslisttape -V I12018 > ~/nslisttape_I12018.txt
nslisttape -V I12017 > ~/nslisttape_I12017.txt

5. repack 2 tapes

-bash-3.2$ repack -V I12017:I12018 -o largedisk1
Operation succeeded for tape I12017
Operation succeeded for tape I12018

-bash-3.2$
