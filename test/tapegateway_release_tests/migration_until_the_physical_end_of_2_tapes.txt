1. Create yourself a tape-pool with 2 tapes that can be accessed by your 2
   drives:

vmgrenterpool --name gatewayendtape --user murrayc3 --group c3
vmgrmodifytape -V I12017 --pool gatewayendtape
vmgrmodifytape -V I12018 --pool gatewayendtape

2. Choose a service class for your test and make sure it has your newly created tape pool as its one and only tape pool:

modifySvcClass --Name default --RemoveTapePools
modifySvcClass --Name default --AddTapePools

3. Make sure your service class will use exactly 2 drives for migrations:

modifySvcClass --Name default --NbDrives 1

4. Create an empty directory in CASTOR to store the test files used to fill
   the two tapes.

nsmkdir /castor/cern.ch/user/m/murrayc3/gatewayendtape

5. Make sure the directory has a file class with one tape copy

nslistclass | egrep 'CLASS_ID|CLASS_NAME|NBCOPIES' | grep -B2 'NBCOPIES 1'
...
CLASS_ID 95
CLASS_NAME largeuser
NBCOPIES 1
...
nschclass largeuser /castor/cern.ch/user/m/murrayc3/gatewayendtape

6. Using dedications dedicate the 2 test-drives to the test-stager and pair
   each of the test-tapes exclusively with one on the test-drives.

vdqm_admin -dedicate -dgn 359B1B -drive 35921011 -server tpsrv212 -match 'host=castorcert5.*,vid=I12017'
vdqm_admin -dedicate -dgn 359B1B -drive 35921012 -server tpsrv213 -match 'host=castorcert5.*,vid=I12018'

grep "VDQM \+HOST" /etc/castor/castor.conf
ssh lxcastorsrv102
cat /etc/castor/ORAVDQMCONFIG
sqlplus castorvdqm@c2castordevdb
call castorVdqm.dedicateTape('I12017', '35921011', 'tpsrv212', '359B1B');
call castorVdqm.dedicateTape('I12018', '35921012', 'tpsrv213', '359B1B');
commit;

[root@lxbrl2708 ~]# showqueues -x | egrep 'tpsrv212|tpsrv213'
DN 359B1B 35921011@tpsrv212 FREE 512399
(host=castorcert5.*,vid=I12017,vid2drv=I12017) None
DN 359B1B 35921012@tpsrv213 FREE 62664
(host=castorcert5.*,vid=I12018,vid2drv=I12018) None
[root@lxbrl2708 ~]#


7. Start the remote copy of 2 Terabytes

for I in `seq 20`; do bsub -q 8nh
/afs/cern.ch/user/m/murrayc3/castor/checkout/trunk/test/tapegateway_release_tests/createAndCopyFilesToCastor.sh
castorcert5-A default castorcert5-lb
/castor/cern.ch/user/m/murrayc3/gatewayendtape 100 1024; done
