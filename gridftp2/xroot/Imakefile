COMM
COMM                    gridftp2/external/Imakefile
COMM
COMM This file is part of the Castor project.
COMM See http://castor.web.cern.ch/castor
COMM
COMM Copyright (C) 2003  CERN
COMM This program is free software; you can redistribute it and/or
COMM modify it under the terms of the GNU General Public License
COMM as published by the Free Software Foundation; either version 2
COMM of the License, or (at your option) any later version.
COMM This program is distributed in the hope that it will be useful,
COMM but WITHOUT ANY WARRANTY; without even the implied warranty of
COMM MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
COMM GNU General Public License for more details.
COMM You should have received a copy of the GNU General Public License
COMM along with this program; if not, write to the Free Software
COMM Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
COMM
COMM
COMM Make Castor Oracle library for CDBC API
COMM
COMM @author castor-dev@cern.ch
COMM

MOPTION=-m32
ifeq ($(shell uname -m), x86_64)
  MOPTION=-m64
endif

CPPFLAGS += $(GLOBUS_INC) -I$(XROOT_LOCATION)/include/xrootd -D_LARGEFILE_SOURCE -D_REENTRANT
CXXFLAGS += $(MOPTION) -fPIC
AddLdFlags($(GLOBUS_FTPLIB) $(MOPTION) -shared -L$(XROOT_LOCATION)/lib -lXrdPosix -lstdc++)

DependsOnLibrary(common,castorcommon)
DependsOnLibrary(castor,castorclient)
PlacedSharedLibraryTargetWithSo(globus_gridftp_server_CASTOR2xroot,globus_gridftp_server_CASTOR2xroot.o,,,$(GLOBUS_LIB_PATH))

COMM We overwrite here the default rule for the compilation of
COMM globus_gridftp_server_CASTOR2xroot in order to be able to alleviate the -Werror
COMM present in the standard flags for the case of
COMM "right-hand operand of comma has no effect".
COMM This warning is due to a bad macro from globus and only occurs on
COMM gcc 3.4, that is SLC4. We will thus be able to drop this from SLC5 on
COMM Another reason for overwritting is the flag compilation flag -D_FILE_OFFSET_BITS=64
COMM that should not be set on other components on 32 bits platforms so cannot be added
COMM to CPPFLAGS.
COMM This part can be removed when 32 bits support will be dropped
COMPILECPP(globus_gridftp_server_CASTOR2xroot.cpp,-Wno-error -D_FILE_OFFSET_BITS=64)

LOGROTATE(castor-gridftp-dsi-common,install)
MakeDir(/var/log,0755)
