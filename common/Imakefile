COMM       @(#)Imakefile,v 1.52 2004/06/09 16:10:29 CERN IT-PDP/DM Jean-Philippe Baud
COMM
COMM  Copyright (C) 1990-2002 by CERN/IT/PDP/DM
COMM  All rights reserved
COMM

COMM		Make common routines library

PATH_CONFIG = ShiftConfigFile
MAPPING = MappingFile
LOCHOSTSFILE = LocalHostsList
RTHOSTSFILE = RemoteHostsList
ADMINHOSTS = AdminHosts
SACCTFILE = SacctDir/sacct
ACCTFILE = -DACCTFILE=\"$(SACCTFILE)\"
WSACCTO = wsacct.Osuf
NFSROOT0 = NfsRoot
NFSROOT  = -DNFSROOT=\"$(NFSROOT0)\"
CFLAGS = -g -I ../h $(MTCCFLAGS) -DCTHREAD_DEBUG -DCPOOL_DEBUG -DPATH_CONFIG=\"$(PATH_CONFIG)\" -DLOCALHOSTSFILE=\"$(LOCHOSTSFILE)\" -DMAPPING_FILE=\"$(MAPPING)\" -DRTHOSTSFILE=\"$(RTHOSTSFILE)\" -DADMIN_HOSTS=\"$(ADMINHOSTS)\" $(CCOPTFLAGS) $(NEWGETCONF) $(ACCTFILE) $(NFSROOT)
CPPFLAGS = $(CFLAGS)
FFLAGS = $(FFOPTFLAGS)

COMMONLIB_OBJS = $(SYSDEP_OBJS) \
		 compat.Osuf getacct.Osuf getacctent.Osuf getconfent.Osuf \
		 getfilep.Osuf getifnam.Osuf getuser.Osuf log.Osuf marshall.Osuf \
		 readc.Osuf remote.Osuf segment.Osuf \
		 serror.Osuf setnetio.Osuf socket.Osuf solveln.Osuf trace.Osuf \
		 $(WSACCTO) ypgetacct.Osuf ypgetacctent.Osuf \
		 Cdlopen.Osuf Cthread.Osuf Csched.Osuf Cglobals.Osuf Cgrp.Osuf Cmutex.Osuf Cuuid.Osuf \
		 Cdomainname.Osuf Cnetdb.Osuf Cpool.Osuf Cpwd.Osuf Cstrerror.Osuf \
		 socket_timeout.Osuf u64subr.Osuf Cinitdaemon.Osuf Cgetopt.Osuf \
		 Cregexp.Osuf Csetprocname.Osuf Cexportconf.Osuf Csnprintf.Osuf util.Osuf \
		 Csecloader.Osuf castor1compat.Osuf

sendscsicmd.o: sendscsicmd.c
	@if [ -f "/usr/src/linux/include/scsi/sg.h" ] ;\
	then \
		echo $(CC) $(CFLAGS) -DSCSIINC="\"/usr/src/linux/include/scsi/sg.h\"" -c sendscsicmd.c ;\
		$(CC) $(CFLAGS) -DSCSIINC="\"/usr/src/linux/include/scsi/sg.h\"" -c sendscsicmd.c ;\
	else \
		echo $(CC) $(CFLAGS) -DSCSIINC="\"/usr/include/scsi/sg.h\"" -c sendscsicmd.c ;\
		$(CC) $(CFLAGS) -DSCSIINC="\"/usr/include/scsi/sg.h\"" -c sendscsicmd.c ;\
	fi

ClientSharedLibraryTarget(castorcommon,$(COMMONLIB_OBJS),,-ldl -lpthread)

LIBMANPAGE(getacct)
LIBMANPAGE(getacctent)
LIBMANPAGE(getconfent)
LIBMANPAGE(log)
LIBMANPAGE(netclose)
LIBMANPAGE(netread)
LIBMANPAGE(netwrite)
LIBMANPAGE(Cgetopt)
LIBMANPAGE(Cglobals)
LIBMANPAGE(Cgrp)
LIBMANPAGE(Cuuid)
LIBMANPAGE(Cmutex)
LIBMANPAGE(Cpool)
LIBMANPAGE(Cpwd)
LIBMANPAGE(Csched)
LIBMANPAGE(Csetprocname)
LIBMANPAGE(Cthread)
