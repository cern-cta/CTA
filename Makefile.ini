#       @(#)$RCSfile: Makefile.ini,v $ $Revision: 1.6 $ $Date: 2009/07/09 15:55:21 $ CERN IT-PDP/DM Jean-Philippe Baud
#
#  Copyright (C) 1993-1999 by CERN/IT/PDP/DM
#  All rights reserved
#
# Makefile.ini	Startup Makefile
#


.PHONY: Makefiles
Makefiles:
	@(cd imake; $(MAKE) $(MFLAGS) -f Makefile.ini BOOTSTRAPCFLAGS="$$BOOTSTRAPCFLAGS")
	@echo "Building Makefiles"
	@for directory in `find . -name Imakefile -exec dirname {} \;`; do                   \
	    (echo " $$directory";                                                            \
             relativedirectory=`echo $$directory | sed -e 's|^.||' | sed -e 's|^/||'`;       \
             rootprefix=`echo $$relativedirectory | sed -e 's|/|_|g'`;                       \
             backtoroot=`echo $$relativedirectory | sed -e 's|[^/][^/]*|..|g' | sed -e 's|^$$|.|'`;\
             localpath=`echo $$relativedirectory | sed -e 's|^$$|.|'`;                       \
             cd $$directory;                                                                 \
             $$backtoroot/imake/imake -I$$backtoroot/config;                                 \
             cat Makefile | sed -e "s|__local_path__|$$localpath|g" | sed -e "s|__root_prefix__|$$rootprefix|g" | sed -e "s|__back_to_root__|$$backtoroot|g" > Makefile.parsed; \
             mv Makefile.parsed Makefile); \
	done ;
